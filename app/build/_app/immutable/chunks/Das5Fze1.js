import{s as c,a as f,b as n,i as r}from"./odI--4Kw.js";import{g as A}from"./Cw8GvGRZ.js";import{g as u,a as l,i as d,s as g,d as o,b as h,r as m}from"./CuiFJ7Vr.js";import{m as L,a as p}from"./BYFcJoO7.js";function k(){let e=c(f({user:null,isAuthenticated:!1,isAdmin:!1,isLoading:!0,error:null}));{const s=u();n(e,{user:s,isAuthenticated:d(),isAdmin:l(),isLoading:!1,error:null},!0)}return{get user(){return r(e).user},get isAuthenticated(){return r(e).isAuthenticated},get isAdmin(){return r(e).isAdmin},get isLoading(){return r(e).isLoading},get error(){return r(e).error},async login(s,t){r(e).isLoading=!0,r(e).error=null;try{const i=await p({email:s,password:t});if(i.token){g(i.token);const a=o(i.token);return n(e,{user:a,isAuthenticated:!0,isAdmin:a?.role==="admin"||a?.role==="super_admin",isLoading:!1,error:null},!0),!0}return r(e).error="Login failed",r(e).isLoading=!1,!1}catch(i){return r(e).error=i.message||"Login failed",r(e).isLoading=!1,!1}},async logout(){try{await L()}catch{}m(),n(e,{user:null,isAuthenticated:!1,isAdmin:!1,isLoading:!1,error:null},!0),A("/auth/login")},async refresh(){const s=h();if(!s)return r(e).isAuthenticated=!1,r(e).user=null,!1;const t=o(s);return t&&t.exp&&t.exp*1e3>Date.now()?(n(e,{user:t,isAuthenticated:!0,isAdmin:t?.role==="admin"||t?.role==="super_admin",isLoading:!1,error:null},!0),!0):(m(),r(e).isAuthenticated=!1,r(e).user=null,!1)},initialize(){const s=u();n(e,{user:s,isAuthenticated:d(),isAdmin:l(),isLoading:!1,error:null},!0)},setSession(s,t){g(s);const i=o(s)||{id:t.id,email:t.email,name:t.name,role:t.role,exp:Math.floor(Date.now()/1e3)+3600};n(e,{user:i,isAuthenticated:!0,isAdmin:i?.role==="admin"||i?.role==="super_admin",isLoading:!1,error:null},!0)}}}const S=k();export{S as a};
