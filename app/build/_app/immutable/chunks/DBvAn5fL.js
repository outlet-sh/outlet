import{d as m,j as f,b as s,g as r}from"./Ip2DykXx.js";import{g as A}from"./CDoCV2GU.js";import{g as l,a as u,i as d,s as g,d as o,b as h,r as c}from"./BS4BNS52.js";import{a as L,l as p}from"./CtwFYI68.js";function k(){let e=m(f({user:null,isAuthenticated:!1,isAdmin:!1,isLoading:!0,error:null}));{const n=l();s(e,{user:n,isAuthenticated:d(),isAdmin:u(),isLoading:!1,error:null},!0)}return{get user(){return r(e).user},get isAuthenticated(){return r(e).isAuthenticated},get isAdmin(){return r(e).isAdmin},get isLoading(){return r(e).isLoading},get error(){return r(e).error},async login(n,t){r(e).isLoading=!0,r(e).error=null;try{const i=await p({email:n,password:t});if(i.token){g(i.token);const a=o(i.token);return s(e,{user:a,isAuthenticated:!0,isAdmin:(a==null?void 0:a.role)==="admin"||(a==null?void 0:a.role)==="super_admin",isLoading:!1,error:null},!0),!0}return r(e).error="Login failed",r(e).isLoading=!1,!1}catch(i){return r(e).error=i.message||"Login failed",r(e).isLoading=!1,!1}},async logout(){try{await L()}catch{}c(),s(e,{user:null,isAuthenticated:!1,isAdmin:!1,isLoading:!1,error:null},!0),A("/auth/login")},async refresh(){const n=h();if(!n)return r(e).isAuthenticated=!1,r(e).user=null,!1;const t=o(n);return t&&t.exp&&t.exp*1e3>Date.now()?(s(e,{user:t,isAuthenticated:!0,isAdmin:(t==null?void 0:t.role)==="admin"||(t==null?void 0:t.role)==="super_admin",isLoading:!1,error:null},!0),!0):(c(),r(e).isAuthenticated=!1,r(e).user=null,!1)},initialize(){const n=l();s(e,{user:n,isAuthenticated:d(),isAdmin:u(),isLoading:!1,error:null},!0)},setSession(n,t){g(n);const i=o(n)||{id:t.id,email:t.email,name:t.name,role:t.role,exp:Math.floor(Date.now()/1e3)+3600};s(e,{user:i,isAuthenticated:!0,isAdmin:(i==null?void 0:i.role)==="admin"||(i==null?void 0:i.role)==="super_admin",isLoading:!1,error:null},!0)}}}const S=k();export{S as a};
