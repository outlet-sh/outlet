import"../chunks/DsnmJJEf.js";import{p as Pt,s as v,a as Q,u as Ft,b as s,f as R,d as Ct,e as Nt,g as Vt,i as e,c as r,r as a,h as i,n as y,t as T,j as q}from"../chunks/odI--4Kw.js";import{d as At,s as k}from"../chunks/BNMK9zrr.js";import{c as Dt,a as p,f as b}from"../chunks/CCInJaqd.js";import{i as P}from"../chunks/COaB7F5h.js";import{r as z,e as be,b as Ie,i as fe,a as Ue}from"../chunks/BohEjZuL.js";import{h as Rt}from"../chunks/hUjpWz_l.js";import{B as _e,X as qt,I as A,P as zt,E as Bt,j as Ht,k as We,A as Xe,F as Ge}from"../chunks/BzmQlP_K.js";import{s as Mt,a as Ot}from"../chunks/DL1yFSKa.js";import{p as It}from"../chunks/DUPtV3xh.js";import{g as Je}from"../chunks/VCNxLxKH.js";import{t as Ut,w as Wt,x as Xt,y as Gt}from"../chunks/CORuJdE6.js";import{L as Jt}from"../chunks/D716f0vp.js";import{S as Kt,T as Qt}from"../chunks/D9MNHm-L.js";import{A as Yt}from"../chunks/wNvgBcBY.js";import{T as Zt}from"../chunks/pYjBAzKg.js";var ea=b('<div class="flex justify-center py-12"><!></div>'),ta=b("<!> Cancel",1),aa=b("<!> ",1),ra=b("<!> ",1),sa=b("<p> </p>"),ia=b('<div class="px-6 pt-4"><!></div>'),la=b("<p> </p>"),na=b('<div class="px-6 pt-4"><!></div>'),oa=b('<p class="text-xs text-base-content/60">No lists available.</p>'),ca=b('<label class="flex items-center gap-2 p-2 rounded-lg hover:bg-base-200 cursor-pointer transition-colors"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm"/> <div class="flex-1 min-w-0 flex items-center justify-between"><span class="text-sm text-base-content truncate"> </span> <span class="text-xs text-base-content/50 ml-2"> </span></div></label>'),da=b('<p class="text-xs text-base-content/60 mt-2">Total: <strong class="text-base-content"> </strong> recipients</p>'),va=b('<div class="space-y-2 max-h-48 overflow-y-auto"></div> <!>',1),ma=b('<label class="flex items-center gap-2 p-2 rounded-lg hover:bg-base-200 cursor-pointer transition-colors"><input type="checkbox" class="checkbox checkbox-warning checkbox-sm"/> <div class="flex-1 min-w-0"><span class="text-sm text-base-content block truncate"> </span></div></label>'),ua=b('<div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-base-content mb-3">Exclude Lists</h4> <div class="space-y-2 max-h-32 overflow-y-auto"></div></div>'),pa=b('<button type="button"><!> <div class="min-w-0"><span class="text-sm font-medium text-base-content block truncate"> </span> <span class="text-xs text-base-content/50"> </span></div></button>'),ba=b('<div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-base-content mb-3">Template</h4> <div class="space-y-2"><button type="button"><!> <div><span class="text-sm font-medium text-base-content block">Blank</span> <span class="text-xs text-base-content/50">Start from scratch</span></div></button> <!></div></div>'),fa=b(`<div class="fixed inset-0 z-50 bg-base-200"><div class="h-full flex flex-col"><div class="bg-base-100 border-b border-base-300 px-6 py-4 flex items-center justify-between flex-shrink-0"><div class="flex items-center gap-4"><button type="button" class="p-2 rounded-lg hover:bg-base-200 transition-colors text-base-content/60 hover:text-base-content"><!></button> <div><input type="text" placeholder="Campaign Name" class="text-lg font-semibold text-base-content bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-base-content/40 w-64"/> <p class="text-xs text-base-content/50">New Campaign</p></div></div> <div class="flex items-center gap-3"><!> <!> <!></div></div> <!> <!> <div class="flex-1 overflow-hidden flex"><div class="w-80 bg-base-100 border-r border-base-300 p-6 overflow-y-auto flex-shrink-0"><div class="space-y-6"><div><label for="subject" class="form-label">Subject Line</label> <!></div> <div><label for="preview-text" class="form-label">Preview Text</label> <!> <p class="mt-1 text-xs text-base-content/50 italic">Shown in inbox previews after the subject line.</p></div> <div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-base-content mb-3">Recipients</h4> <!></div> <!> <div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-base-content mb-3">Sender (optional)</h4> <div class="space-y-3"><!> <!> <!></div> <p class="mt-2 text-xs text-base-content/50 italic">Leave blank to use organization defaults.</p></div> <!> <div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-base-content mb-3">Tracking</h4> <div class="space-y-3"><label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm"/> <span class="text-sm text-base-content">Track opens</span></label> <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm"/> <span class="text-sm text-base-content">Track clicks</span></label></div></div> <div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-base-content mb-3">Test Email</h4> <!> <p class="mt-1 text-xs text-base-content/50 italic">Enter an email address and click "Send Test" to preview.</p></div> <!></div></div> <div class="flex-1 flex flex-col overflow-hidden p-6 gap-4"><div class="flex-1 min-h-0"><!></div> <div class="flex-shrink-0"><div class="flex items-center justify-between mb-1"><label for="plain-text" class="form-label mb-0">Plain Text Version</label> <button type="button" class="text-xs text-primary hover:text-primary/80">Regenerate from HTML</button></div> <!> <p class="mt-1 text-xs text-base-content/50 italic">Plain text version for email clients that don't support HTML.</p></div></div></div></div></div>`);function Na(Ke,Qe){Pt(Qe,!0);const Ye=()=>Ot(It,"$page",Ze),[Ze,et]=Mt();let B=v(""),j=v(""),Y=v(""),H=v(""),M=v(""),O=v(""),w=v(""),F=v(""),Z=v(!0),ee=v(!0),g=v(Q([])),S=v(Q([])),I=v(""),C=v(Q([])),U=v(Q([])),te=v(!0),W=v(!1),h=v(""),N=v(""),X=v(!1),V=v(""),xe=v(null),ge=q(()=>`/${Ye().params.brandSlug}`),tt=q(()=>()=>e(C).filter(l=>e(g).includes(l.id)).reduce((l,d)=>l+d.subscriber_count,0)),he=q(()=>()=>e(B).trim()!==""&&e(j).trim()!==""&&e(w).trim()!==""&&e(g).length>0);const at=[{name:"email",label:"Subscriber email"},{name:"name",label:"Subscriber name"},{name:"name,fallback=Friend",label:"Name with fallback"},{name:"unsubscribe_url",label:"Unsubscribe link"},{name:"web_version_url",label:"Web version link"}];Ft(()=>{rt()});async function rt(){s(te,!0),s(h,"");try{const[l,d]=await Promise.all([Ut(),Wt({})]);s(C,l.lists||[],!0),s(U,(d.designs||[]).filter(E=>E.is_active),!0)}catch(l){console.error("Failed to load data:",l),s(h,"Failed to load lists and templates")}finally{s(te,!1)}}function ye(l){if(s(I,l,!0),l){const d=e(U).find(E=>E.id===l);d&&(s(w,d.html_body,!0),d.plain_text&&s(F,d.plain_text,!0))}}function st(l){e(g).includes(l)?s(g,e(g).filter(d=>d!==l),!0):s(g,[...e(g),l],!0)}function it(l){e(S).includes(l)?s(S,e(S).filter(d=>d!==l),!0):s(S,[...e(S),l],!0)}async function lt(){if(!e(he)()){s(h,"Please fill in all required fields");return}s(W,!0),s(h,"");try{const l={name:e(B).trim(),subject:e(j).trim(),preview_text:e(Y).trim()||void 0,from_name:e(H).trim()||void 0,from_email:e(M).trim()||void 0,reply_to:e(O).trim()||void 0,html_body:e(w),plain_text:e(F).trim()||void 0,list_ids:e(g),exclude_list_ids:e(S).length>0?e(S):void 0,track_opens:e(Z),track_clicks:e(ee),design_id:e(I)||void 0},d=await Gt(l);Je(`${e(ge)}/campaigns/${d.id}`)}catch(l){console.error("Failed to save campaign:",l),s(h,l.message||"Failed to save campaign",!0)}finally{s(W,!1)}}async function nt(){if(!e(N).trim()||!e(j).trim()||!e(w).trim()){s(h,"Please enter a test email address, subject, and content");return}s(X,!0),s(h,""),s(V,"");try{await Xt({to:e(N).trim(),subject:e(j).trim(),body:e(w),text_body:e(F).trim()||void 0,from_name:e(H).trim()||void 0,from_email:e(M).trim()||void 0,reply_to:e(O).trim()||void 0,tags:["campaign-test"]}),s(V,`Test email sent to ${e(N)}`),setTimeout(()=>{s(V,"")},5e3)}catch(l){console.error("Failed to send test email:",l),s(h,l.message||"Failed to send test email",!0)}finally{s(X,!1)}}function ot(){const l=document.createElement("div");l.innerHTML=e(w),s(F,l.textContent||l.innerText||"",!0)}function ke(){Je(`${e(ge)}/campaigns`)}var we=Dt();Rt("1vqcqve",l=>{Nt(()=>{Vt.title="New Campaign | Outlet"})});var ct=R(we);{var dt=l=>{var d=ea(),E=r(d);Jt(E,{size:"lg"}),a(d),p(l,d)},vt=l=>{var d=fa(),E=r(d),ae=r(E),re=r(ae),G=r(re);G.__click=ke;var mt=r(G);Yt(mt,{class:"h-5 w-5"}),a(G);var $e=i(G,2),Te=r($e);z(Te),y(2),a($e),a(re);var Se=i(re,2),Ee=r(Se);_e(Ee,{type:"secondary",onclick:ke,children:(t,n)=>{var u=ta(),o=R(u);qt(o,{class:"mr-2 h-4 w-4"}),y(),p(t,u)},$$slots:{default:!0}});var Le=i(Ee,2);{let t=q(()=>e(X)||!e(j).trim()||!e(w).trim()||!e(N).trim());_e(Le,{type:"secondary",onclick:nt,get disabled(){return e(t)},children:(n,u)=>{var o=aa(),f=R(o);Zt(f,{class:"mr-2 h-4 w-4"});var c=i(f);T(()=>k(c,` ${e(X)?"Sending...":"Send Test"}`)),p(n,o)},$$slots:{default:!0}})}var ut=i(Le,2);{let t=q(()=>e(W)||!e(he)());_e(ut,{type:"primary",onclick:lt,get disabled(){return e(t)},children:(n,u)=>{var o=ra(),f=R(o);Kt(f,{class:"mr-2 h-4 w-4"});var c=i(f);T(()=>k(c,` ${e(W)?"Saving...":"Save as Draft"}`)),p(n,o)},$$slots:{default:!0}})}a(Se),a(ae);var je=i(ae,2);{var pt=t=>{var n=ia(),u=r(n);Xe(u,{type:"error",title:"Error",onclose:()=>s(h,""),children:(o,f)=>{var c=sa(),m=r(c,!0);a(c),T(()=>k(m,e(h))),p(o,c)},$$slots:{default:!0}}),a(n),p(t,n)};P(je,t=>{e(h)&&t(pt)})}var Pe=i(je,2);{var bt=t=>{var n=na(),u=r(n);Xe(u,{type:"success",title:"Success",onclose:()=>s(V,""),children:(o,f)=>{var c=la(),m=r(c,!0);a(c),T(()=>k(m,e(V))),p(o,c)},$$slots:{default:!0}}),a(n),p(t,n)};P(Pe,t=>{e(V)&&t(bt)})}var Fe=i(Pe,2),se=r(Fe),Ce=r(se),ie=r(Ce),ft=i(r(ie),2);A(ft,{id:"subject",type:"text",placeholder:"e.g., Check out what's new!",get value(){return e(j)},set value(t){s(j,t,!0)}}),a(ie);var le=i(ie,2),_t=i(r(le),2);A(_t,{id:"preview-text",type:"text",placeholder:"Text shown after subject...",get value(){return e(Y)},set value(t){s(Y,t,!0)}}),y(2),a(le);var ne=i(le,2),xt=i(r(ne),2);{var gt=t=>{var n=oa();p(t,n)},ht=t=>{var n=va(),u=R(n);be(u,21,()=>e(C),fe,(c,m)=>{var x=ca(),_=r(x);z(_),_.__change=()=>st(e(m).id);var $=i(_,2),L=r($),D=r(L,!0);a(L);var J=i(L,2),K=r(J,!0);a(J),a($),a(x),T((pe,jt)=>{Ie(_,pe),k(D,e(m).name),k(K,jt)},[()=>e(g).includes(e(m).id),()=>e(m).subscriber_count.toLocaleString()]),p(c,x)}),a(u);var o=i(u,2);{var f=c=>{var m=da(),x=i(r(m)),_=r(x,!0);a(x),y(),a(m),T($=>k(_,$),[()=>e(tt)().toLocaleString()]),p(c,m)};P(o,c=>{e(g).length>0&&c(f)})}p(t,n)};P(xt,t=>{e(C).length===0?t(gt):t(ht,!1)})}a(ne);var Ne=i(ne,2);{var yt=t=>{var n=ua(),u=i(r(n),2);be(u,21,()=>e(C).filter(o=>!e(g).includes(o.id)),fe,(o,f)=>{var c=ma(),m=r(c);z(m),m.__change=()=>it(e(f).id);var x=i(m,2),_=r(x),$=r(_,!0);a(_),a(x),a(c),T(L=>{Ie(m,L),k($,e(f).name)},[()=>e(S).includes(e(f).id)]),p(o,c)}),a(u),a(n),p(t,n)};P(Ne,t=>{e(g).length>0&&e(C).filter(n=>!e(g).includes(n.id)).length>0&&t(yt)})}var oe=i(Ne,2),Ve=i(r(oe),2),Ae=r(Ve);A(Ae,{placeholder:"From Name",get value(){return e(H)},set value(t){s(H,t,!0)}});var De=i(Ae,2);A(De,{type:"email",placeholder:"From Email",get value(){return e(M)},set value(t){s(M,t,!0)}});var kt=i(De,2);A(kt,{type:"email",placeholder:"Reply-To Email",get value(){return e(O)},set value(t){s(O,t,!0)}}),a(Ve),y(2),a(oe);var Re=i(oe,2);{var wt=t=>{var n=ba(),u=i(r(n),2),o=r(u);o.__click=()=>ye("");var f=r(o);Ge(f,{class:"h-5 w-5 text-base-content/50"}),y(2),a(o);var c=i(o,2);be(c,17,()=>e(U),fe,(m,x)=>{var _=pa();_.__click=()=>ye(e(x).id);var $=r(_);Ge($,{class:"h-5 w-5 text-primary"});var L=i($,2),D=r(L),J=r(D,!0);a(D);var K=i(D,2),pe=r(K,!0);a(K),a(L),a(_),T(()=>{Ue(_,1,`w-full p-3 rounded-lg border text-left transition-colors flex items-center gap-3 ${e(I)===e(x).id?"border-primary bg-primary/5":"border-base-300 hover:border-base-content/20"}`),k(J,e(x).name),k(pe,e(x).category)}),p(m,_)}),a(u),a(n),T(()=>Ue(o,1,`w-full p-3 rounded-lg border text-left transition-colors flex items-center gap-3 ${e(I)===""?"border-primary bg-primary/5":"border-base-300 hover:border-base-content/20"}`)),p(t,n)};P(Re,t=>{e(U).length>0&&t(wt)})}var ce=i(Re,2),qe=i(r(ce),2),de=r(qe),ze=r(de);z(ze),y(2),a(de);var Be=i(de,2),He=r(Be);z(He),y(2),a(Be),a(qe),a(ce);var ve=i(ce,2),$t=i(r(ve),2);A($t,{type:"email",placeholder:"your@email.com",get value(){return e(N)},set value(t){s(N,t,!0)}}),y(2),a(ve);var Tt=i(ve,2);zt(Tt,{get variables(){return at},get insertVariable(){return e(xe)}}),a(Ce),a(se);var Me=i(se,2),me=r(Me),St=r(me);Bt(St,{placeholder:"Start writing your campaign email...",showVariableInserts:!1,onInsertVariable:t=>s(xe,t,!0),class:"h-full",get value(){return e(w)},set value(t){s(w,t,!0)}}),a(me);var Oe=i(me,2),ue=r(Oe),Et=i(r(ue),2);Et.__click=ot,a(ue);var Lt=i(ue,2);Qt(Lt,{id:"plain-text",placeholder:"Auto-generated from HTML if left empty...",rows:4,get value(){return e(F)},set value(t){s(F,t,!0)}}),y(2),a(Oe),a(Me),a(Fe),a(E),a(d),Ht(Te,()=>e(B),t=>s(B,t)),We(ze,()=>e(Z),t=>s(Z,t)),We(He,()=>e(ee),t=>s(ee,t)),p(l,d)};P(ct,l=>{e(te)?l(dt):l(vt,!1)})}p(Ke,we),Ct(),et()}At(["click","change"]);export{Na as component};
