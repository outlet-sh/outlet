import"../chunks/Bzak7iHL.js";import{f as S,p as ot,d as p,j as ke,u as it,b as r,a as nt,h as ct,s as o,c as s,g as e,e as D,t as X,$ as dt,n as q,r as a}from"../chunks/Ip2DykXx.js";import{s as I}from"../chunks/DhOIAuLg.js";import{c as ie,a as i,f,t as j}from"../chunks/BPgbRZ5o.js";import{l as De,s as Ie,i as z}from"../chunks/BeCi3WIf.js";import{e as ut,i as vt}from"../chunks/-0-Kn73z.js";import{h as pt}from"../chunks/vHZS38u2.js";import{s as ft,a as mt}from"../chunks/CmyOW3uE.js";import{s as gt,a as _t}from"../chunks/ur54L5C-.js";import{p as $t}from"../chunks/BUZmhiZ9.js";import{g as me}from"../chunks/CDoCV2GU.js";import{Q as ht,D as xt,R as bt,S as yt,T as wt}from"../chunks/CtwFYI68.js";import{B as Z,e as qt,I as Le,g as St,A as Fe,D as Pt,S as Ct}from"../chunks/Bphptf_a.js";import{E as kt,a as Lt,S as Ft}from"../chunks/iYJsf80Y.js";import{L as Nt}from"../chunks/sFH_xjRy.js";import{S as Ne}from"../chunks/O0AiFkiq.js";import{B as ge}from"../chunks/CK6k7lQK.js";import{P as Te}from"../chunks/C0D2ZjIj.js";import{W as Ae}from"../chunks/CDCGORNv.js";import"../chunks/hUurZXsg.js";import{s as ze}from"../chunks/Df8mRDld.js";import{I as Ee}from"../chunks/CYeJYM_Q.js";import{C as Tt}from"../chunks/C65kbecp.js";import{T as At}from"../chunks/Boqopfmd.js";function Dt(M,k){const R=De(k,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.522.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const W=[["rect",{x:"14",y:"4",width:"4",height:"16",rx:"1"}],["rect",{x:"6",y:"4",width:"4",height:"16",rx:"1"}]];Ee(M,Ie({name:"pause"},()=>R,{get iconNode(){return W},children:(Q,G)=>{var $=ie(),b=S($);ze(b,k,"default",{}),i(Q,$)},$$slots:{default:!0}}))}function It(M,k){const R=De(k,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.522.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const W=[["polygon",{points:"6 3 20 12 6 21 6 3"}]];Ee(M,Ie({name:"play"},()=>R,{get iconNode(){return W},children:(Q,G)=>{var $=ie(),b=S($);ze(b,k,"default",{}),i(Q,$)},$$slots:{default:!0}}))}var zt=f("<!> New Sequence",1),Et=f("<p> </p>"),Ot=f("<!> <!>",1),Bt=f('<div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="seq-name" class="form-label">Name</label> <!></div> <div><label for="seq-slug" class="form-label">Slug</label> <!></div> <div><label for="seq-list" class="form-label">Email List</label> <!></div> <div><label for="seq-trigger" class="form-label">Trigger</label> <!></div> <div class="sm:col-span-2 flex items-center gap-3"><!> <span class="text-sm text-text">Active (starts enrolling subscribers immediately)</span></div></div>'),jt=f('<div class="flex justify-center py-12"><!></div>'),Mt=f("<p>You need at least one email list before creating sequences.</p> <!>",1),Rt=f("<!> Create Sequence",1),Wt=f('<div class="mb-4"><!></div>'),Qt=f('<tr class="svelte-fnt502"><td class="svelte-fnt502"><a class="block group"><div class="flex items-center gap-3"><div><!></div> <div class="min-w-0 flex-1"><span class="font-medium text-text group-hover:text-primary transition-colors block truncate"> </span> <span class="text-sm text-text-muted"> </span></div></div></a></td><td class="svelte-fnt502"><span class="text-text"> </span></td><td class="svelte-fnt502"><!></td><td class="text-center svelte-fnt502"><!></td><td class="text-right svelte-fnt502"><!></td></tr>'),Gt=f('<div class="text-center py-8 text-text-muted"> </div>'),Yt=f('<!> <div class="sequences-table svelte-fnt502"><table class="w-full"><thead class="svelte-fnt502"><tr><th class="text-left svelte-fnt502">Sequence</th><th class="text-left svelte-fnt502">List</th><th class="text-left svelte-fnt502">Trigger</th><th class="text-center svelte-fnt502">Status</th><th class="text-right w-10 svelte-fnt502"></th></tr></thead><tbody class="svelte-fnt502"></tbody></table></div> <!>',1),Ht=f('<div class="p-6 max-w-5xl mx-auto"><div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6"><div><h1 class="text-2xl font-semibold text-text">Sequences</h1> <p class="mt-1 text-sm text-text-muted">Automated email sequences triggered by events</p></div> <!></div> <!> <!> <!></div>');function $a(M,k){ot(k,!0);const R=()=>_t($t,"$page",W),[W,Q]=gt();let G=p(!0),$=p(ke([])),b=p(ke([])),P=p(""),E=p(""),Y=p(!1),H=p(!1),L=p(""),F=p(""),O=p(""),ee=p("signup"),te=p(!0),ae=D(()=>`/${R().params.orgSlug}`),_e=D(()=>e($).filter(t=>t.name.toLowerCase().includes(e(E).toLowerCase())||t.slug.toLowerCase().includes(e(E).toLowerCase())));it(()=>{re()});async function re(){r(G,!0),r(P,"");try{const[t,l]=await Promise.all([ht(),xt()]);r($,t.sequences||[],!0),r(b,l.lists||[],!0)}catch(t){console.error("Failed to load sequences:",t),r(P,"Failed to load sequences")}finally{r(G,!1)}}function $e(){var t;r(L,""),r(F,""),r(O,((t=e(b)[0])==null?void 0:t.id)||"",!0),r(ee,"signup"),r(te,!0),r(Y,!0)}function he(){r(Y,!1)}function Oe(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function Be(){r(F,Oe(e(L)),!0)}async function je(){if(!(!e(L)||!e(F)||!e(O))){r(H,!0),r(P,"");try{await bt({name:e(L),slug:e(F),list_id:e(O),trigger_event:e(ee),is_active:e(te),sequence_type:"lifecycle"}),he(),await re()}catch(t){console.error("Failed to create sequence:",t),r(P,t.message||"Failed to create sequence",!0)}finally{r(H,!1)}}}async function Me(t){if(confirm(`Delete "${t.name}"? This cannot be undone.`))try{await wt({},t.id),await re()}catch(l){console.error("Failed to delete sequence:",l),r(P,l.message||"Failed to delete sequence",!0)}}async function Re(t){try{await yt({},{is_active:!t.is_active},t.id),await re()}catch(l){console.error("Failed to toggle sequence:",l),r(P,l.message||"Failed to update sequence",!0)}}function We(t){switch(t){case"signup":return"On signup";case"purchase":return"On purchase";case"tag_added":return"Tag added";case"manual":return"Manual";default:return t}}var ne=Ht();pt("fnt502",t=>{ct(()=>{dt.title="Sequences | Outlet"})});var ce=s(ne),Qe=o(s(ce),2);{let t=D(()=>e(Y)||e(b).length===0);Z(Qe,{type:"primary",onclick:$e,get disabled(){return e(t)},children:(l,y)=>{var c=zt(),m=S(c);Te(m,{class:"mr-2 h-4 w-4"}),q(),i(l,c)},$$slots:{default:!0}})}a(ce);var xe=o(ce,2);{var Ge=t=>{Fe(t,{type:"error",title:"Error",class:"mb-4",children:(l,y)=>{var c=Et(),m=s(c,!0);a(c),X(()=>I(m,e(P))),i(l,c)},$$slots:{default:!0}})};z(xe,t=>{e(P)&&t(Ge)})}var be=o(xe,2);qt(be,{title:"Create New Sequence",get show(){return e(Y)},set show(l){r(Y,l,!0)},footer:l=>{var y=Ot(),c=S(y);Z(c,{type:"secondary",onclick:he,get disabled(){return e(H)},children:(u,g)=>{q();var N=j("Cancel");i(u,N)},$$slots:{default:!0}});var m=o(c,2);{let u=D(()=>!e(L)||!e(F)||!e(O)||e(H));Z(m,{type:"primary",onclick:je,get disabled(){return e(u)},children:(g,N)=>{q();var _=j();X(()=>I(_,e(H)?"Creating...":"Create Sequence")),i(g,_)},$$slots:{default:!0}})}i(l,y)},children:(l,y)=>{var c=Bt(),m=s(c),u=o(s(m),2);Le(u,{id:"seq-name",type:"text",oninput:Be,placeholder:"Welcome Series",get value(){return e(L)},set value(d){r(L,d,!0)}}),a(m);var g=o(m,2),N=o(s(g),2);Le(N,{id:"seq-slug",type:"text",placeholder:"welcome-series",get value(){return e(F)},set value(d){r(F,d,!0)}}),a(g);var _=o(g,2),J=o(s(_),2);{let d=D(()=>e(b).map(h=>({value:h.id,label:h.name})));Ne(J,{id:"seq-list",get options(){return e(d)},get value(){return e(O)},set value(h){r(O,h,!0)}})}a(_);var v=o(_,2),T=o(s(v),2);Ne(T,{id:"seq-trigger",options:[{value:"signup",label:"On signup"},{value:"purchase",label:"On purchase"},{value:"tag_added",label:"Tag added"},{value:"manual",label:"Manual enrollment"}],get value(){return e(ee)},set value(d){r(ee,d,!0)}}),a(v);var C=o(v,2),K=s(C);St(K,{get checked(){return e(te)},set checked(d){r(te,d,!0)}}),q(2),a(C),a(c),i(l,c)},$$slots:{footer:!0,default:!0}});var Ye=o(be,2);{var He=t=>{var l=jt(),y=s(l);Nt(y,{size:"large"}),a(l),i(t,l)},Je=t=>{var l=ie(),y=S(l);{var c=u=>{Fe(u,{type:"info",title:"Create a list first",children:(g,N)=>{var _=Mt(),J=o(S(_),2);Z(J,{type:"primary",class:"mt-3",onclick:()=>me(`${e(ae)}/lists`),children:(v,T)=>{q();var C=j("Go to Lists");i(v,C)},$$slots:{default:!0}}),i(g,_)},$$slots:{default:!0}})},m=u=>{var g=ie(),N=S(g);{var _=v=>{kt(v,{get icon(){return Ae},title:"No sequences yet",description:"Create automated email sequences to nurture your subscribers.",children:(T,C)=>{Z(T,{type:"primary",onclick:$e,children:(K,d)=>{var h=Rt(),se=S(h);Te(se,{class:"mr-2 h-4 w-4"}),q(),i(K,h)},$$slots:{default:!0}})},$$slots:{default:!0}})},J=v=>{var T=Yt(),C=S(T);{var K=w=>{var n=Wt(),A=s(n);Ct(A,{placeholder:"Search sequences...",get value(){return e(E)},set value(U){r(E,U,!0)}}),a(n),i(w,n)};z(C,w=>{e($).length>3&&w(K)})}var d=o(C,2),h=s(d),se=o(s(h));ut(se,21,()=>e(_e),vt,(w,n)=>{var A=Qt(),U=s(A),de=s(U),ye=s(de),le=s(ye);let we;var Ve=s(le);Ae(Ve,{class:"h-4 w-4"}),a(le);var qe=o(le,2),ue=s(qe),Xe=s(ue,!0);a(ue);var Se=o(ue,2),Ze=s(Se,!0);a(Se),a(qe),a(ye),a(de),a(U);var ve=o(U),Pe=s(ve),et=s(Pe,!0);a(Pe),a(ve);var pe=o(ve),tt=s(pe);ge(tt,{variant:"default",size:"sm",children:(x,B)=>{q();var oe=j();X(V=>I(oe,V),[()=>We(e(n).trigger_event)]),i(x,oe)},$$slots:{default:!0}}),a(pe);var fe=o(pe),at=s(fe);{var rt=x=>{ge(x,{variant:"success",size:"sm",children:(B,oe)=>{q();var V=j("Active");i(B,V)},$$slots:{default:!0}})},st=x=>{ge(x,{variant:"default",size:"sm",children:(B,oe)=>{q();var V=j("Paused");i(B,V)},$$slots:{default:!0}})};z(at,x=>{e(n).is_active?x(rt):x(st,!1)})}a(fe);var Ce=o(fe),lt=s(Ce);{let x=D(()=>({icon:Lt,class:"p-1.5 rounded-lg hover:bg-bg-secondary transition-colors text-text-muted hover:text-text"})),B=D(()=>[{label:"Edit",icon:Ft,onclick:()=>me(`${e(ae)}/sequences/${e(n).id}`)},{label:e(n).is_active?"Pause":"Activate",icon:e(n).is_active?Dt:It,onclick:()=>Re(e(n))},{label:"Duplicate",icon:Tt,onclick:()=>me(`${e(ae)}/sequences/new?duplicate=${e(n).id}`)},{divider:!0},{label:"Delete",icon:At,variant:"danger",onclick:()=>Me(e(n))}]);Pt(lt,{get trigger(){return e(x)},get items(){return e(B)}})}a(Ce),a(A),X(()=>{ft(de,"href",`${e(ae)??""}/sequences/${e(n).id??""}`),we=mt(le,1,"sequences-icon svelte-fnt502",null,we,{active:e(n).is_active}),I(Xe,e(n).name),I(Ze,e(n).slug),I(et,e(n).list_name||"-")}),i(w,A)}),a(se),a(h),a(d);var Ke=o(d,2);{var Ue=w=>{var n=Gt(),A=s(n);a(n),X(()=>I(A,`No sequences match "${e(E)??""}"`)),i(w,n)};z(Ke,w=>{e(E)&&e(_e).length===0&&w(Ue)})}i(v,T)};z(N,v=>{e($).length===0?v(_):v(J,!1)},!0)}i(u,g)};z(y,u=>{e(b).length===0?u(c):u(m,!1)},!0)}i(t,l)};z(Ye,t=>{e(G)?t(He):t(Je,!1)})}a(ne),i(M,ne),nt(),Q()}export{$a as component};
