import"../chunks/DsnmJJEf.js";import{p as De,s as _,a as Fe,u as je,b as a,f as T,d as ze,h as i,c as s,i as e,t as B,j as k,n as b,r}from"../chunks/DDjrJUyi.js";import{s as I}from"../chunks/CwHIudaz.js";import{f as h,a as n,t as E,c as Me}from"../chunks/DbkN8AN9.js";import{i as O}from"../chunks/CGvWOYBA.js";import{e as Ne,s as Be,a as Ie,i as Oe}from"../chunks/aSjiVL0V.js";import{s as We,a as Ge}from"../chunks/Bcmc20em.js";import{p as He}from"../chunks/Bmxv2sD2.js";import{g as Je}from"../chunks/COzNDyHQ.js";import{D as Ke,E as Qe,F as Re,G as Ue}from"../chunks/yWEY6ChK.js";import{B as W,M as Ve,I as ne,S as Xe,l as Ye,A as Ze,D as et}from"../chunks/Bkv3Tidq.js";import{E as tt}from"../chunks/B00BxIdJ.js";import{L as at}from"../chunks/BWhLmYGf.js";import{B as R}from"../chunks/42UF-HRp.js";import{g as rt}from"../chunks/BJzuI-Pd.js";import{P as de}from"../chunks/BPUqRg7c.js";import{W as ce}from"../chunks/HehHO9yq.js";import{E as st}from"../chunks/DTO2YoPM.js";import{S as ot}from"../chunks/BRZEcUHv.js";import{P as lt,a as it}from"../chunks/BTJkFoQ_.js";import{T as nt}from"../chunks/DxriTNl7.js";var dt=h("<p> </p>"),ct=h("<!> New Autoresponder",1),ut=h('<div class="flex justify-center py-12"><!></div>'),vt=h("<!> Create Autoresponder",1),pt=h('<tr><td><a class="block group"><div class="flex items-center gap-3"><div><!></div> <div><span class="font-medium text-text group-hover:text-primary transition-colors"> </span></div></div></a></td><td><!></td><td class="text-center"><!></td><td class="text-right"><!></td></tr>'),mt=h('<div class="data-table"><table class="w-full"><thead><tr><th class="text-left">Autoresponder</th><th class="text-left">Trigger</th><th class="text-center">Status</th><th class="text-right w-10"></th></tr></thead><tbody></tbody></table></div>'),ft=h("<!> <!>",1),gt=h('<div class="space-y-4"><div><label for="seq-name" class="form-label">Name</label> <!></div> <div><label for="seq-slug" class="form-label">Slug</label> <!></div> <div><label for="seq-trigger" class="form-label">Trigger</label> <!></div> <div class="flex items-center gap-3"><!> <span class="text-sm text-text">Active</span></div></div>'),_t=h('<!> <div class="flex justify-between items-center mb-4"><p class="text-sm text-text-muted">Automated email sequences triggered when subscribers join this list.</p> <!></div> <!> <!>',1);function Bt(ue,ve){De(ve,!0);const U=()=>Ge(He,"$page",pe),[pe,me]=We();rt();let L=k(()=>U().params.id),V=k(()=>`/${U().params.orgSlug}`),X=_(Fe([])),G=_(!0),S=_(!1),A=_(!1),x=_(""),y=_(""),D=_("signup"),F=_(!0),q=_(""),Y=k(()=>e(X).filter(t=>t.list_id===e(L)));je(()=>{j()});async function j(){a(G,!0);try{const t=await Ke();a(X,t.sequences||[],!0)}catch(t){console.error("Failed to load sequences:",t)}finally{a(G,!1)}}function fe(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function ge(){a(y,fe(e(x)),!0)}function Z(){a(x,""),a(y,""),a(D,"signup"),a(F,!0),a(S,!0)}async function _e(){if(!(!e(x)||!e(y))){a(A,!0),a(q,"");try{await Qe({name:e(x),slug:e(y),list_id:e(L),trigger_event:e(D),is_active:e(F),sequence_type:"lifecycle"}),a(S,!1),await j()}catch(t){a(q,t.message||"Failed to create autoresponder",!0)}finally{a(A,!1)}}}async function he(t){if(confirm(`Delete "${t.name}"? This cannot be undone.`))try{await Ue({},t.id),await j()}catch(o){a(q,o.message||"Failed to delete autoresponder",!0)}}async function $e(t){try{await Re({},{is_active:!t.is_active},t.id),await j()}catch(o){a(q,o.message||"Failed to update autoresponder",!0)}}function be(t){switch(t){case"signup":return"On signup";case"purchase":return"On purchase";case"tag_added":return"Tag added";case"manual":return"Manual";default:return t}}var ee=_t(),te=T(ee);{var xe=t=>{Ze(t,{type:"error",title:"Error",class:"mb-4",children:(o,v)=>{var d=dt(),g=s(d,!0);r(d),B(()=>I(g,e(q))),n(o,d)},$$slots:{default:!0}})};O(te,t=>{e(q)&&t(xe)})}var H=i(te,2),ye=i(s(H),2);W(ye,{type:"primary",onclick:Z,get disabled(){return e(S)},children:(t,o)=>{var v=ct(),d=T(v);de(d,{class:"mr-2 h-4 w-4"}),b(),n(t,v)},$$slots:{default:!0}}),r(H);var ae=i(H,2);{var we=t=>{var o=ut(),v=s(o);at(v,{}),r(o),n(t,o)},Se=t=>{var o=Me(),v=T(o);{var d=c=>{tt(c,{get icon(){return ce},title:"No autoresponders yet",description:"Create an autoresponder to automatically send emails when subscribers join this list.",children:(u,$)=>{W(u,{type:"primary",onclick:Z,children:(p,z)=>{var l=vt(),w=T(l);de(w,{class:"mr-2 h-4 w-4"}),b(),n(p,l)},$$slots:{default:!0}})},$$slots:{default:!0}})},g=c=>{var u=mt(),$=s(u),p=i(s($));Ne(p,21,()=>e(Y),Oe,(z,l)=>{var w=pt(),m=s(w),J=s(m),re=s(J),M=s(re);let se;var Pe=s(M);ce(Pe,{class:"h-4 w-4"}),r(M);var oe=i(M,2),le=s(oe),ke=s(le,!0);r(le),r(oe),r(re),r(J),r(m);var K=i(m),Ae=s(K);R(Ae,{variant:"default",size:"sm",children:(f,P)=>{b();var N=E();B(C=>I(N,C),[()=>be(e(l).trigger_event)]),n(f,N)},$$slots:{default:!0}}),r(K);var Q=i(K),Ce=s(Q);{var Te=f=>{R(f,{variant:"success",size:"sm",children:(P,N)=>{b();var C=E("Active");n(P,C)},$$slots:{default:!0}})},Ee=f=>{R(f,{variant:"default",size:"sm",children:(P,N)=>{b();var C=E("Paused");n(P,C)},$$slots:{default:!0}})};O(Ce,f=>{e(l).is_active?f(Te):f(Ee,!1)})}r(Q);var ie=i(Q),Le=s(ie);{let f=k(()=>({icon:st,class:"p-1.5 rounded-lg hover:bg-bg-secondary transition-colors text-text-muted hover:text-text"})),P=k(()=>[{label:"Edit",icon:ot,onclick:()=>Je(`${e(V)}/lists/${e(L)}/autoresponders/${e(l).id}`)},{label:e(l).is_active?"Pause":"Activate",icon:e(l).is_active?lt:it,onclick:()=>$e(e(l))},{divider:!0},{label:"Delete",icon:nt,variant:"danger",onclick:()=>he(e(l))}]);et(Le,{get trigger(){return e(f)},get items(){return e(P)}})}r(ie),r(w),B(()=>{Be(J,"href",`${e(V)??""}/lists/${e(L)??""}/autoresponders/${e(l).id??""}`),se=Ie(M,1,"data-table-icon",null,se,{active:e(l).is_active}),I(ke,e(l).name)}),n(z,w)}),r(p),r($),r(u),n(c,u)};O(v,c=>{e(Y).length===0?c(d):c(g,!1)},!0)}n(t,o)};O(ae,t=>{e(G)?t(we):t(Se,!1)})}var qe=i(ae,2);Ve(qe,{title:"Create Autoresponder",size:"md",get show(){return e(S)},set show(o){a(S,o,!0)},footer:o=>{var v=ft(),d=T(v);W(d,{type:"secondary",onclick:()=>a(S,!1),get disabled(){return e(A)},children:(c,u)=>{b();var $=E("Cancel");n(c,$)},$$slots:{default:!0}});var g=i(d,2);{let c=k(()=>!e(x)||!e(y)||e(A));W(g,{type:"primary",onclick:_e,get disabled(){return e(c)},children:(u,$)=>{b();var p=E();B(()=>I(p,e(A)?"Creating...":"Create")),n(u,p)},$$slots:{default:!0}})}n(o,v)},children:(o,v)=>{var d=gt(),g=s(d),c=i(s(g),2);ne(c,{id:"seq-name",type:"text",oninput:ge,placeholder:"Welcome Series",get value(){return e(x)},set value(m){a(x,m,!0)}}),r(g);var u=i(g,2),$=i(s(u),2);ne($,{id:"seq-slug",type:"text",placeholder:"welcome-series",get value(){return e(y)},set value(m){a(y,m,!0)}}),r(u);var p=i(u,2),z=i(s(p),2);Xe(z,{id:"seq-trigger",options:[{value:"signup",label:"On signup"},{value:"manual",label:"Manual enrollment"}],get value(){return e(D)},set value(m){a(D,m,!0)}}),r(p);var l=i(p,2),w=s(l);Ye(w,{get checked(){return e(F)},set checked(m){a(F,m,!0)}}),b(2),r(l),r(d),n(o,d)},$$slots:{footer:!0,default:!0}}),n(ue,ee),ze(),me()}export{Bt as component};
