import"../chunks/DsnmJJEf.js";import{p as ft,s as h,a as pt,u as _t,b as s,i as e,f as D,d as gt,j as U,m as ht,g as bt,h as o,c as a,r as t,t as q,n as p}from"../chunks/odI--4Kw.js";import{d as xt,s as P}from"../chunks/BNMK9zrr.js";import{a as l,f as m,t as H,c as $e}from"../chunks/CCInJaqd.js";import{i as y}from"../chunks/COaB7F5h.js";import{e as Ue,i as yt}from"../chunks/BohEjZuL.js";import{h as wt}from"../chunks/hUjpWz_l.js";import{s as $t,a as kt}from"../chunks/DL1yFSKa.js";import{p as St}from"../chunks/CcNWg8o8.js";import{j as Ct,S as Dt,k as Ft,T as Nt,U as Pt}from"../chunks/G69xwvxa.js";import{g as It}from"../chunks/DRwkulH3.js";import{A as jt,C as ke,I as Se,h as We,B as Ae,f as Bt}from"../chunks/D2QCw2Hn.js";import{L as Ke}from"../chunks/D716f0vp.js";import{S as Et}from"../chunks/B3kfFKjl.js";import{B as Ce}from"../chunks/BD7k7D4N.js";import{M as Tt}from"../chunks/Buemz3kE.js";import{C as Le}from"../chunks/lH5_4V3e.js";import{S as De}from"../chunks/CkvHPP2_.js";import{R as qe}from"../chunks/Cqz6JMS0.js";var zt=m("<p> </p>"),Rt=m('<div class="flex items-center gap-2 text-green-600"><!> <span class="text-sm font-medium">Configured</span></div>'),Mt=m('<div class="flex items-center gap-2 text-text-muted"><!> <span class="text-sm">Using defaults</span></div>'),Vt=m(`<div class="card-header"><h2 class="card-title">Sender Identity</h2> <p class="card-subtitle">Configure how your emails appear to recipients</p></div> <div class="border border-border rounded-lg"><div class="p-4 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="card-section-title">Email Sender</h3> <p class="card-section-subtitle"><!></p></div></div> <div class="flex items-center gap-2"><!></div></div> <div class="border-t border-border p-4 bg-bg-secondary"><div class="space-y-4 max-w-lg"><div><label for="from-name" class="form-label">From Name</label> <!> <p class="mt-1 text-xs text-text-muted">The name shown in the recipient's inbox</p></div> <div><label for="from-email" class="form-label">From Email</label> <!> <p class="mt-1 text-xs text-text-muted">Must be a verified email address with your email provider</p></div> <div><label for="reply-to" class="form-label">Reply-To Email</label> <!> <p class="mt-1 text-xs text-text-muted">Where replies will be sent (optional, defaults to From Email)</p></div> <div class="flex justify-end gap-3 pt-2"><!></div></div></div></div>`,1),Ut=m("<!> <span>Setting up...</span>",1),Wt=m("<!> <span>Verify Domain</span>",1),At=m('<div class="border border-border rounded-lg p-6 text-center"><div class="w-12 h-12 mx-auto bg-base-200 rounded-lg flex items-center justify-center mb-4"><!></div> <h3 class="text-base font-medium mb-2">No domains configured</h3> <p class="text-sm text-base-content/60 mb-4"><!></p> <!></div>'),Kt=m("<!> <span>Checking...</span>",1),Lt=m("<!> <span>Refresh</span>",1),qt=m('<tr><td><!></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all"> </code></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all max-w-xs block overflow-hidden text-ellipsis"> </code></td><td><span class="text-xs text-base-content/60 capitalize"> </span></td><td><button class="btn btn-ghost btn-xs" title="Copy value"><!></button></td></tr>'),Ht=m('<div class="p-4"><div class="flex items-center gap-2 mb-3"><!> <span class="text-sm font-medium">Add these DNS records to your domain</span></div> <div class="overflow-x-auto"><table class="table table-sm w-full"><thead><tr><th class="text-xs font-medium text-base-content/60 uppercase">Type</th><th class="text-xs font-medium text-base-content/60 uppercase">Name/Host</th><th class="text-xs font-medium text-base-content/60 uppercase">Value</th><th class="text-xs font-medium text-base-content/60 uppercase">Purpose</th><th class="w-10"></th></tr></thead><tbody></tbody></table></div> <div class="mt-4 p-3 bg-info/10 rounded-lg"><p class="text-xs text-info"><strong>Note:</strong> DNS changes can take up to 72 hours to propagate. Click "Refresh" to check verification status.</p></div></div>'),Ot=m('<div class="border border-border rounded-lg overflow-hidden mb-4 last:mb-0"><div class="p-4 flex items-center justify-between bg-base-200/50"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="font-medium"> </h3> <div class="flex items-center gap-2 mt-1"><span class="text-xs text-base-content/60">Verification:</span> <!> <span class="text-xs text-base-content/60 ml-2">DKIM:</span> <!></div></div></div> <!></div> <!></div>'),Yt=m('<div class="card-header"><h2 class="card-title">Domain Verification</h2> <p class="card-subtitle">Verify your domain to improve email deliverability and enable DKIM signing</p></div> <!>',1),Gt=m(`<div class="flex items-start gap-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div><h3 class="card-title">How it works</h3> <p class="card-subtitle">These settings are used as defaults for all emails sent from this brand, including campaigns, sequences, and transactional emails.
						You can override these settings on a per-campaign or per-sequence basis.</p></div></div>`),Jt=m('<div class="space-y-6"><!> <!> <!></div>'),Qt=m("<!> <!>",1);function ha(He,Oe){ft(Oe,!0);const Ye=()=>kt(St,"$page",Ge),[Ge,Je]=$t();let Fe=U(()=>Ye().params.brandSlug),re=h(!0),me=h(!1),se=h(!1),n=h(null),b=h(""),w=h(pt([])),ie=h(null),oe=h(!1),ue=h(null),Q=h(""),W=h(""),X=h(""),fe=null;_t(()=>(pe(),()=>{fe&&fe()}));function Qe(r){const c=It();c.isConnected()||c.connect(),c.send("subscribe",{org_id:r});const I=c.on("domain_identity_update",_=>{console.log("[WebSocket] Domain identity update received:",_),s(w,e(w).map(F=>F.id===_.id?{...F,verification_status:_.verification_status,dkim_status:_.dkim_status,mail_from_status:_.mail_from_status,last_checked_at:_.last_checked_at}:F),!0)}),j=c.on("domain_identity_created",_=>{console.log("[WebSocket] Domain identity created:",_),pe()});fe=()=>{I(),j()}}async function pe(){s(re,!0),s(b,"");try{if(!e(Fe)){s(b,"No brand selected"),s(re,!1);return}s(n,await Ct({},e(Fe)),!0),Qe(e(n).id),s(Q,e(n).from_name||"",!0),s(W,e(n).from_email||"",!0),s(X,e(n).reply_to||"",!0);try{const r=await Dt({},e(n).id);s(w,r.identities||[],!0)}catch(r){console.error("Failed to load domain identities:",r),s(w,[],!0)}}catch(r){console.error("Failed to load data:",r),s(b,r.message||"Failed to load data",!0)}finally{s(re,!1)}}async function Xe(){if(e(n)){s(oe,!0),s(b,"");try{const r=await Pt({},{domain:""},e(n).id);s(w,[...e(w),r],!0)}catch(r){console.error("Failed to create domain identity:",r),s(b,r.message||"Failed to create domain identity",!0)}finally{s(oe,!1)}}}async function Ze(r){if(e(n)){s(ie,r,!0),s(b,"");try{const c=await Nt({},e(n).id,r);s(w,e(w).map(I=>I.id===r?c:I),!0)}catch(c){console.error("Failed to refresh domain identity:",c),s(b,c.message||"Failed to refresh domain identity",!0)}finally{s(ie,null)}}}function et(r,c){navigator.clipboard.writeText(r),s(ue,c,!0),setTimeout(()=>{s(ue,null)},2e3)}function Ne(r){switch(r){case"Success":case"success":return{variant:"success",label:"Verified"};case"Pending":case"pending":return{variant:"warning",label:"Pending"};case"Failed":case"failed":case"temporary_failure":return{variant:"error",label:"Failed"};case"not_started":case"NotStarted":return{variant:"default",label:"Not Started"};default:return{variant:"default",label:r||"Unknown"}}}async function tt(){if(e(n)){s(me,!0),s(se,!1),s(b,"");try{await Ft({},{from_name:e(Q)||void 0,from_email:e(W)||void 0,reply_to:e(X)||void 0},e(n).id),s(se,!0),setTimeout(()=>{s(se,!1)},2e3),await pe()}catch(r){console.error("Failed to save email settings:",r),s(b,r.message||"Failed to save email settings",!0)}finally{s(me,!1)}}}let at=U(()=>e(n)&&(e(Q)!==(e(n).from_name||"")||e(W)!==(e(n).from_email||"")||e(X)!==(e(n).reply_to||""))),Pe=U(()=>e(n)?.from_name||e(n)?.from_email);var Ie=Qt();wt("1fr6do4",r=>{ht(()=>{bt.title=`Email Settings - ${(e(n)?.name||"Loading")??""}`})});var je=D(Ie);{var rt=r=>{jt(r,{type:"error",title:"Error",children:(c,I)=>{var j=zt(),_=a(j,!0);t(j),q(()=>P(_,e(b))),l(c,j)},$$slots:{default:!0}})};y(je,r=>{e(b)&&r(rt)})}var st=o(je,2);{var it=r=>{Ke(r,{size:"large"})},ot=r=>{var c=Jt(),I=a(c);ke(I,{children:(F,Be)=>{var A=Vt(),le=o(D(A),2),Z=a(le),ee=a(Z),$=a(ee),B=a($);Tt(B,{class:"h-6 w-6 text-blue-600"}),t($);var E=o($,2),T=o(a(E),2),u=a(T);{var O=i=>{var d=H();q(()=>P(d,`${(e(n)?.from_name||"No name")??""} <${(e(n)?.from_email||"No email")??""}>`)),l(i,d)},Y=i=>{var d=H("Not configured - using platform defaults");l(i,d)};y(u,i=>{e(Pe)?i(O):i(Y,!1)})}t(T),t(E),t(ee);var z=o(ee,2),K=a(z);{var L=i=>{var d=Rt(),f=a(d);We(f,{class:"h-5 w-5"}),p(2),t(d),l(i,d)},v=i=>{var d=Mt(),f=a(d);Le(f,{class:"h-5 w-5"}),p(2),t(d),l(i,d)};y(K,i=>{e(Pe)?i(L):i(v,!1)})}t(z),t(Z);var k=o(Z,2),G=a(k),S=a(G),te=o(a(S),2);Se(te,{id:"from-name",type:"text",placeholder:"Acme Inc",get value(){return e(Q)},set value(i){s(Q,i,!0)}}),p(2),t(S);var R=o(S,2),J=o(a(R),2);Se(J,{id:"from-email",type:"email",placeholder:"hello@yourdomain.com",get value(){return e(W)},set value(i){s(W,i,!0)}}),p(2),t(R);var g=o(R,2),N=o(a(g),2);Se(N,{id:"reply-to",type:"email",placeholder:"support@yourdomain.com",get value(){return e(X)},set value(i){s(X,i,!0)}}),p(2),t(g);var M=o(g,2),_e=a(M);{let i=U(()=>!e(at));Et(_e,{label:"Save Settings",get saving(){return e(me)},get saved(){return e(se)},onclick:tt,get disabled(){return e(i)}})}t(M),t(G),t(k),t(le),l(F,A)},$$slots:{default:!0}});var j=o(I,2);ke(j,{children:(F,Be)=>{var A=Yt(),le=o(D(A),2);{var Z=$=>{var B=At(),E=a(B),T=a(E);De(T,{class:"h-6 w-6 text-base-content/50"}),t(E);var u=o(E,4),O=a(u);{var Y=v=>{var k=H("Set your From Email above first, then verify your domain.");l(v,k)},z=v=>{var k=H("Verify your domain to authenticate emails and improve deliverability.");l(v,k)};y(O,v=>{e(W)?v(z,!1):v(Y)})}t(u);var K=o(u,2);{var L=v=>{Ae(v,{variant:"primary",onclick:Xe,get disabled(){return e(oe)},children:(k,G)=>{var S=$e(),te=D(S);{var R=g=>{var N=Ut(),M=D(N);Ke(M,{size:"normal"}),p(2),l(g,N)},J=g=>{var N=Wt(),M=D(N);De(M,{class:"h-4 w-4"}),p(2),l(g,N)};y(te,g=>{e(oe)?g(R):g(J,!1)})}l(k,S)},$$slots:{default:!0}})};y(K,v=>{e(W)&&v(L)})}t(B),l($,B)},ee=$=>{var B=$e(),E=D(B);Ue(E,17,()=>e(w),T=>T.id,(T,u)=>{const O=U(()=>Ne(e(u).verification_status)),Y=U(()=>Ne(e(u).dkim_status));var z=Ot(),K=a(z),L=a(K),v=a(L),k=a(v);De(k,{class:"h-5 w-5 text-primary"}),t(v);var G=o(v,2),S=a(G),te=a(S,!0);t(S);var R=o(S,2),J=o(a(R),2);Ce(J,{get variant(){return e(O).variant},size:"sm",children:(i,d)=>{p();var f=H();q(()=>P(f,e(O).label)),l(i,f)},$$slots:{default:!0}});var g=o(J,4);Ce(g,{get variant(){return e(Y).variant},size:"sm",children:(i,d)=>{p();var f=H();q(()=>P(f,e(Y).label)),l(i,f)},$$slots:{default:!0}}),t(R),t(G),t(L);var N=o(L,2);{let i=U(()=>e(ie)!==null);Ae(N,{variant:"ghost",size:"sm",onclick:()=>Ze(e(u).id),get disabled(){return e(i)},children:(d,f)=>{var ne=$e(),de=D(ne);{var ce=V=>{var x=Kt(),ae=D(x);qe(ae,{class:"h-4 w-4 animate-spin"}),p(2),l(V,x)},ve=V=>{var x=Lt(),ae=D(x);qe(ae,{class:"h-4 w-4"}),p(2),l(V,x)};y(de,V=>{e(ie)===e(u).id?V(ce):V(ve,!1)})}l(d,ne)},$$slots:{default:!0}})}t(K);var M=o(K,2);{var _e=i=>{var d=Ht(),f=a(d),ne=a(f);Le(ne,{class:"h-4 w-4 text-warning"}),p(2),t(f);var de=o(f,2),ce=a(de),ve=o(a(ce));Ue(ve,21,()=>e(u).dns_records,yt,(V,x,ae)=>{const Ee=U(()=>`${e(u).id}-${ae}`);var ge=qt(),he=a(ge),lt=a(he);Ce(lt,{variant:"default",size:"sm",children:(C,Xt)=>{p();var Ve=H();q(()=>P(Ve,e(x).type)),l(C,Ve)},$$slots:{default:!0}}),t(he);var be=o(he),Te=a(be),nt=a(Te,!0);t(Te),t(be);var xe=o(be),ze=a(xe),dt=a(ze,!0);t(ze),t(xe);var ye=o(xe),Re=a(ye),ct=a(Re,!0);t(Re),t(ye);var Me=o(ye),we=a(Me);we.__click=()=>et(e(x).value,e(Ee));var vt=a(we);{var mt=C=>{We(C,{class:"h-3 w-3 text-success"})},ut=C=>{Bt(C,{class:"h-3 w-3"})};y(vt,C=>{e(ue)===e(Ee)?C(mt):C(ut,!1)})}t(we),t(Me),t(ge),q(C=>{P(nt,e(x).name),P(dt,e(x).value),P(ct,C)},[()=>e(x).purpose.replace(/_/g," ")]),l(V,ge)}),t(ve),t(ce),t(de),p(2),t(d),l(i,d)};y(M,i=>{e(u).dns_records&&e(u).dns_records.length>0&&i(_e)})}t(z),q(()=>P(te,e(u).domain)),l(T,z)}),l($,B)};y(le,$=>{e(w).length===0?$(Z):$(ee,!1)})}l(F,A)},$$slots:{default:!0}});var _=o(j,2);ke(_,{children:(F,Be)=>{var A=Gt();l(F,A)},$$slots:{default:!0}}),t(c),l(r,c)};y(st,r=>{e(re)?r(it):r(ot,!1)})}l(He,Ie),gt(),Je()}xt(["click"]);export{ha as component};
