import"../chunks/DsnmJJEf.js";import{p as et,s as _,a as ee,u as tt,b as l,d as at,e as rt,i as e,j as te,c as s,h as t,g as st,n as w,r,t as H,f as A}from"../chunks/DDjrJUyi.js";import{d as lt,s as L}from"../chunks/CwHIudaz.js";import{f as x,a as u,t as Pe}from"../chunks/DbkN8AN9.js";import{i as O}from"../chunks/CGvWOYBA.js";import{e as xe,r as Se,b as Le,i as _e,a as Ee}from"../chunks/aSjiVL0V.js";import{h as ot}from"../chunks/DHP91Nzo.js";import{s as it,a as nt}from"../chunks/Bcmc20em.js";import{p as dt}from"../chunks/BtCD1IG0.js";import{g as be}from"../chunks/C_3eB2yc.js";import{w as ct,x as vt,y as mt}from"../chunks/yWEY6ChK.js";import{B as ae,A as ut,C as q,I as J,H as pt,c as je,F as Ae}from"../chunks/DkmOYVX9.js";import{L as xt}from"../chunks/BWhLmYGf.js";import{T as _t}from"../chunks/CB6sYNl9.js";import{A as bt}from"../chunks/D3Mqpf1w.js";import{S as ft}from"../chunks/wi6q-NiZ.js";var gt=x("<p> </p>"),ht=x('<div class="flex justify-center py-12"><!></div>'),$t=x('<h2 class="text-lg font-medium mb-4">Campaign Details</h2> <div class="space-y-4"><!> <!> <!></div>',1),yt=x(`<h2 class="text-lg font-medium mb-4">Sender Details</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!> <!> <!></div> <p class="text-xs text-text-muted mt-2">Leave blank to use your organization's default sender settings.</p>`,1),kt=x('<p class="text-text-muted">No lists available. Create a list first to send campaigns.</p>'),wt=x('<label class="flex items-center gap-3 p-3 rounded-lg border border-base-300 hover:bg-base-200 cursor-pointer transition-colors"><input type="checkbox" class="checkbox checkbox-primary checkbox-sm"/> <div class="flex-1 min-w-0"><span class="font-medium text-text block truncate"> </span> <span class="text-xs text-text-muted"> </span></div></label>'),Tt=x('<p class="text-sm text-text-muted mt-2">Total recipients: <strong class="text-text"> </strong></p>'),Ct=x('<label class="flex items-center gap-3 p-3 rounded-lg border border-base-300 hover:bg-base-200 cursor-pointer transition-colors"><input type="checkbox" class="checkbox checkbox-warning checkbox-sm"/> <div class="flex-1 min-w-0"><span class="font-medium text-text block truncate"> </span> <span class="text-xs text-text-muted"> </span></div></label>'),Pt=x('<div><label class="label"><span class="label-text font-medium">Exclude subscribers from these lists (optional)</span></label> <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2"></div></div>'),St=x('<div class="space-y-4"><div><label class="label"><span class="label-text font-medium">Send to these lists</span></label> <div class="grid grid-cols-1 md:grid-cols-2 gap-2 mt-2"></div> <!></div> <!></div>'),Lt=x('<h2 class="text-lg font-medium mb-4">Recipients</h2> <!>',1),Et=x('<button type="button"><!> <span class="font-medium text-text block truncate"> </span> <span class="text-xs text-text-muted"> </span></button>'),jt=x('<h2 class="text-lg font-medium mb-4">Start from Template</h2> <div class="grid grid-cols-1 md:grid-cols-3 gap-3"><button type="button"><!> <span class="font-medium text-text block">Blank</span> <span class="text-xs text-text-muted">Start from scratch</span></button> <!></div>',1),At=x('<h2 class="text-lg font-medium mb-4">Email Content</h2> <div class="space-y-4"><div><label class="label"><span class="label-text font-medium">HTML Content</span></label> <!></div> <div><div class="flex items-center justify-between mb-2"><label class="label"><span class="label-text font-medium">Plain Text Version</span></label> <!></div> <!> <p class="text-xs text-text-muted mt-1">Optional. A plain text version will be auto-generated if not provided.</p></div></div>',1),Ft=x('<h2 class="text-lg font-medium mb-4">Tracking</h2> <div class="space-y-3"><!> <p class="text-xs text-text-muted ml-6 -mt-1">Adds a tracking pixel to measure how many recipients open the email.</p> <!> <p class="text-xs text-text-muted ml-6 -mt-1">Wraps links to track which links are clicked.</p></div>',1),Nt=x(`<h2 class="text-lg font-medium mb-4">Available Template Tags</h2> <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm"><div><code class="bg-base-200 px-2 py-1 rounded text-xs"></code> <span class="text-text-muted ml-2">Subscriber's email</span></div> <div><code class="bg-base-200 px-2 py-1 rounded text-xs"></code> <span class="text-text-muted ml-2">Subscriber's name</span></div> <div><code class="bg-base-200 px-2 py-1 rounded text-xs"></code> <span class="text-text-muted ml-2">Unsubscribe link</span></div> <div><code class="bg-base-200 px-2 py-1 rounded text-xs"></code> <span class="text-text-muted ml-2">Web version link</span></div></div>`,1),Dt=x("<!> ",1),Ht=x('<div class="space-y-6"><!> <!> <!> <!> <!> <!> <!> <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t border-base-300"><!> <div class="flex-1"></div> <!></div></div>'),qt=x('<div class="p-6 max-w-5xl mx-auto"><div class="flex items-center gap-4 mb-6"><!> <div class="flex-1"><h1 class="text-2xl font-semibold text-text">New Campaign</h1> <p class="mt-1 text-sm text-text-muted">Create and send an email campaign to your subscribers</p></div></div> <!> <!></div>');function ea(Fe,Ne){et(Ne,!0);const De=()=>nt(dt,"$page",He),[He,qe]=it();let U=_(""),K=_(""),re=_(""),se=_(""),le=_(""),oe=_(""),z=_(""),V=_(""),ie=_(!0),ne=_(!0),g=_(ee([])),E=_(ee([])),Q=_(""),B=_(ee([])),X=_(ee([])),de=_(!0),Y=_(!1),j=_(""),ce=te(()=>`/${De().params.orgSlug}`),ze=te(()=>()=>e(B).filter(a=>e(g).includes(a.id)).reduce((a,o)=>a+o.subscriber_count,0)),fe=te(()=>()=>e(U).trim()!==""&&e(K).trim()!==""&&e(z).trim()!==""&&e(g).length>0);tt(()=>{Be()});async function Be(){l(de,!0),l(j,"");try{const[a,o]=await Promise.all([ct(),vt({})]);l(B,a.lists||[],!0),l(X,(o.designs||[]).filter(y=>y.is_active),!0)}catch(a){console.error("Failed to load data:",a),l(j,"Failed to load lists and templates")}finally{l(de,!1)}}function ge(a){if(l(Q,a,!0),a){const o=e(X).find(y=>y.id===a);o&&(l(z,o.html_body,!0),o.plain_text&&l(V,o.plain_text,!0))}}function Me(a){e(g).includes(a)?l(g,e(g).filter(o=>o!==a),!0):l(g,[...e(g),a],!0)}function Re(a){e(E).includes(a)?l(E,e(E).filter(o=>o!==a),!0):l(E,[...e(E),a],!0)}async function Oe(a=!1){if(!e(fe)()){l(j,"Please fill in all required fields");return}l(Y,!0),l(j,"");try{const o={name:e(U).trim(),subject:e(K).trim(),preview_text:e(re).trim()||void 0,from_name:e(se).trim()||void 0,from_email:e(le).trim()||void 0,reply_to:e(oe).trim()||void 0,html_body:e(z),plain_text:e(V).trim()||void 0,list_ids:e(g),exclude_list_ids:e(E).length>0?e(E):void 0,track_opens:e(ie),track_clicks:e(ne),design_id:e(Q)||void 0},y=await mt(o);be(`${e(ce)}/campaigns/${y.id}`)}catch(o){console.error("Failed to save campaign:",o),l(j,o.message||"Failed to save campaign",!0)}finally{l(Y,!1)}}function Je(){const a=document.createElement("div");a.innerHTML=e(z),l(V,a.textContent||a.innerText||"",!0)}var ve=qt();ot("rx4ktf",a=>{rt(()=>{st.title="New Campaign | Outlet"})});var me=s(ve),Ve=s(me);ae(Ve,{type:"ghost",size:"sm",onclick:()=>be(`${e(ce)}/campaigns`),children:(a,o)=>{bt(a,{class:"h-4 w-4"})},$$slots:{default:!0}}),w(2),r(me);var he=t(me,2);{var We=a=>{ut(a,{type:"error",title:"Error",class:"mb-6",onclose:()=>l(j,""),children:(o,y)=>{var M=gt(),Z=s(M,!0);r(M),H(()=>L(Z,e(j))),u(o,M)},$$slots:{default:!0}})};O(he,a=>{e(j)&&a(We)})}var Ge=t(he,2);{var Ue=a=>{var o=ht(),y=s(o);xt(y,{size:"lg"}),r(o),u(a,o)},Ke=a=>{var o=Ht(),y=s(o);q(y,{children:(p,T)=>{var v=$t(),c=t(A(v),2),n=s(c);J(n,{label:"Campaign Name",placeholder:"e.g., January Newsletter",required:!0,get value(){return e(U)},set value(i){l(U,i,!0)}});var m=t(n,2);J(m,{label:"Subject Line",placeholder:"e.g., Check out what's new this month!",required:!0,get value(){return e(K)},set value(i){l(K,i,!0)}});var d=t(m,2);J(d,{label:"Preview Text",placeholder:"Text shown after the subject in inbox previews",get value(){return e(re)},set value(i){l(re,i,!0)}}),r(c),u(p,v)},$$slots:{default:!0}});var M=t(y,2);q(M,{children:(p,T)=>{var v=yt(),c=t(A(v),2),n=s(c);J(n,{label:"From Name",placeholder:"e.g., John from Acme",get value(){return e(se)},set value(i){l(se,i,!0)}});var m=t(n,2);J(m,{label:"From Email",type:"email",placeholder:"e.g., john@acme.com",get value(){return e(le)},set value(i){l(le,i,!0)}});var d=t(m,2);J(d,{label:"Reply-To Email",type:"email",placeholder:"e.g., support@acme.com",get value(){return e(oe)},set value(i){l(oe,i,!0)}}),r(c),w(2),u(p,v)},$$slots:{default:!0}});var Z=t(M,2);q(Z,{children:(p,T)=>{var v=Lt(),c=t(A(v),2);{var n=d=>{var i=kt();u(d,i)},m=d=>{var i=St(),k=s(i),h=t(s(k),2);xe(h,21,()=>e(B),_e,($,f)=>{var P=wt(),C=s(P);Se(C),C.__change=()=>Me(e(f).id);var S=t(C,2),D=s(S),R=s(D,!0);r(D);var W=t(D,2),G=s(W);r(W),r(S),r(P),H((pe,I)=>{Le(C,pe),L(R,e(f).name),L(G,`${I??""} subscribers`)},[()=>e(g).includes(e(f).id),()=>e(f).subscriber_count.toLocaleString()]),u($,P)}),r(h);var b=t(h,2);{var F=$=>{var f=Tt(),P=t(s(f)),C=s(P,!0);r(P),r(f),H(S=>L(C,S),[()=>e(ze)().toLocaleString()]),u($,f)};O(b,$=>{e(g).length>0&&$(F)})}r(k);var N=t(k,2);{var ue=$=>{var f=Pt(),P=t(s(f),2);xe(P,21,()=>e(B).filter(C=>!e(g).includes(C.id)),_e,(C,S)=>{var D=Ct(),R=s(D);Se(R),R.__change=()=>Re(e(S).id);var W=t(R,2),G=s(W),pe=s(G,!0);r(G);var I=t(G,2),Ye=s(I);r(I),r(W),r(D),H((Ze,Ie)=>{Le(R,Ze),L(pe,e(S).name),L(Ye,`${Ie??""} subscribers`)},[()=>e(E).includes(e(S).id),()=>e(S).subscriber_count.toLocaleString()]),u(C,D)}),r(P),r(f),u($,f)};O(N,$=>{e(g).length>0&&e(B).length>1&&$(ue)})}r(i),u(d,i)};O(c,d=>{e(B).length===0?d(n):d(m,!1)})}u(p,v)},$$slots:{default:!0}});var $e=t(Z,2);{var Qe=p=>{q(p,{children:(T,v)=>{var c=jt(),n=t(A(c),2),m=s(n);m.__click=()=>ge("");var d=s(m);Ae(d,{class:"h-6 w-6 mb-2 text-text-muted"}),w(4),r(m);var i=t(m,2);xe(i,17,()=>e(X),_e,(k,h)=>{var b=Et();b.__click=()=>ge(e(h).id);var F=s(b);Ae(F,{class:"h-6 w-6 mb-2 text-primary"});var N=t(F,2),ue=s(N,!0);r(N);var $=t(N,2),f=s($,!0);r($),r(b),H(()=>{Ee(b,1,`p-4 rounded-lg border-2 text-left transition-colors ${e(Q)===e(h).id?"border-primary bg-primary/5":"border-base-300 hover:border-base-content/20"}`),L(ue,e(h).name),L(f,e(h).category)}),u(k,b)}),r(n),H(()=>Ee(m,1,`p-4 rounded-lg border-2 text-left transition-colors ${e(Q)===""?"border-primary bg-primary/5":"border-base-300 hover:border-base-content/20"}`)),u(T,c)},$$slots:{default:!0}})};O($e,p=>{e(X).length>0&&p(Qe)})}var ye=t($e,2);q(ye,{children:(p,T)=>{var v=At(),c=t(A(v),2),n=s(c),m=t(s(n),2);pt(m,{minHeight:"400px",get value(){return e(z)},set value(b){l(z,b,!0)}}),r(n);var d=t(n,2),i=s(d),k=t(s(i),2);ae(k,{type:"ghost",size:"xs",onclick:Je,children:(b,F)=>{w();var N=Pe("Generate from HTML");u(b,N)},$$slots:{default:!0}}),r(i);var h=t(i,2);_t(h,{placeholder:"Plain text version for email clients that don't support HTML...",rows:6,get value(){return e(V)},set value(b){l(V,b,!0)}}),w(2),r(d),r(c),u(p,v)},$$slots:{default:!0}});var ke=t(ye,2);q(ke,{children:(p,T)=>{var v=Ft(),c=t(A(v),2),n=s(c);je(n,{label:"Track opens",get checked(){return e(ie)},set checked(d){l(ie,d,!0)}});var m=t(n,4);je(m,{label:"Track clicks",get checked(){return e(ne)},set checked(d){l(ne,d,!0)}}),w(2),r(c),u(p,v)},$$slots:{default:!0}});var we=t(ke,2);q(we,{children:(p,T)=>{var v=Nt(),c=t(A(v),2),n=s(c),m=s(n);m.textContent="{{email}}",w(2),r(n);var d=t(n,2),i=s(d);i.textContent="{{name}}",w(2),r(d);var k=t(d,2),h=s(k);h.textContent="{{unsubscribe_url}}",w(2),r(k);var b=t(k,2),F=s(b);F.textContent="{{web_version_url}}",w(2),r(b),r(c),u(p,v)},$$slots:{default:!0}});var Te=t(we,2),Ce=s(Te);ae(Ce,{type:"secondary",onclick:()=>be(`${e(ce)}/campaigns`),children:(p,T)=>{w();var v=Pe("Cancel");u(p,v)},$$slots:{default:!0}});var Xe=t(Ce,4);{let p=te(()=>e(Y)||!e(fe)());ae(Xe,{type:"secondary",onclick:()=>Oe(!1),get disabled(){return e(p)},children:(T,v)=>{var c=Dt(),n=A(c);ft(n,{class:"h-4 w-4 mr-2"});var m=t(n);H(()=>L(m,` ${e(Y)?"Saving...":"Save as Draft"}`)),u(T,c)},$$slots:{default:!0}})}r(Te),r(o),u(a,o)};O(Ge,a=>{e(de)?a(Ue):a(Ke,!1)})}r(ve),u(Fe,ve),at(),qe()}lt(["change","click"]);export{ea as component};
