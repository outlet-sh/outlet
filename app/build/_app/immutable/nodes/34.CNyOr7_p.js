import"../chunks/DsnmJJEf.js";import{p as Qe,s as n,a as Ve,u as We,b as t,i as e,f as w,d as Xe,j as W,t as X,h as a,c as s,n as N,r as l}from"../chunks/odI--4Kw.js";import{s as J}from"../chunks/BNMK9zrr.js";import{a as o,f as m,t as Y,c as oe}from"../chunks/CCInJaqd.js";import{i as D}from"../chunks/COaB7F5h.js";import{e as Ze,i as et}from"../chunks/BohEjZuL.js";import{s as tt,a as rt}from"../chunks/DL1yFSKa.js";import{p as at}from"../chunks/CdFg3XMI.js";import{I as lt,J as st,K as ot,L as it}from"../chunks/CbJUEE85.js";import{B as G,M as dt,g as nt,I as ie,S as ut,c as vt,A as be,C as $e}from"../chunks/DDAcQctE.js";import{E as ct}from"../chunks/BtTFHV7Z.js";import{L as Fe}from"../chunks/D716f0vp.js";import{B as we}from"../chunks/BD7k7D4N.js";import{g as mt}from"../chunks/B5W8Y6hm.js";import{P as Ce}from"../chunks/iPsqwY4C.js";import{L as pt}from"../chunks/BbbE2Ltm.js";import{S as ft}from"../chunks/AEVXVjr0.js";import{T as _t}from"../chunks/BzbtGsEE.js";var ht=m("<p> </p>"),gt=m("<!> Add Field",1),xt=m('<div class="flex justify-center py-12"><!></div>'),yt=m("<!> Add Your First Field",1),bt=m('<span class="text-text-muted">Optional</span>'),$t=m('<tr><td class="font-medium"> </td><td><code class="text-xs bg-bg-secondary px-1.5 py-0.5 rounded"> </code></td><td><!></td><td><!></td><td class="text-right"><div class="flex justify-end gap-2"><!> <!></div></td></tr>'),Ft=m('<div class="overflow-x-auto"><table class="table w-full"><thead><tr><th>Name</th><th>Merge Tag</th><th>Type</th><th>Required</th><th class="text-right">Actions</th></tr></thead><tbody></tbody></table></div>'),wt=m('<h4 class="font-medium text-text mb-2">Using Merge Tags</h4> <p class="text-sm text-text-muted mb-3">Use merge tags in your email templates to personalize content for each subscriber.</p> <div class="bg-bg-secondary p-3 rounded-lg"><code class="text-sm font-mono text-text"></code></div>',1),Ct=m("<!> <!>",1),kt=m("<!> <!>",1),Pt=m('<div><label for="field-options" class="form-label">Options</label> <!> <p class="mt-1 text-xs text-text-muted">Comma-separated list of options</p></div>'),At=m("<p> </p>"),Tt=m('<div class="space-y-4"><div><label for="field-name" class="form-label">Field Name</label> <!> <p class="mt-1 text-xs text-text-muted">The label shown on the subscribe form</p></div> <div><label for="field-key" class="form-label">Merge Tag Key</label> <!> <p class="mt-1 text-xs text-text-muted"> </p></div> <div><label for="field-type" class="form-label">Field Type</label> <!></div> <!> <div><label for="field-placeholder" class="form-label">Placeholder (optional)</label> <!></div> <div><!> <p class="text-xs text-text-muted mt-1 ml-6">Subscribers must fill in this field to subscribe</p></div> <!></div>'),St=m('<!> <div class="space-y-4"><div class="flex justify-between items-center"><div><h3 class="font-medium text-text">Custom Fields</h3> <p class="text-sm text-text-muted">Add custom fields to collect additional information from subscribers</p></div> <!></div> <!></div> <!> <!>',1);function Qt(ke,Pe){Qe(Pe,!0);const Ae=()=>rt(at,"$page",Te),[Te,Se]=tt();mt();let Z=W(()=>Ae().params.id),de=n(Ve([])),ne=n(!0),I=n(!1),Q=n(!1),C=n(""),g=n(""),L=n("text"),K=n(!1),R=n(""),U=n(""),O=n(null),V=n(null),j=n("");We(()=>{ue()});async function ue(){t(ne,!0);try{const r=await lt({},e(Z));t(de,r.fields||[],!0)}catch(r){console.error("Failed to load custom fields:",r)}finally{t(ne,!1)}}function qe(r){return r.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"")}function De(){e(O)||t(g,qe(e(C)),!0)}function ee(){t(C,""),t(g,""),t(L,"text"),t(K,!1),t(R,""),t(U,""),t(O,null)}function Le(r){t(O,r,!0),t(C,r.name,!0),t(g,r.field_key,!0),t(L,r.field_type,!0),t(K,r.required,!0),t(R,r.placeholder||"",!0),t(U,r.options?.join(", ")||"",!0),t(I,!0)}async function ze(){if(!(!e(C)||!e(g))){t(Q,!0),t(j,"");try{const r=e(L)==="dropdown"&&e(U)?e(U).split(",").map(d=>d.trim()).filter(d=>d):void 0;e(O)?await ot({},{name:e(C),field_key:e(g),field_type:e(L),required:e(K),placeholder:e(R),options:r},e(Z),e(O).id):await it({},{name:e(C),field_key:e(g),field_type:e(L),required:e(K),placeholder:e(R),options:r},e(Z)),t(I,!1),ee(),await ue()}catch(r){t(j,r.message||"Failed to save custom field",!0)}finally{t(Q,!1)}}}let te=n(!1),ve=n("");function Ee(r){t(ve,r,!0),t(te,!0)}async function Ne(){t(V,e(ve),!0);try{await st({},e(Z),e(ve)),await ue()}catch(r){t(j,r.message||"Failed to delete custom field",!0)}finally{t(V,null)}}var fe=St(),_e=w(fe);{var Ie=r=>{be(r,{type:"error",title:"Error",class:"mb-4",children:(d,p)=>{var h=ht(),x=s(h,!0);l(h),X(()=>J(x,e(j))),o(d,h)},$$slots:{default:!0}})};D(_e,r=>{e(j)&&r(Ie)})}var ce=a(_e,2),me=s(ce),Oe=a(s(me),2);G(Oe,{type:"primary",onclick:()=>{ee(),t(I,!0)},children:(r,d)=>{var p=gt(),h=w(p);Ce(h,{class:"mr-2 h-4 w-4"}),N(),o(r,p)},$$slots:{default:!0}}),l(me);var je=a(me,2);{var Me=r=>{var d=xt(),p=s(d);Fe(p,{}),l(d),o(r,d)},Be=r=>{var d=oe(),p=w(d);{var h=f=>{ct(f,{get icon(){return pt},title:"No custom fields",message:"Add custom fields to collect more information from subscribers, like name, company, or phone number.",children:(y,b)=>{G(y,{type:"primary",onclick:()=>{ee(),t(I,!0)},children:(k,$)=>{var z=yt(),u=w(z);Ce(u,{class:"mr-2 h-4 w-4"}),N(),o(k,z)},$$slots:{default:!0}})},$$slots:{default:!0}})},x=f=>{var y=Ct(),b=w(y);$e(b,{children:($,z)=>{var u=Ft(),P=s(u),v=a(s(P));Ze(v,21,()=>e(de),et,(E,c)=>{var M=$t(),A=s(M),F=s(A,!0);l(A);var T=a(A),re=s(T),i=s(re,!0);l(re),l(T);var S=a(T),ae=s(S);we(ae,{variant:"default",size:"sm",children:(_,B)=>{N();var le=Y();X(()=>J(le,e(c).field_type)),o(_,le)},$$slots:{default:!0}}),l(S);var q=a(S),pe=s(q);{var Re=_=>{we(_,{variant:"warning",size:"sm",children:(B,le)=>{N();var se=Y("Required");o(B,se)},$$slots:{default:!0}})},Ue=_=>{var B=bt();o(_,B)};D(pe,_=>{e(c).required?_(Re):_(Ue,!1)})}l(q);var ge=a(q),xe=s(ge),ye=s(xe);G(ye,{type:"ghost",size:"sm",onclick:()=>Le(e(c)),children:(_,B)=>{ft(_,{class:"h-4 w-4"})},$$slots:{default:!0}});var He=a(ye,2);{let _=W(()=>e(V)===e(c).id);G(He,{type:"ghost",size:"sm",onclick:()=>Ee(e(c).id),get disabled(){return e(_)},children:(B,le)=>{var se=oe(),Je=w(se);{var Ye=H=>{Fe(H,{size:"small"})},Ge=H=>{_t(H,{class:"h-4 w-4 text-red-500"})};D(Je,H=>{e(V)===e(c).id?H(Ye):H(Ge,!1)})}o(B,se)},$$slots:{default:!0}})}l(xe),l(ge),l(M),X(()=>{J(F,e(c).name),J(i,`{{${e(c).field_key}}}`)}),o(E,M)}),l(v),l(P),l(u),o($,u)},$$slots:{default:!0}});var k=a(b,2);$e(k,{children:($,z)=>{var u=wt(),P=a(w(u),4),v=s(P);v.textContent="Hi {{name}}, thanks for signing up!",l(P),o($,u)},$$slots:{default:!0}}),o(f,y)};D(p,f=>{e(de).length===0?f(h):f(x,!1)},!0)}o(r,d)};D(je,r=>{e(ne)?r(Me):r(Be,!1)})}l(ce);var he=a(ce,2);{const r=p=>{var h=kt(),x=w(h);G(x,{type:"secondary",onclick:()=>{t(I,!1),ee()},get disabled(){return e(Q)},children:(y,b)=>{N();var k=Y("Cancel");o(y,k)},$$slots:{default:!0}});var f=a(x,2);{let y=W(()=>!e(C)||!e(g)||e(Q));G(f,{type:"primary",onclick:ze,get disabled(){return e(y)},children:(b,k)=>{var $=oe(),z=w($);{var u=v=>{var E=Y("Saving...");o(v,E)},P=v=>{var E=oe(),c=w(E);{var M=F=>{var T=Y("Save Changes");o(F,T)},A=F=>{var T=Y("Add Field");o(F,T)};D(c,F=>{e(O)?F(M):F(A,!1)},!0)}o(v,E)};D(z,v=>{e(Q)?v(u):v(P,!1)})}o(b,$)},$$slots:{default:!0}})}o(p,h)};let d=W(()=>e(O)?"Edit Custom Field":"Add Custom Field");dt(he,{get title(){return e(d)},size:"md",get show(){return e(I)},set show(p){t(I,p,!0)},footer:r,children:(p,h)=>{var x=Tt(),f=s(x),y=a(s(f),2);ie(y,{id:"field-name",type:"text",oninput:De,placeholder:"e.g., First Name",get value(){return e(C)},set value(i){t(C,i,!0)}}),N(2),l(f);var b=a(f,2),k=a(s(b),2);ie(k,{id:"field-key",type:"text",placeholder:"e.g., first_name",get value(){return e(g)},set value(i){t(g,i,!0)}});var $=a(k,2),z=s($);l($),l(b);var u=a(b,2),P=a(s(u),2);ut(P,{options:[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"dropdown",label:"Dropdown"}],get value(){return e(L)},set value(i){t(L,i,!0)}}),l(u);var v=a(u,2);{var E=i=>{var S=Pt(),ae=a(s(S),2);ie(ae,{id:"field-options",type:"text",placeholder:"Option 1, Option 2, Option 3",get value(){return e(U)},set value(q){t(U,q,!0)}}),N(2),l(S),o(i,S)};D(v,i=>{e(L)==="dropdown"&&i(E)})}var c=a(v,2),M=a(s(c),2);ie(M,{id:"field-placeholder",type:"text",placeholder:"Enter your first name...",get value(){return e(R)},set value(i){t(R,i,!0)}}),l(c);var A=a(c,2),F=s(A);vt(F,{label:"Required field",get checked(){return e(K)},set checked(i){t(K,i,!0)}}),N(2),l(A);var T=a(A,2);{var re=i=>{be(i,{type:"error",title:"Error",children:(S,ae)=>{var q=At(),pe=s(q,!0);l(q),X(()=>J(pe,e(j))),o(S,q)},$$slots:{default:!0}})};D(T,i=>{e(j)&&i(re)})}l(x),X(()=>J(z,`Used in emails as ${`{{${e(g)||"field_key"}}}`}`)),o(p,x)},$$slots:{footer:!0,default:!0}})}var Ke=a(he,2);{let r=W(()=>e(V)?"Deleting...":"Delete");nt(Ke,{title:"Delete Custom Field",description:"Are you sure you want to delete this custom field? All data for this field will be lost.",get actionLabel(){return e(r)},actionType:"danger",onAction:Ne,onCancel:()=>t(te,!1),get open(){return e(te)},set open(d){t(te,d,!0)}})}o(ke,fe),Xe(),Se()}export{Qt as component};
