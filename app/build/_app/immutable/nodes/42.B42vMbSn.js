import"../chunks/DsnmJJEf.js";import{f as S,p as Ze,c as l,r,t as F,i as e,d as et,j as H,s as x,a as Ae,u as bt,b as o,h as i,n as w,l as gt}from"../chunks/odI--4Kw.js";import{s as k}from"../chunks/BNMK9zrr.js";import{c as re,a as s,f as u,t as R}from"../chunks/CCInJaqd.js";import{l as $t,s as yt,p as me,i as z}from"../chunks/COaB7F5h.js";import{a as xt,c as kt,e as he,i as be,s as wt}from"../chunks/BohEjZuL.js";import{ao as Ct,ap as Pt,aq as Wt,ar as zt,as as St,at as Et}from"../chunks/CbJUEE85.js";import{a as Dt,s as Lt,B as M,M as Re,g as Ft,I as Ye,c as Ve,A as Oe,f as Tt,h as At,X as Rt,C as Ge,q as He}from"../chunks/DDAcQctE.js";import{L as Je}from"../chunks/D716f0vp.js";import{s as Ot}from"../chunks/C07Dfx-t.js";import{B as ge}from"../chunks/BD7k7D4N.js";import{P as Ke}from"../chunks/iPsqwY4C.js";import{R as Mt}from"../chunks/CqkV1_7K.js";import{T as Ut}from"../chunks/CHPiPv76.js";import"../chunks/B9hjHVe6.js";import{T as jt}from"../chunks/BzbtGsEE.js";function Bt(ce,T){const J=$t(T,["children","$$slots","$$events","$$legacy"]);const A=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"}],["path",{d:"m2 2 20 20"}]];Dt(ce,yt({name:"eye-off"},()=>J,{get iconNode(){return A},children:(K,I)=>{var N=re(),Y=S(N);Lt(Y,T,"default",{}),s(K,N)},$$slots:{default:!0}}))}var It=u('<div class="overflow-x-auto rounded-lg bg-base-200"><table><!></table></div>');function Qe(ce,T){Ze(T,!0);let J=me(T,"zebra",3,!1),A=me(T,"pinRows",3,!1),K=me(T,"pinCols",3,!1),I=me(T,"size",3,"md"),N=me(T,"class",3,"");const Y={xs:"table-xs",sm:"table-sm",md:"",lg:"table-lg"};let h=H(()=>`table ${Y[I()]} ${J()?"table-zebra":""} ${A()?"table-pin-rows":""} ${K()?"table-pin-cols":""} ${N()}`.trim());var Q=It(),ve=l(Q),se=l(ve);Ot(se,()=>T.children),r(ve),r(Q),F(()=>xt(ve,1,kt(e(h)))),s(ce,Q),et()}var Nt=u("<!> Add Webhook",1),qt=u('<div class="flex justify-center py-12"><!></div>'),Xt=u("<!> Add Your First Webhook",1),Yt=u('<p class="text-text-muted">No webhooks configured yet.</p> <!>',1),Vt=u('<tr><td class="font-mono text-sm max-w-xs truncate"> </td><td><div class="flex flex-wrap gap-1"><!> <!></div></td><td><!></td><td><div class="text-sm"><span class="text-green-600"> </span> <span class="text-text-muted">/</span> <span class="text-red-600"> </span></div></td><td class="text-sm text-text-muted"> </td><td><div class="flex items-center justify-end gap-2"><!> <!> <!> <!></div></td></tr>'),Gt=u('<thead><tr><th>URL</th><th>Events</th><th>Status</th><th>Deliveries</th><th>Last Delivery</th><th class="text-right">Actions</th></tr></thead> <tbody></tbody>',1),Ht=u('<p class="mt-1 text-sm"> </p>'),Jt=u("<strong> </strong> <!> <!>",1),Kt=u('<div class="flex justify-end gap-3"><!> <!></div>'),Qt=u('<div><h4 class="text-sm font-medium text-text-muted mb-2"> </h4> <div class="space-y-2 pl-2"></div></div>'),Zt=u('<div class="space-y-4"><div><label class="form-label" for="webhook-url">Endpoint URL</label> <!></div> <div><label class="form-label">Events to Subscribe</label> <div class="mt-2 space-y-4 max-h-64 overflow-y-auto"></div></div> <div><!></div></div>'),ea=u('<div class="space-y-4"><!> <div><label class="form-label">Signing Secret</label> <div class="flex gap-2"><!> <!></div> <p class="mt-2 text-sm text-text-muted">Use this secret to verify that webhook payloads are from Outlet. Check the <code>X-Webhook-Signature</code> header.</p></div></div>'),ta=u('<div class="flex justify-center py-8"><!></div>'),aa=u('<p class="text-center text-text-muted py-8">No delivery logs yet.</p>'),ra=u('<span class="flex items-center gap-1 text-green-600"><!> </span>'),sa=u('<span class="flex items-center gap-1 text-red-600"><!> Error</span>'),oa=u('<span class="text-red-600"> </span>'),la=u('<tr><td><!></td><td><!></td><td class="text-sm text-text-muted"> </td><td class="text-sm text-text-muted"> </td></tr>'),ia=u("<thead><tr><th>Event</th><th>Status</th><th>Duration</th><th>Time</th></tr></thead> <tbody></tbody>",1),na=u('<div class="max-h-96 overflow-y-auto"><!></div>'),da=u('<div class="space-y-6"><div class="flex items-center justify-between"><div><h2 class="text-lg font-medium text-text">Webhooks</h2> <p class="mt-1 text-sm text-text-muted">Receive real-time notifications when events happen in your account.</p></div> <!></div> <!> <!> <!></div> <!> <!> <!> <!>',1);function Pa(ce,T){Ze(T,!0);let J=x(!0),A=x(""),K=x(Ae([])),I=x(!1),N=x(!1),Y=x(!1),h=x(Ae({url:"",events:[],active:!0})),Q=x(""),ve=x(""),se=x(Ae([])),Ce=x(!1),$e=x(!1),Me=x(""),Pe=x(!1),ye=x(null),O=x(null);const tt=[{value:"checkout.completed",label:"Checkout Completed",category:"Orders"},{value:"order.created",label:"Order Created",category:"Orders"},{value:"order.completed",label:"Order Completed",category:"Orders"},{value:"payment.succeeded",label:"Payment Succeeded",category:"Payments"},{value:"payment.failed",label:"Payment Failed",category:"Payments"},{value:"refund.created",label:"Refund Created",category:"Payments"},{value:"subscription.created",label:"Subscription Created",category:"Subscriptions"},{value:"subscription.updated",label:"Subscription Updated",category:"Subscriptions"},{value:"subscription.canceled",label:"Subscription Canceled",category:"Subscriptions"},{value:"subscription.renewed",label:"Subscription Renewed",category:"Subscriptions"},{value:"customer.created",label:"Customer Created",category:"Customers"},{value:"customer.updated",label:"Customer Updated",category:"Customers"},{value:"contact.created",label:"Contact Created",category:"Contacts"},{value:"contact.unsubscribed",label:"Contact Unsubscribed",category:"Contacts"},{value:"email.sent",label:"Email Sent",category:"Email"},{value:"email.bounced",label:"Email Bounced",category:"Email"},{value:"email.opened",label:"Email Opened",category:"Email"},{value:"email.clicked",label:"Email Clicked",category:"Email"}];let at=H(()=>()=>{const t={};for(const a of tt)t[a.category]||(t[a.category]=[]),t[a.category].push(a);return t});bt(()=>{xe()});async function xe(){o(J,!0),o(A,"");try{const t=await Ct();o(K,t.webhooks||[],!0)}catch(t){console.error("Failed to load webhooks:",t),o(A,t.message||"Failed to load webhooks",!0)}finally{o(J,!1)}}async function rt(){if(!e(h).url||e(h).events.length===0){o(A,"URL and at least one event are required");return}try{const t=await Wt({url:e(h).url,events:e(h).events,active:e(h).active});o(Q,t.secret,!0),o(I,!1),o(Y,!0),o(h,{url:"",events:[],active:!0},!0),await xe()}catch(t){console.error("Failed to create webhook:",t),o(A,t.message||"Failed to create webhook",!0)}}async function st(t){try{await Et({},{active:!t.active},t.id),await xe()}catch(a){console.error("Failed to update webhook:",a),o(A,a.message||"Failed to update webhook",!0)}}function ot(t){o(Me,t,!0),o($e,!0)}async function lt(){o(Pe,!0);try{await Pt({},e(Me)),await xe()}catch(t){console.error("Failed to delete webhook:",t),o(A,t.message||"Failed to delete webhook",!0)}finally{o(Pe,!1)}}async function it(t){o(ye,t,!0),o(O,null);try{o(O,await St({},t),!0)}catch(a){console.error("Failed to test webhook:",a),o(O,{success:!1,status_code:0,error:a.message||"Test failed"},!0)}finally{o(ye,null)}}async function nt(t){o(ve,t,!0),o(Ce,!0),o(N,!0),o(se,[],!0);try{const a=await zt({limit:50},t);o(se,a.logs||[],!0)}catch(a){console.error("Failed to load webhook logs:",a)}finally{o(Ce,!1)}}function dt(t){e(h).events.indexOf(t)===-1?e(h).events=[...e(h).events,t]:e(h).events=e(h).events.filter(c=>c!==t)}function ct(){navigator.clipboard.writeText(e(Q))}function Ue(t){return t?new Date(t).toLocaleString():"Never"}var je=da(),We=S(je),ze=l(We),vt=i(l(ze),2);M(vt,{onclick:()=>o(I,!0),children:(t,a)=>{var c=Nt(),d=S(c);Ke(d,{size:16,class:"mr-2"}),w(),s(t,c)},$$slots:{default:!0}}),r(ze);var Be=i(ze,2);{var ut=t=>{Oe(t,{variant:"error",children:(a,c)=>{w();var d=R();F(()=>k(d,e(A))),s(a,d)},$$slots:{default:!0}})};z(Be,t=>{e(A)&&t(ut)})}var Ie=i(Be,2);{var ft=t=>{var a=qt(),c=l(a);Je(c,{size:"lg"}),r(a),s(t,a)},pt=t=>{var a=re(),c=S(a);{var d=f=>{Ge(f,{class:"py-12 text-center",children:($,p)=>{var b=Yt(),C=i(S(b),2);M(C,{class:"mt-4",onclick:()=>o(I,!0),children:(y,g)=>{var _=Xt(),n=S(_);Ke(n,{size:16,class:"mr-2"}),w(),s(y,_)},$$slots:{default:!0}}),s($,b)},$$slots:{default:!0}})},m=f=>{Ge(f,{children:($,p)=>{Qe($,{children:(b,C)=>{var y=Gt(),g=i(S(y),2);he(g,21,()=>e(K),be,(_,n)=>{var Z=Vt(),U=l(Z),oe=l(U,!0);r(U);var V=i(U),G=l(V),le=l(G);he(le,17,()=>e(n).events.slice(0,2),be,(v,E)=>{ge(v,{variant:"secondary",class:"text-xs",children:(ne,D)=>{w();var de=R();F(()=>k(de,e(E))),s(ne,de)},$$slots:{default:!0}})});var P=i(le,2);{var ee=v=>{ge(v,{variant:"secondary",class:"text-xs",children:(E,ne)=>{w();var D=R();F(()=>k(D,`+${e(n).events.length-2} more`)),s(E,D)},$$slots:{default:!0}})};z(P,v=>{e(n).events.length>2&&v(ee)})}r(G),r(V);var te=i(V),Se=l(te);{var ue=v=>{ge(v,{variant:"success",children:(E,ne)=>{w();var D=R("Active");s(E,D)},$$slots:{default:!0}})},Ee=v=>{ge(v,{variant:"secondary",children:(E,ne)=>{w();var D=R("Inactive");s(E,D)},$$slots:{default:!0}})};z(Se,v=>{e(n).active?v(ue):v(Ee,!1)})}r(te);var fe=i(te),ke=l(fe),ae=l(ke),De=l(ae,!0);r(ae);var pe=i(ae,4),Le=l(pe,!0);r(pe),r(ke),r(fe);var W=i(fe),q=l(W,!0);r(W);var j=i(W),ie=l(j),we=l(ie);M(we,{variant:"ghost",size:"sm",onclick:()=>nt(e(n).id),title:"View Logs",children:(v,E)=>{He(v,{size:16})},$$slots:{default:!0}});var X=i(we,2);{let v=H(()=>e(ye)===e(n).id);M(X,{variant:"ghost",size:"sm",onclick:()=>it(e(n).id),get disabled(){return e(v)},title:"Test Webhook",children:(E,ne)=>{var D=re(),de=S(D);{var Fe=L=>{Mt(L,{size:16,class:"animate-spin"})},Te=L=>{Ut(L,{size:16})};z(de,L=>{e(ye)===e(n).id?L(Fe):L(Te,!1)})}s(E,D)},$$slots:{default:!0}})}var B=i(X,2);{let v=H(()=>e(n).active?"Disable":"Enable");M(B,{variant:"ghost",size:"sm",onclick:()=>st(e(n)),get title(){return e(v)},children:(E,ne)=>{var D=re(),de=S(D);{var Fe=L=>{Bt(L,{size:16})},Te=L=>{He(L,{size:16})};z(de,L=>{e(n).active?L(Fe):L(Te,!1)})}s(E,D)},$$slots:{default:!0}})}var _e=i(B,2);M(_e,{variant:"ghost",size:"sm",class:"text-red-600 hover:text-red-700",onclick:()=>ot(e(n).id),title:"Delete",children:(v,E)=>{jt(v,{size:16})},$$slots:{default:!0}}),r(ie),r(j),r(Z),F(v=>{wt(U,"title",e(n).url),k(oe,e(n).url),k(De,e(n).deliveries_success||0),k(Le,e(n).deliveries_failed||0),k(q,v)},[()=>Ue(e(n).last_delivery_at)]),s(_,Z)}),r(g),s(b,y)},$$slots:{default:!0}})},$$slots:{default:!0}})};z(c,f=>{e(K).length===0?f(d):f(m,!1)},!0)}s(t,a)};z(Ie,t=>{e(J)?t(ft):t(pt,!1)})}var _t=i(Ie,2);{var mt=t=>{{let a=H(()=>e(O).success?"success":"error");Oe(t,{get variant(){return e(a)},dismissable:!0,onclose:()=>o(O,null),children:(c,d)=>{var m=Jt(),f=S(m),$=l(f);r(f);var p=i(f,2);{var b=g=>{var _=R();F(()=>k(_,`- Status: ${e(O).status_code??""}`)),s(g,_)};z(p,g=>{e(O).status_code&&g(b)})}var C=i(p,2);{var y=g=>{var _=Ht(),n=l(_,!0);r(_),F(()=>k(n,e(O).error)),s(g,_)};z(C,g=>{e(O).error&&g(y)})}F(()=>k($,`Test ${e(O).success?"Successful":"Failed"}`)),s(c,m)},$$slots:{default:!0}})}};z(_t,t=>{e(O)&&t(mt)})}r(We);var Ne=i(We,2);Re(Ne,{title:"Add Webhook",get open(){return e(I)},set open(a){o(I,a,!0)},footer:a=>{var c=Kt(),d=l(c);M(d,{variant:"secondary",onclick:()=>o(I,!1),children:(f,$)=>{w();var p=R("Cancel");s(f,p)},$$slots:{default:!0}});var m=i(d,2);M(m,{onclick:rt,children:(f,$)=>{w();var p=R("Create Webhook");s(f,p)},$$slots:{default:!0}}),r(c),s(a,c)},children:(a,c)=>{var d=Zt(),m=l(d),f=i(l(m),2);Ye(f,{id:"webhook-url",type:"url",placeholder:"https://your-server.com/webhook",get value(){return e(h).url},set value(y){e(h).url=y}}),r(m);var $=i(m,2),p=i(l($),2);he(p,21,()=>Object.entries(e(at)()),be,(y,g)=>{var _=H(()=>gt(e(g),2));let n=()=>e(_)[0],Z=()=>e(_)[1];var U=Qt(),oe=l(U),V=l(oe,!0);r(oe);var G=i(oe,2);he(G,21,Z,be,(le,P)=>{{let ee=H(()=>e(h).events.includes(e(P).value));Ve(le,{get label(){return e(P).label},get checked(){return e(ee)},onchange:()=>dt(e(P).value)})}}),r(G),r(U),F(()=>k(V,n())),s(y,U)}),r(p),r($);var b=i($,2),C=l(b);Ve(C,{label:"Active",get checked(){return e(h).active},set checked(y){e(h).active=y}}),r(b),r(d),s(a,d)},$$slots:{footer:!0,default:!0}});var qe=i(Ne,2);Re(qe,{title:"Webhook Created",get open(){return e(Y)},set open(a){o(Y,a,!0)},footer:a=>{M(a,{onclick:()=>o(Y,!1),children:(c,d)=>{w();var m=R("Done");s(c,m)},$$slots:{default:!0}})},children:(a,c)=>{var d=ea(),m=l(d);Oe(m,{variant:"warning",children:(C,y)=>{w();var g=R("Save this secret now. You won't be able to see it again.");s(C,g)},$$slots:{default:!0}});var f=i(m,2),$=i(l(f),2),p=l($);Ye(p,{get value(){return e(Q)},readonly:!0,class:"font-mono text-sm"});var b=i(p,2);M(b,{variant:"secondary",onclick:ct,children:(C,y)=>{Tt(C,{size:16})},$$slots:{default:!0}}),r($),w(2),r(f),r(d),s(a,d)},$$slots:{footer:!0,default:!0}});var Xe=i(qe,2);Re(Xe,{title:"Webhook Delivery Logs",size:"lg",get open(){return e(N)},set open(a){o(N,a,!0)},footer:a=>{M(a,{variant:"secondary",onclick:()=>o(N,!1),children:(c,d)=>{w();var m=R("Close");s(c,m)},$$slots:{default:!0}})},children:(a,c)=>{var d=re(),m=S(d);{var f=p=>{var b=ta(),C=l(b);Je(C,{}),r(b),s(p,b)},$=p=>{var b=re(),C=S(b);{var y=_=>{var n=aa();s(_,n)},g=_=>{var n=na(),Z=l(n);Qe(Z,{children:(U,oe)=>{var V=ia(),G=i(S(V),2);he(G,21,()=>e(se),be,(le,P)=>{var ee=la(),te=l(ee),Se=l(te);ge(Se,{variant:"secondary",children:(W,q)=>{w();var j=R();F(()=>k(j,e(P).event)),s(W,j)},$$slots:{default:!0}}),r(te);var ue=i(te),Ee=l(ue);{var fe=W=>{var q=ra(),j=l(q);At(j,{size:14});var ie=i(j);r(q),F(()=>k(ie,` ${e(P).status_code??""}`)),s(W,q)},ke=W=>{var q=re(),j=S(q);{var ie=X=>{var B=sa(),_e=l(B);Rt(_e,{size:14}),w(),r(B),s(X,B)},we=X=>{var B=oa(),_e=l(B,!0);r(B),F(()=>k(_e,e(P).status_code)),s(X,B)};z(j,X=>{e(P).error?X(ie):X(we,!1)},!0)}s(W,q)};z(Ee,W=>{e(P).status_code>=200&&e(P).status_code<300?W(fe):W(ke,!1)})}r(ue);var ae=i(ue),De=l(ae);r(ae);var pe=i(ae),Le=l(pe,!0);r(pe),r(ee),F(W=>{k(De,`${(e(P).duration||0)??""}ms`),k(Le,W)},[()=>Ue(e(P).delivered_at)]),s(le,ee)}),r(G),s(U,V)},$$slots:{default:!0}}),r(n),s(_,n)};z(C,_=>{e(se).length===0?_(y):_(g,!1)},!0)}s(p,b)};z(m,p=>{e(Ce)?p(f):p($,!1)})}s(a,d)},$$slots:{footer:!0,default:!0}});var ht=i(Xe,2);{let t=H(()=>e(Pe)?"Deleting...":"Delete");Ft(ht,{title:"Delete Webhook",description:"Are you sure you want to delete this webhook?",get actionLabel(){return e(t)},actionType:"danger",onAction:lt,onCancel:()=>o($e,!1),get open(){return e($e)},set open(a){o($e,a,!0)}})}s(ce,je),et()}export{Pa as component};
