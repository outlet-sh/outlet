import"../chunks/DsnmJJEf.js";import{p as Ie,f as b,d as Be,e as Le,b as t,i as e,t as w,c as r,h as o,s as m,j as ve,g as Ne,n as T,r as s}from"../chunks/odI--4Kw.js";import{s as v}from"../chunks/BNMK9zrr.js";import{a as l,f as d,c as Me,t as pe}from"../chunks/CCInJaqd.js";import{i as U}from"../chunks/COaB7F5h.js";import{h as Ue}from"../chunks/hUjpWz_l.js";import{r as qe}from"../chunks/BohEjZuL.js";import{C as se,g as ze,I as We,B as Q,k as Xe,A as he,l as $e,F as Ye}from"../chunks/DDAcQctE.js";import{W as Ze,X as He,Y as Je,Z as Ke,_ as Oe}from"../chunks/CbJUEE85.js";import{L as Qe}from"../chunks/D716f0vp.js";import{B as ye}from"../chunks/BD7k7D4N.js";import{S as Ve}from"../chunks/DBgKfrOf.js";import{S as et}from"../chunks/BjjKUFj1.js";import{D as be}from"../chunks/DRk3_cHh.js";import{U as tt}from"../chunks/TxtMn3cV.js";import{T as at}from"../chunks/BzbtGsEE.js";var rt=d("<p> </p>"),st=d('<div class="mb-6"><!></div>'),ot=d("<p> </p>"),nt=d('<div class="mb-6"><!></div>'),lt=d("<!> ",1),dt=d('<div class="flex items-center gap-3 mb-4"><!> <h2 class="text-lg font-medium text-text">GDPR Compliance Tools</h2></div> <p class="text-sm text-text-muted mb-4">Manage contact consent preferences, export personal data, or delete contact information to comply with GDPR and privacy regulations.</p> <div class="flex gap-3"><div class="flex-1"><!></div> <!></div>',1),it=d('<div class="flex justify-center py-8"><!></div>'),ct=d('<div class="flex items-center justify-between py-2 border-b border-border"><span class="text-sm text-text-muted">Data Retention</span> <span class="text-sm text-text"> </span></div>'),vt=d('<h2 class="text-lg font-medium text-text mb-4">Contact Information</h2> <div class="space-y-4"><div class="flex items-center justify-between py-2 border-b border-border"><span class="text-sm text-text-muted">Email</span> <span class="text-sm font-medium text-text"> </span></div> <div class="flex items-center justify-between py-2 border-b border-border"><span class="text-sm text-text-muted">Contact ID</span> <code class="text-sm font-mono text-text"> </code></div> <div class="flex items-center justify-between py-2 border-b border-border"><span class="text-sm text-text-muted">Account Created</span> <span class="text-sm text-text"> </span></div> <!></div>',1),pt=d('<h2 class="text-lg font-medium text-text mb-4">Consent Preferences</h2> <div class="space-y-4"><div class="flex items-center justify-between"><div><p class="text-sm font-medium text-text">GDPR Consent</p> <p class="text-xs text-text-muted"> </p></div> <div class="flex items-center gap-3"><!> <!></div></div> <div class="flex items-center justify-between"><div><p class="text-sm font-medium text-text">Marketing Consent</p> <p class="text-xs text-text-muted"> </p></div> <div class="flex items-center gap-3"><!> <!></div></div> <div class="pt-4 border-t border-border"><!></div></div>',1),mt=d("<!> ",1),ut=d("<br/> ",1),ft=d("<!> Download Export",1),_t=d('<div class="p-4 bg-green-500/10 border border-green-500/20 rounded-lg"><p class="text-sm font-medium text-text mb-2">Export Ready</p> <p class="text-xs text-text-muted mb-3"> <!></p> <!></div>'),xt=d("<!> Delete Data",1),gt=d('<h2 class="text-lg font-medium text-text mb-4">Data Actions</h2> <div class="space-y-4"><div class="flex items-center justify-between p-4 bg-bg-secondary rounded-lg"><div class="flex items-center gap-3"><!> <div><p class="text-sm font-medium text-text">Export Personal Data</p> <p class="text-xs text-text-muted">Download all data associated with this contact (GDPR Article 20)</p></div></div> <!></div> <!> <div class="flex items-center justify-between p-4 bg-red-500/10 border border-red-500/20 rounded-lg"><div class="flex items-center gap-3"><!> <div><p class="text-sm font-medium text-text">Delete All Data</p> <p class="text-xs text-text-muted">Permanently delete this contact and all associated data (GDPR Article 17)</p></div></div> <!></div></div>',1),ht=d("<!> <!> <!>",1),$t=d('<div class="mt-4"><label class="flex items-center gap-2"><input type="checkbox" class="rounded"/> <span class="text-sm text-text">Also request deletion from email provider logs (if supported)</span></label></div>'),yt=d('<!> <!> <div class="space-y-6"><!> <!></div> <!>',1);function Lt(we,De){Ie(De,!0);let J=m(""),K=m(!1),j=m(""),x=m(null),g=m(""),R=m(""),V=m(!1),I=m(null),O=m(!1),oe=m(!1),ne=m(!1),ee=m(!1),W=m(!1),X=m(!1);async function me(){if(!e(J).trim()){t(g,"Please enter an email address");return}t(K,!0),t(g,""),t(R,""),t(x,null),t(I,null);try{const a=await Ze({email:e(J).trim()});if(!a.found||!a.contact_id){t(g,"No contact found with that email address");return}t(j,a.contact_id,!0);const n=await He({},e(j));t(x,n,!0),t(W,n.gdpr_consent,!0),t(X,n.marketing_consent,!0)}catch(a){console.error("Failed to search contact:",a),t(g,a.message||"Failed to find contact",!0)}finally{t(K,!1)}}async function Ce(){if(e(j)){t(ee,!0),t(g,""),t(R,"");try{const a=await Ke({},{gdpr_consent:e(W),marketing_consent:e(X)},e(j));t(x,a,!0),t(R,"Consent preferences updated successfully"),setTimeout(()=>{t(R,"")},3e3)}catch(a){console.error("Failed to update consent:",a),t(g,a.message||"Failed to update consent",!0)}finally{t(ee,!1)}}}async function Pe(){if(e(j)){t(V,!0),t(g,""),t(R,"");try{const a=await Oe({},e(j));t(I,a,!0),t(R,"Data export created successfully")}catch(a){console.error("Failed to export data:",a),t(g,a.message||"Failed to export contact data",!0)}finally{t(V,!1)}}}function ke(){t(O,!0)}async function Ae(){if(e(j)){t(oe,!0),t(g,"");try{await Je({},{confirm:!0,delete_email:e(ne)},e(j)),t(O,!1),t(x,null),t(j,""),t(J,""),t(R,"Contact data deleted successfully")}catch(a){console.error("Failed to delete data:",a),t(g,a.message||"Failed to delete contact data",!0)}finally{t(oe,!1)}}}function te(a){return a?new Date(a).toLocaleString():"Never"}var ue=yt();Ue("ml7lf0",a=>{Le(()=>{Ne.title="Privacy & GDPR - Settings"})});var fe=b(ue);{var Ee=a=>{var n=st(),D=r(n);he(D,{type:"error",title:"Error",children:(u,E)=>{var i=rt(),h=r(i,!0);s(i),w(()=>v(h,e(g))),l(u,i)},$$slots:{default:!0}}),s(n),l(a,n)};U(fe,a=>{e(g)&&a(Ee)})}var _e=o(fe,2);{var Fe=a=>{var n=nt(),D=r(n);he(D,{type:"success",title:"Success",children:(u,E)=>{var i=ot(),h=r(i,!0);s(i),w(()=>v(h,e(R))),l(u,i)},$$slots:{default:!0}}),s(n),l(a,n)};U(_e,a=>{e(R)&&a(Fe)})}var le=o(_e,2),xe=r(le);se(xe,{children:(a,n)=>{var D=dt(),u=b(D),E=r(u);Ve(E,{class:"h-5 w-5 text-primary"}),T(2),s(u);var i=o(u,4),h=r(i),ae=r(h);We(ae,{type:"email",placeholder:"Enter contact email address",onkeydown:C=>C.key==="Enter"&&me(),get value(){return e(J)},set value(C){t(J,C,!0)}}),s(h);var de=o(h,2);Q(de,{type:"primary",onclick:me,get disabled(){return e(K)},children:(C,ie)=>{var P=lt(),k=b(P);et(k,{class:"mr-2 h-4 w-4"});var f=o(k);w(()=>v(f,` ${e(K)?"Searching...":"Search Contact"}`)),l(C,P)},$$slots:{default:!0}}),s(i),l(a,D)},$$slots:{default:!0}});var Ge=o(xe,2);{var Se=a=>{var n=it(),D=r(n);Qe(D,{size:"large"}),s(n),l(a,n)},je=a=>{var n=Me(),D=b(n);{var u=E=>{var i=ht(),h=b(i);se(h,{children:(C,ie)=>{var P=vt(),k=o(b(P),2),f=r(k),F=o(r(f),2),Y=r(F,!0);s(F),s(f);var q=o(f,2),B=o(r(q),2),Z=r(B,!0);s(B),s(q);var L=o(q,2),G=o(r(L),2),z=r(G,!0);s(G),s(L);var H=o(L,2);{var A=p=>{var c=ct(),$=o(r(c),2),N=r($,!0);s($),s(c),w(()=>v(N,e(x).data_retention_policy)),l(p,c)};U(H,p=>{e(x).data_retention_policy&&p(A)})}s(k),w(p=>{v(Y,e(x).email),v(Z,e(x).contact_id),v(z,p)},[()=>te(e(x).created_at)]),l(C,P)},$$slots:{default:!0}});var ae=o(h,2);se(ae,{children:(C,ie)=>{var P=pt(),k=o(b(P),2),f=r(k),F=r(f),Y=o(r(F),2),q=r(Y);s(Y),s(F);var B=o(F,2),Z=r(B);{let _=ve(()=>e(W)?"success":"secondary");ye(Z,{get type(){return e(_)},children:(M,y)=>{T();var S=pe();w(()=>v(S,e(W)?"Granted":"Not Granted")),l(M,S)},$$slots:{default:!0}})}var L=o(Z,2);$e(L,{label:"",get checked(){return e(W)},set checked(_){t(W,_,!0)}}),s(B),s(f);var G=o(f,2),z=r(G),H=o(r(z),2),A=r(H);s(H),s(z);var p=o(z,2),c=r(p);{let _=ve(()=>e(X)?"success":"secondary");ye(c,{get type(){return e(_)},children:(M,y)=>{T();var S=pe();w(()=>v(S,e(X)?"Granted":"Not Granted")),l(M,S)},$$slots:{default:!0}})}var $=o(c,2);$e($,{label:"",get checked(){return e(X)},set checked(_){t(X,_,!0)}}),s(p),s(G);var N=o(G,2),ce=r(N);Q(ce,{type:"primary",onclick:Ce,get disabled(){return e(ee)},children:(_,M)=>{T();var y=pe();w(()=>v(y,e(ee)?"Saving...":"Save Consent Changes")),l(_,y)},$$slots:{default:!0}}),s(N),s(k),w((_,M)=>{v(q,`Consented: ${_??""}`),v(A,`Consented: ${M??""}`)},[()=>te(e(x).gdpr_consent_at),()=>te(e(x).marketing_consent_at)]),l(C,P)},$$slots:{default:!0}});var de=o(ae,2);se(de,{children:(C,ie)=>{var P=gt(),k=o(b(P),2),f=r(k),F=r(f),Y=r(F);Ye(Y,{class:"h-5 w-5 text-primary"}),T(2),s(F);var q=o(F,2);Q(q,{type:"secondary",onclick:Pe,get disabled(){return e(V)},children:(A,p)=>{var c=mt(),$=b(c);be($,{class:"mr-2 h-4 w-4"});var N=o($);w(()=>v(N,` ${e(V)?"Exporting...":"Export Data"}`)),l(A,c)},$$slots:{default:!0}}),s(f);var B=o(f,2);{var Z=A=>{var p=_t(),c=o(r(p),2),$=r(c),N=o($);{var ce=y=>{var S=ut(),ge=o(b(S));w(re=>v(ge,`Expires: ${re??""}`),[()=>te(e(I).expires_at)]),l(y,S)};U(N,y=>{e(I).expires_at&&y(ce)})}s(c);var _=o(c,2);{var M=y=>{Q(y,{type:"primary",onclick:()=>window.open(e(I)?.download_url,"_blank"),children:(S,ge)=>{var re=ft(),Te=b(re);be(Te,{class:"mr-2 h-4 w-4"}),T(),l(S,re)},$$slots:{default:!0}})};U(_,y=>{e(I).download_url&&y(M)})}s(p),w(()=>v($,`Format: ${e(I).format??""} `)),l(A,p)};U(B,A=>{e(I)&&A(Z)})}var L=o(B,2),G=r(L),z=r(G);tt(z,{class:"h-5 w-5 text-red-500"}),T(2),s(G);var H=o(G,2);Q(H,{type:"danger",onclick:ke,children:(A,p)=>{var c=xt(),$=b(c);at($,{class:"mr-2 h-4 w-4"}),T(),l(A,c)},$$slots:{default:!0}}),s(L),s(k),l(C,P)},$$slots:{default:!0}}),l(E,i)};U(D,E=>{e(x)&&E(u)},!0)}l(a,n)};U(Ge,a=>{e(K)?a(Se):a(je,!1)})}s(le);var Re=o(le,2);{let a=ve(()=>e(oe)?"Deleting...":"Delete All Data");ze(Re,{title:"Delete Contact Data",description:"This will permanently delete all data associated with this contact. This action cannot be undone.",get actionLabel(){return e(a)},actionType:"danger",onAction:Ae,onCancel:()=>{t(O,!1)},get open(){return e(O)},set open(n){t(O,n,!0)},children:(n,D)=>{var u=$t(),E=r(u),i=r(E);qe(i),T(2),s(E),s(u),Xe(i,()=>e(ne),h=>t(ne,h)),l(n,u)},$$slots:{default:!0}})}l(we,ue),Be()}export{Lt as component};
