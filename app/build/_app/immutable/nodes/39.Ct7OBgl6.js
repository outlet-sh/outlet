import"../chunks/DsnmJJEf.js";import{p as Dt,s as u,a as Ft,u as Ct,b as t,i as e,f as C,d as Mt,j as T,m as It,t as K,c as s,h as i,g as Pt,r as a,n as f}from"../chunks/odI--4Kw.js";import{d as Nt,s as E}from"../chunks/BNMK9zrr.js";import{a as o,t as Y,c as xe,f as m}from"../chunks/CCInJaqd.js";import{i as M}from"../chunks/COaB7F5h.js";import{e as Qe,i as Tt}from"../chunks/BohEjZuL.js";import{h as Rt}from"../chunks/hUjpWz_l.js";import{s as zt,a as jt}from"../chunks/DL1yFSKa.js";import{p as At}from"../chunks/DUPtV3xh.js";import{j as Bt,S as Et,T as Vt,U as Lt,k as Ot,V as Ut}from"../chunks/CORuJdE6.js";import{g as Wt}from"../chunks/zyvO4ju0.js";import{a as Kt}from"../chunks/LmhmopuU.js";import{M as Yt,g as qt,I as ye,B as ue,A as Ht,C as ze,h as Xe,f as Gt}from"../chunks/BzmQlP_K.js";import{L as je}from"../chunks/D716f0vp.js";import{S as Jt}from"../chunks/-2NNfqzy.js";import{B as Ae}from"../chunks/BD7k7D4N.js";import{S as we}from"../chunks/CtCtTz1D.js";import{M as Qt}from"../chunks/SPv-8oPy.js";import{C as Ze}from"../chunks/Pp_XzVGA.js";import{R as et}from"../chunks/DgVXPVjr.js";import{T as Xt}from"../chunks/DL9KTOrc.js";var Zt=m("<p> </p>"),ea=m('<div class="flex items-center gap-2 text-green-600"><!> <span class="text-sm font-medium">Configured</span></div>'),ta=m('<div class="flex items-center gap-2 text-text-muted"><!> <span class="text-sm">Using defaults</span></div>'),aa=m(`<div class="card-header"><h2 class="card-title">Sender Identity</h2> <p class="card-subtitle">Configure how your emails appear to recipients</p></div> <div class="border border-border rounded-lg"><div class="p-4 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="card-section-title">Email Sender</h3> <p class="card-section-subtitle"><!></p></div></div> <div class="flex items-center gap-2"><!></div></div> <div class="border-t border-border p-4 bg-bg-secondary"><div class="space-y-4 max-w-lg"><div><label for="from-name" class="form-label">From Name</label> <!> <p class="mt-1 text-xs text-text-muted">The name shown in the recipient's inbox</p></div> <div><label for="from-email" class="form-label">From Email</label> <!> <p class="mt-1 text-xs text-text-muted">Must be a verified email address with your email provider</p></div> <div><label for="reply-to" class="form-label">Reply-To Email</label> <!> <p class="mt-1 text-xs text-text-muted">Where replies will be sent (optional, defaults to From Email)</p></div> <div class="flex justify-end gap-3 pt-2"><!></div></div></div></div>`,1),ra=m("<!> <span>Verify Domain</span>",1),sa=m('<div class="border border-border rounded-lg p-6 text-center"><div class="w-12 h-12 mx-auto bg-base-200 rounded-lg flex items-center justify-center mb-4"><!></div> <h3 class="text-base font-medium mb-2">No domains configured</h3> <p class="text-sm text-base-content/60 mb-4"><!></p> <!></div>'),ia=m("<!> <span>Checking...</span>",1),oa=m("<!> <span>Refresh</span>",1),la=m('<tr><td><!></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all"> </code></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all max-w-xs block overflow-hidden text-ellipsis"> </code></td><td><span class="text-xs text-base-content/60 capitalize"> </span></td><td><button class="btn btn-ghost btn-xs" title="Copy value"><!></button></td></tr>'),na=m('<div class="p-4"><div class="flex items-center gap-2 mb-3"><!> <span class="text-sm font-medium">Add these DNS records to your domain</span></div> <div class="overflow-x-auto"><table class="table table-sm w-full"><thead><tr><th class="text-xs font-medium text-base-content/60 uppercase">Type</th><th class="text-xs font-medium text-base-content/60 uppercase">Name/Host</th><th class="text-xs font-medium text-base-content/60 uppercase">Value</th><th class="text-xs font-medium text-base-content/60 uppercase">Purpose</th><th class="w-10"></th></tr></thead><tbody></tbody></table></div> <div class="mt-4 p-3 bg-info/10 rounded-lg"><p class="text-xs text-info"><strong>Note:</strong> DNS changes can take up to 72 hours to propagate. Click "Refresh" to check verification status.</p></div></div>'),da=m('<div class="border border-border rounded-lg overflow-hidden mb-4 last:mb-0"><div class="p-4 flex items-center justify-between bg-base-200/50"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="font-medium"> </h3> <div class="flex items-center gap-2 mt-1"><span class="text-xs text-base-content/60">Verification:</span> <!> <span class="text-xs text-base-content/60 ml-2">DKIM:</span> <!></div></div></div> <div class="flex items-center gap-2"><!> <!></div></div> <!></div>'),ca=m('<div class="card-header"><h2 class="card-title">Domain Verification</h2> <p class="card-subtitle">Verify your domain to improve email deliverability and enable DKIM signing</p></div> <!>',1),va=m(`<div class="flex items-start gap-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div><h3 class="card-title">How it works</h3> <p class="card-subtitle">These settings are used as defaults for all emails sent from this brand, including campaigns, sequences, and transactional emails.
						You can override these settings on a per-campaign or per-sequence basis.</p></div></div>`),ma=m('<div class="space-y-6"><!> <!> <!></div>'),ua=m("<!> <span>Setting up...</span>",1),fa=m("<!> <span>Verify Domain</span>",1),pa=m(`<div class="space-y-4"><div class="p-4 bg-info/10 rounded-lg"><h4 class="font-medium text-sm mb-2">What is MAIL FROM?</h4> <p class="text-xs text-base-content/70">The MAIL FROM domain (also called "envelope sender" or "Return-Path") is used for SPF authentication and bounce handling.
				Setting a custom MAIL FROM domain ensures your emails pass SPF checks with your own domain instead of amazonses.com.</p></div> <div><label for="mail-from-subdomain" class="form-label">MAIL FROM Subdomain</label> <div class="flex items-center gap-2"><!> <span class="text-sm text-base-content/60"> </span></div> <p class="mt-1 text-xs text-text-muted">Default is "mail". Use "bounce", "email", or "ses" if "mail" is already in use on your domain.</p></div> <div class="p-3 bg-warning/10 rounded-lg"><p class="text-xs text-warning"><strong>Note:</strong> Make sure the subdomain you choose isn't already used for other services (like your mail server).
				You'll need to add DNS records for this subdomain.</p></div> <div class="flex justify-end gap-3 pt-2"><!> <!></div></div>`),_a=m("<!> <!> <!> <!>",1);function Ea(tt,at){Dt(at,!0);const rt=()=>jt(At,"$page",st),[st,it]=zt();let Be=T(()=>rt().params.brandSlug),fe=u(!0),$e=u(!1),pe=u(!1),n=u(null),y=u(""),S=u(Ft([])),se=u(null),_e=u(!1),Se=u(null),Q=u(null),ke=u(!1),X=u(null),ie=u(!1),ge=u("mail"),oe=u(""),O=u(""),le=u(""),De=null;Ct(()=>(Fe(),()=>{De&&De()}));function ot(r){const l=Wt();l.isConnected()||l.connect(Kt.user?.id),l.send("subscribe",{org_id:r});const k=l.on("domain_identity_update",_=>{console.log("[WebSocket] Domain identity update received:",_),t(S,e(S).map(F=>F.id===_.id?{...F,verification_status:_.verification_status,dkim_status:_.dkim_status,mail_from_status:_.mail_from_status,last_checked_at:_.last_checked_at}:F),!0)}),D=l.on("domain_identity_created",_=>{console.log("[WebSocket] Domain identity created:",_),Fe()});De=()=>{k(),D()}}async function Fe(){t(fe,!0),t(y,"");try{if(!e(Be)){t(y,"No brand selected"),t(fe,!1);return}t(n,await Bt({},e(Be)),!0),ot(e(n).id),t(oe,e(n).from_name||"",!0),t(O,e(n).from_email||"",!0),t(le,e(n).reply_to||"",!0);try{const r=await Et({},e(n).id);t(S,r.identities||[],!0)}catch(r){console.error("Failed to load domain identities:",r),t(S,[],!0)}}catch(r){console.error("Failed to load data:",r),t(y,r.message||"Failed to load data",!0)}finally{t(fe,!1)}}function lt(){t(ge,"mail"),t(ie,!0)}async function nt(){if(e(n)){t(_e,!0),t(y,"");try{const r=await Vt({},{domain:"",mail_from_subdomain:e(ge)||"mail"},e(n).id);t(S,[...e(S),r],!0),t(ie,!1)}catch(r){console.error("Failed to create domain identity:",r),t(y,r.message||"Failed to create domain identity",!0)}finally{t(_e,!1)}}}async function dt(r){if(e(n)){t(se,r,!0),t(y,"");try{const l=await Ut({},e(n).id,r);t(S,e(S).map(k=>k.id===r?l:k),!0)}catch(l){console.error("Failed to refresh domain identity:",l),t(y,l.message||"Failed to refresh domain identity",!0)}finally{t(se,null)}}}function ct(r){t(X,r,!0),t(ke,!0)}async function vt(){if(!e(n)||!e(X))return;const r=e(X).id;t(Q,r,!0),t(y,"");try{await Lt({},e(n).id,r),t(S,e(S).filter(l=>l.id!==r),!0)}catch(l){throw console.error("Failed to delete domain identity:",l),t(y,l.message||"Failed to delete domain identity",!0),l}finally{t(Q,null),t(X,null)}}function mt(r,l){navigator.clipboard.writeText(r),t(Se,l,!0),setTimeout(()=>{t(Se,null)},2e3)}function Ee(r){switch(r){case"Success":case"success":return{variant:"success",label:"Verified"};case"Pending":case"pending":return{variant:"warning",label:"Pending"};case"Failed":case"failed":case"temporary_failure":return{variant:"error",label:"Failed"};case"not_started":case"NotStarted":return{variant:"default",label:"Not Started"};default:return{variant:"default",label:r||"Unknown"}}}async function ut(){if(e(n)){t($e,!0),t(pe,!1),t(y,"");try{await Ot({},{from_name:e(oe)||void 0,from_email:e(O)||void 0,reply_to:e(le)||void 0},e(n).id),t(pe,!0),setTimeout(()=>{t(pe,!1)},2e3),await Fe()}catch(r){console.error("Failed to save email settings:",r),t(y,r.message||"Failed to save email settings",!0)}finally{t($e,!1)}}}let ft=T(()=>e(n)&&(e(oe)!==(e(n).from_name||"")||e(O)!==(e(n).from_email||"")||e(le)!==(e(n).reply_to||""))),Ve=T(()=>e(n)?.from_name||e(n)?.from_email);var Le=_a();Rt("1fr6do4",r=>{It(()=>{Pt.title=`Email Settings - ${(e(n)?.name||"Loading")??""}`})});var Oe=C(Le);{var pt=r=>{Ht(r,{type:"error",title:"Error",children:(l,k)=>{var D=Zt(),_=s(D,!0);a(D),K(()=>E(_,e(y))),o(l,D)},$$slots:{default:!0}})};M(Oe,r=>{e(y)&&r(pt)})}var Ue=i(Oe,2);{var _t=r=>{je(r,{size:"large"})},gt=r=>{var l=ma(),k=s(l);ze(k,{children:(F,ne)=>{var V=aa(),q=i(C(V),2),U=s(q),H=s(U),v=s(H),R=s(v);Qt(R,{class:"h-6 w-6 text-blue-600"}),a(v);var w=i(v,2),z=i(s(w),2),c=s(z);{var W=d=>{var x=Y();K(()=>E(x,`${(e(n)?.from_name||"No name")??""} <${(e(n)?.from_email||"No email")??""}>`)),o(d,x)},$=d=>{var x=Y("Not configured - using platform defaults");o(d,x)};M(c,d=>{e(Ve)?d(W):d($,!1)})}a(z),a(w),a(H);var b=i(H,2),I=s(b);{var G=d=>{var x=ea(),g=s(x);Xe(g,{class:"h-5 w-5"}),f(2),a(x),o(d,x)},p=d=>{var x=ta(),g=s(x);Ze(g,{class:"h-5 w-5"}),f(2),a(x),o(d,x)};M(I,d=>{e(Ve)?d(G):d(p,!1)})}a(b),a(U);var j=i(U,2),Z=s(j),A=s(Z),de=i(s(A),2);ye(de,{id:"from-name",type:"text",placeholder:"Acme Inc",get value(){return e(oe)},set value(d){t(oe,d,!0)}}),f(2),a(A);var ee=i(A,2),he=i(s(ee),2);ye(he,{id:"from-email",type:"email",placeholder:"hello@yourdomain.com",get value(){return e(O)},set value(d){t(O,d,!0)}}),f(2),a(ee);var ce=i(ee,2),be=i(s(ce),2);ye(be,{id:"reply-to",type:"email",placeholder:"support@yourdomain.com",get value(){return e(le)},set value(d){t(le,d,!0)}}),f(2),a(ce);var ve=i(ce,2),Ce=s(ve);{let d=T(()=>!e(ft));Jt(Ce,{label:"Save Settings",get saving(){return e($e)},get saved(){return e(pe)},onclick:ut,get disabled(){return e(d)}})}a(ve),a(Z),a(j),a(q),o(F,V)},$$slots:{default:!0}});var D=i(k,2);ze(D,{children:(F,ne)=>{var V=ca(),q=i(C(V),2);{var U=v=>{var R=sa(),w=s(R),z=s(w);we(z,{class:"h-6 w-6 text-base-content/50"}),a(w);var c=i(w,4),W=s(c);{var $=p=>{var j=Y("Set your From Email above first, then verify your domain.");o(p,j)},b=p=>{var j=Y("Verify your domain to authenticate emails and improve deliverability.");o(p,j)};M(W,p=>{e(O)?p(b,!1):p($)})}a(c);var I=i(c,2);{var G=p=>{ue(p,{variant:"primary",onclick:lt,children:(j,Z)=>{var A=ra(),de=C(A);we(de,{class:"h-4 w-4"}),f(2),o(j,A)},$$slots:{default:!0}})};M(I,p=>{e(O)&&p(G)})}a(R),o(v,R)},H=v=>{var R=xe(),w=C(R);Qe(w,17,()=>e(S),z=>z.id,(z,c)=>{const W=T(()=>Ee(e(c).verification_status)),$=T(()=>Ee(e(c).dkim_status));var b=da(),I=s(b),G=s(I),p=s(G),j=s(p);we(j,{class:"h-5 w-5 text-primary"}),a(p);var Z=i(p,2),A=s(Z),de=s(A,!0);a(A);var ee=i(A,2),he=i(s(ee),2);Ae(he,{get variant(){return e(W).variant},size:"sm",children:(g,L)=>{f();var P=Y();K(()=>E(P,e(W).label)),o(g,P)},$$slots:{default:!0}});var ce=i(he,4);Ae(ce,{get variant(){return e($).variant},size:"sm",children:(g,L)=>{f();var P=Y();K(()=>E(P,e($).label)),o(g,P)},$$slots:{default:!0}}),a(ee),a(Z),a(G);var be=i(G,2),ve=s(be);{let g=T(()=>e(se)!==null||e(Q)!==null);ue(ve,{variant:"ghost",size:"sm",onclick:()=>dt(e(c).id),get disabled(){return e(g)},children:(L,P)=>{var J=xe(),te=C(J);{var ae=h=>{var N=ia(),me=C(N);et(me,{class:"h-4 w-4 animate-spin"}),f(2),o(h,N)},re=h=>{var N=oa(),me=C(N);et(me,{class:"h-4 w-4"}),f(2),o(h,N)};M(te,h=>{e(se)===e(c).id?h(ae):h(re,!1)})}o(L,J)},$$slots:{default:!0}})}var Ce=i(ve,2);{let g=T(()=>e(se)!==null||e(Q)!==null);ue(Ce,{variant:"ghost",size:"sm",onclick:()=>ct(e(c)),get disabled(){return e(g)},children:(L,P)=>{var J=xe(),te=C(J);{var ae=h=>{je(h,{size:"normal"})},re=h=>{Xt(h,{class:"h-4 w-4 text-error"})};M(te,h=>{e(Q)===e(c).id?h(ae):h(re,!1)})}o(L,J)},$$slots:{default:!0}})}a(be),a(I);var d=i(I,2);{var x=g=>{var L=na(),P=s(L),J=s(P);Ze(J,{class:"h-4 w-4 text-warning"}),f(2),a(P);var te=i(P,2),ae=s(te),re=i(s(ae));Qe(re,21,()=>e(c).dns_records,Tt,(h,N,me)=>{const Ke=T(()=>`${e(c).id}-${me}`);var Me=la(),Ie=s(Me),bt=s(Ie);Ae(bt,{variant:"default",size:"sm",children:(B,ga)=>{f();var Je=Y();K(()=>E(Je,e(N).type)),o(B,Je)},$$slots:{default:!0}}),a(Ie);var Pe=i(Ie),Ye=s(Pe),xt=s(Ye,!0);a(Ye),a(Pe);var Ne=i(Pe),qe=s(Ne),yt=s(qe,!0);a(qe),a(Ne);var Te=i(Ne),He=s(Te),wt=s(He,!0);a(He),a(Te);var Ge=i(Te),Re=s(Ge);Re.__click=()=>mt(e(N).value,e(Ke));var $t=s(Re);{var St=B=>{Xe(B,{class:"h-3 w-3 text-success"})},kt=B=>{Gt(B,{class:"h-3 w-3"})};M($t,B=>{e(Se)===e(Ke)?B(St):B(kt,!1)})}a(Re),a(Ge),a(Me),K(B=>{E(xt,e(N).name),E(yt,e(N).value),E(wt,B)},[()=>e(N).purpose.replace(/_/g," ")]),o(h,Me)}),a(re),a(ae),a(te),f(2),a(L),o(g,L)};M(d,g=>{e(c).dns_records&&e(c).dns_records.length>0&&g(x)})}a(b),K(()=>E(de,e(c).domain)),o(z,b)}),o(v,R)};M(q,v=>{e(S).length===0?v(U):v(H,!1)})}o(F,V)},$$slots:{default:!0}});var _=i(D,2);ze(_,{children:(F,ne)=>{var V=va();o(F,V)},$$slots:{default:!0}}),a(l),o(r,l)};M(Ue,r=>{e(fe)?r(_t):r(gt,!1)})}var We=i(Ue,2);Yt(We,{get open(){return e(ie)},onclose:()=>{t(ie,!1)},title:"Domain Verification Setup",children:(r,l)=>{var k=pa(),D=i(s(k),2),_=i(s(D),2),F=s(_);ye(F,{id:"mail-from-subdomain",type:"text",placeholder:"mail",class:"w-32",get value(){return e(ge)},set value(v){t(ge,v,!0)}});var ne=i(F,2),V=s(ne);a(ne),a(_),f(2),a(D);var q=i(D,4),U=s(q);ue(U,{variant:"ghost",onclick:()=>{t(ie,!1)},children:(v,R)=>{f();var w=Y("Cancel");o(v,w)},$$slots:{default:!0}});var H=i(U,2);ue(H,{variant:"primary",onclick:nt,get disabled(){return e(_e)},children:(v,R)=>{var w=xe(),z=C(w);{var c=$=>{var b=ua(),I=C(b);je(I,{size:"normal"}),f(2),o($,b)},W=$=>{var b=fa(),I=C(b);we(I,{class:"h-4 w-4"}),f(2),o($,b)};M(z,$=>{e(_e)?$(c):$(W,!1)})}o(v,w)},$$slots:{default:!0}}),a(q),a(k),K(v=>E(V,`.${v??""}`),[()=>e(O)?.split("@")[1]||"yourdomain.com"]),o(r,k)},$$slots:{default:!0}});var ht=i(We,2);{let r=T(()=>e(X)?.domain),l=T(()=>e(Q)!==null);qt(ht,{get open(){return e(ke)},onclose:()=>{t(ke,!1),t(X,null)},title:"Delete Domain Identity",get description(){return`Are you sure you want to delete the domain identity for ${e(r)??""}? You will need to set up DNS records again if you want to verify this domain later.`},actionLabel:"Delete",actionType:"danger",onAction:vt,get loading(){return e(l)}})}o(tt,Le),Mt(),it()}Nt(["click"]);export{Ea as component};
