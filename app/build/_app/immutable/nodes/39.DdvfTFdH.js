import"../chunks/DsnmJJEf.js";import{p as ut,s as b,a as ft,u as pt,b as s,i as e,f as R,d as _t,j as M,m as gt,g as bt,h as o,c as a,r as t,t as K,n as p}from"../chunks/odI--4Kw.js";import{d as ht,s as F}from"../chunks/BNMK9zrr.js";import{a as l,f as u,t as L,c as Re}from"../chunks/CCInJaqd.js";import{i as S}from"../chunks/COaB7F5h.js";import{e as Me,i as xt}from"../chunks/BohEjZuL.js";import{h as yt}from"../chunks/hUjpWz_l.js";import{s as wt,a as $t}from"../chunks/DL1yFSKa.js";import{p as kt}from"../chunks/B7rQfUFF.js";import{j as St,S as Ct,k as Dt,T as Ft,U as It}from"../chunks/G69xwvxa.js";import{g as Pt}from"../chunks/6RWnukgK.js";import{A as Nt,C as he,I as xe,h as Ve,B as Ue,f as jt}from"../chunks/Cz2jU64R.js";import{L as We}from"../chunks/D716f0vp.js";import{S as Bt}from"../chunks/C0Br8wUz.js";import{B as ye}from"../chunks/BD7k7D4N.js";import{M as Et}from"../chunks/BeY3cN0s.js";import{C as Ae}from"../chunks/5siEa1ZE.js";import{S as we}from"../chunks/CpMPOqYs.js";import{R as Tt}from"../chunks/D-JgX4sQ.js";var zt=u("<p> </p>"),Rt=u('<div class="flex items-center gap-2 text-green-600"><!> <span class="text-sm font-medium">Configured</span></div>'),Mt=u('<div class="flex items-center gap-2 text-text-muted"><!> <span class="text-sm">Using defaults</span></div>'),Vt=u(`<div class="card-header"><h2 class="card-title">Sender Identity</h2> <p class="card-subtitle">Configure how your emails appear to recipients</p></div> <div class="border border-border rounded-lg"><div class="p-4 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="card-section-title">Email Sender</h3> <p class="card-section-subtitle"><!></p></div></div> <div class="flex items-center gap-2"><!></div></div> <div class="border-t border-border p-4 bg-bg-secondary"><div class="space-y-4 max-w-lg"><div><label for="from-name" class="form-label">From Name</label> <!> <p class="mt-1 text-xs text-text-muted">The name shown in the recipient's inbox</p></div> <div><label for="from-email" class="form-label">From Email</label> <!> <p class="mt-1 text-xs text-text-muted">Must be a verified email address with your email provider</p></div> <div><label for="reply-to" class="form-label">Reply-To Email</label> <!> <p class="mt-1 text-xs text-text-muted">Where replies will be sent (optional, defaults to From Email)</p></div> <div class="flex justify-end gap-3 pt-2"><!></div></div></div></div>`,1),Ut=u("<!> <span>Setting up...</span>",1),Wt=u("<!> <span>Verify Domain</span>",1),At=u('<div class="border border-border rounded-lg p-6 text-center"><div class="w-12 h-12 mx-auto bg-base-200 rounded-lg flex items-center justify-center mb-4"><!></div> <h3 class="text-base font-medium mb-2">No domains configured</h3> <p class="text-sm text-base-content/60 mb-4"><!></p> <!></div>'),Kt=u("<!> <span>Refresh</span>",1),Lt=u('<tr><td><!></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all"> </code></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all max-w-xs block overflow-hidden text-ellipsis"> </code></td><td><span class="text-xs text-base-content/60 capitalize"> </span></td><td><button class="btn btn-ghost btn-xs" title="Copy value"><!></button></td></tr>'),qt=u('<div class="p-4"><div class="flex items-center gap-2 mb-3"><!> <span class="text-sm font-medium">Add these DNS records to your domain</span></div> <div class="overflow-x-auto"><table class="table table-sm w-full"><thead><tr><th class="text-xs font-medium text-base-content/60 uppercase">Type</th><th class="text-xs font-medium text-base-content/60 uppercase">Name/Host</th><th class="text-xs font-medium text-base-content/60 uppercase">Value</th><th class="text-xs font-medium text-base-content/60 uppercase">Purpose</th><th class="w-10"></th></tr></thead><tbody></tbody></table></div> <div class="mt-4 p-3 bg-info/10 rounded-lg"><p class="text-xs text-info"><strong>Note:</strong> DNS changes can take up to 72 hours to propagate. Click "Refresh" to check verification status.</p></div></div>'),Ht=u('<div class="border border-border rounded-lg overflow-hidden mb-4 last:mb-0"><div class="p-4 flex items-center justify-between bg-base-200/50"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="font-medium"> </h3> <div class="flex items-center gap-2 mt-1"><span class="text-xs text-base-content/60">Verification:</span> <!> <span class="text-xs text-base-content/60 ml-2">DKIM:</span> <!></div></div></div> <!></div> <!></div>'),Ot=u('<div class="card-header"><h2 class="card-title">Domain Verification</h2> <p class="card-subtitle">Verify your domain to improve email deliverability and enable DKIM signing</p></div> <!>',1),Yt=u(`<div class="flex items-start gap-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div><h3 class="card-title">How it works</h3> <p class="card-subtitle">These settings are used as defaults for all emails sent from this brand, including campaigns, sequences, and transactional emails.
						You can override these settings on a per-campaign or per-sequence basis.</p></div></div>`),Gt=u('<div class="space-y-6"><!> <!> <!></div>'),Jt=u("<!> <!>",1);function ga(Ke,Le){ut(Le,!0);const qe=()=>$t(kt,"$page",He),[He,Oe]=wt();let $e=M(()=>qe().params.brandSlug),te=b(!0),le=b(!1),ae=b(!1),n=b(null),h=b(""),x=b(ft([])),re=b(!1),se=b(!1),ne=b(null),G=b(""),V=b(""),J=b(""),de=null;pt(()=>(ce(),()=>{de&&de()}));function Ye(r){const c=Pt();c.isConnected()||c.connect(),c.send("subscribe",{org_id:r});const I=c.on("domain_identity_update",_=>{console.log("[WebSocket] Domain identity update received:",_),s(x,e(x).map(C=>C.id===_.id?{...C,verification_status:_.verification_status,dkim_status:_.dkim_status,mail_from_status:_.mail_from_status,last_checked_at:_.last_checked_at}:C),!0)}),P=c.on("domain_identity_created",_=>{console.log("[WebSocket] Domain identity created:",_),ce()});de=()=>{I(),P()}}async function ce(){s(te,!0),s(h,"");try{if(!e($e)){s(h,"No brand selected"),s(te,!1);return}s(n,await St({},e($e)),!0),Ye(e(n).id),s(G,e(n).from_name||"",!0),s(V,e(n).from_email||"",!0),s(J,e(n).reply_to||"",!0);try{const r=await Ct({},orgId);s(x,r.identities||[],!0)}catch(r){console.error("Failed to load domain identities:",r),s(x,[],!0)}}catch(r){console.error("Failed to load data:",r),s(h,r.message||"Failed to load data",!0)}finally{s(te,!1)}}async function Ge(){if(e(n)){s(se,!0),s(h,"");try{const r=await It({},{domain:""},e(n).id);s(x,[...e(x),r],!0)}catch(r){console.error("Failed to create domain identity:",r),s(h,r.message||"Failed to create domain identity",!0)}finally{s(se,!1)}}}async function Je(r){if(e(n)){s(re,!0),s(h,"");try{const c=await Ft({},e(n).id,r);s(x,e(x).map(I=>I.id===r?c:I),!0)}catch(c){console.error("Failed to refresh domain identity:",c),s(h,c.message||"Failed to refresh domain identity",!0)}finally{s(re,!1)}}}function Qe(r,c){navigator.clipboard.writeText(r),s(ne,c,!0),setTimeout(()=>{s(ne,null)},2e3)}function ke(r){switch(r){case"Success":case"success":return{variant:"success",label:"Verified"};case"Pending":case"pending":return{variant:"warning",label:"Pending"};case"Failed":case"failed":case"temporary_failure":return{variant:"error",label:"Failed"};default:return{variant:"default",label:r||"Unknown"}}}async function Xe(){if(e(n)){s(le,!0),s(ae,!1),s(h,"");try{await Dt({},{from_name:e(G)||void 0,from_email:e(V)||void 0,reply_to:e(J)||void 0},e(n).id),s(ae,!0),setTimeout(()=>{s(ae,!1)},2e3),await ce()}catch(r){console.error("Failed to save email settings:",r),s(h,r.message||"Failed to save email settings",!0)}finally{s(le,!1)}}}let Ze=M(()=>e(n)&&(e(G)!==(e(n).from_name||"")||e(V)!==(e(n).from_email||"")||e(J)!==(e(n).reply_to||""))),Se=M(()=>e(n)?.from_name||e(n)?.from_email);var Ce=Jt();yt("1fr6do4",r=>{gt(()=>{bt.title=`Email Settings - ${(e(n)?.name||"Loading")??""}`})});var De=R(Ce);{var et=r=>{Nt(r,{type:"error",title:"Error",children:(c,I)=>{var P=zt(),_=a(P,!0);t(P),K(()=>F(_,e(h))),l(c,P)},$$slots:{default:!0}})};S(De,r=>{e(h)&&r(et)})}var tt=o(De,2);{var at=r=>{We(r,{size:"large"})},rt=r=>{var c=Gt(),I=a(c);he(I,{children:(C,Fe)=>{var U=Vt(),ie=o(R(U),2),Q=a(ie),X=a(Q),y=a(X),N=a(y);Et(N,{class:"h-6 w-6 text-blue-600"}),t(y);var j=o(y,2),B=o(a(j),2),f=a(B);{var q=i=>{var d=L();K(()=>F(d,`${(e(n)?.from_name||"No name")??""} <${(e(n)?.from_email||"No email")??""}>`)),l(i,d)},H=i=>{var d=L("Not configured - using platform defaults");l(i,d)};S(f,i=>{e(Se)?i(q):i(H,!1)})}t(B),t(j),t(X);var E=o(X,2),W=a(E);{var A=i=>{var d=Rt(),m=a(d);Ve(m,{class:"h-5 w-5"}),p(2),t(d),l(i,d)},v=i=>{var d=Mt(),m=a(d);Ae(m,{class:"h-5 w-5"}),p(2),t(d),l(i,d)};S(W,i=>{e(Se)?i(A):i(v,!1)})}t(E),t(Q);var w=o(Q,2),O=a(w),$=a(O),Z=o(a($),2);xe(Z,{id:"from-name",type:"text",placeholder:"Acme Inc",get value(){return e(G)},set value(i){s(G,i,!0)}}),p(2),t($);var T=o($,2),Y=o(a(T),2);xe(Y,{id:"from-email",type:"email",placeholder:"hello@yourdomain.com",get value(){return e(V)},set value(i){s(V,i,!0)}}),p(2),t(T);var g=o(T,2),D=o(a(g),2);xe(D,{id:"reply-to",type:"email",placeholder:"support@yourdomain.com",get value(){return e(J)},set value(i){s(J,i,!0)}}),p(2),t(g);var z=o(g,2),ve=a(z);{let i=M(()=>!e(Ze));Bt(ve,{label:"Save Settings",get saving(){return e(le)},get saved(){return e(ae)},onclick:Xe,get disabled(){return e(i)}})}t(z),t(O),t(w),t(ie),l(C,U)},$$slots:{default:!0}});var P=o(I,2);he(P,{children:(C,Fe)=>{var U=Ot(),ie=o(R(U),2);{var Q=y=>{var N=At(),j=a(N),B=a(j);we(B,{class:"h-6 w-6 text-base-content/50"}),t(j);var f=o(j,4),q=a(f);{var H=v=>{var w=L("Set your From Email above first, then verify your domain.");l(v,w)},E=v=>{var w=L("Verify your domain to authenticate emails and improve deliverability.");l(v,w)};S(q,v=>{e(V)?v(E,!1):v(H)})}t(f);var W=o(f,2);{var A=v=>{Ue(v,{variant:"primary",onclick:Ge,get disabled(){return e(se)},children:(w,O)=>{var $=Re(),Z=R($);{var T=g=>{var D=Ut(),z=R(D);We(z,{size:"normal"}),p(2),l(g,D)},Y=g=>{var D=Wt(),z=R(D);we(z,{class:"h-4 w-4"}),p(2),l(g,D)};S(Z,g=>{e(se)?g(T):g(Y,!1)})}l(w,$)},$$slots:{default:!0}})};S(W,v=>{e(V)&&v(A)})}t(N),l(y,N)},X=y=>{var N=Re(),j=R(N);Me(j,17,()=>e(x),B=>B.id,(B,f)=>{const q=M(()=>ke(e(f).verification_status)),H=M(()=>ke(e(f).dkim_status));var E=Ht(),W=a(E),A=a(W),v=a(A),w=a(v);we(w,{class:"h-5 w-5 text-primary"}),t(v);var O=o(v,2),$=a(O),Z=a($,!0);t($);var T=o($,2),Y=o(a(T),2);ye(Y,{get variant(){return e(q).variant},size:"sm",children:(i,d)=>{p();var m=L();K(()=>F(m,e(q).label)),l(i,m)},$$slots:{default:!0}});var g=o(Y,4);ye(g,{get variant(){return e(H).variant},size:"sm",children:(i,d)=>{p();var m=L();K(()=>F(m,e(H).label)),l(i,m)},$$slots:{default:!0}}),t(T),t(O),t(A);var D=o(A,2);Ue(D,{variant:"ghost",size:"sm",onclick:()=>Je(e(f).id),get disabled(){return e(re)},children:(i,d)=>{var m=Kt(),me=R(m);{let oe=M(()=>e(re)?"animate-spin":"");Tt(me,{get class(){return`h-4 w-4 ${e(oe)??""}`}})}p(2),l(i,m)},$$slots:{default:!0}}),t(W);var z=o(W,2);{var ve=i=>{var d=qt(),m=a(d),me=a(m);Ae(me,{class:"h-4 w-4 text-warning"}),p(2),t(m);var oe=o(m,2),Ie=a(oe),Pe=o(a(Ie));Me(Pe,21,()=>e(f).dns_records,xt,(st,ee,it)=>{const Ne=M(()=>`${e(f).id}-${it}`);var ue=Lt(),fe=a(ue),ot=a(fe);ye(ot,{variant:"default",size:"sm",children:(k,Qt)=>{p();var ze=L();K(()=>F(ze,e(ee).type)),l(k,ze)},$$slots:{default:!0}}),t(fe);var pe=o(fe),je=a(pe),lt=a(je,!0);t(je),t(pe);var _e=o(pe),Be=a(_e),nt=a(Be,!0);t(Be),t(_e);var ge=o(_e),Ee=a(ge),dt=a(Ee,!0);t(Ee),t(ge);var Te=o(ge),be=a(Te);be.__click=()=>Qe(e(ee).value,e(Ne));var ct=a(be);{var vt=k=>{Ve(k,{class:"h-3 w-3 text-success"})},mt=k=>{jt(k,{class:"h-3 w-3"})};S(ct,k=>{e(ne)===e(Ne)?k(vt):k(mt,!1)})}t(be),t(Te),t(ue),K(k=>{F(lt,e(ee).name),F(nt,e(ee).value),F(dt,k)},[()=>e(ee).purpose.replace(/_/g," ")]),l(st,ue)}),t(Pe),t(Ie),t(oe),p(2),t(d),l(i,d)};S(z,i=>{e(f).dns_records&&e(f).dns_records.length>0&&i(ve)})}t(E),K(()=>F(Z,e(f).domain)),l(B,E)}),l(y,N)};S(ie,y=>{e(x).length===0?y(Q):y(X,!1)})}l(C,U)},$$slots:{default:!0}});var _=o(P,2);he(_,{children:(C,Fe)=>{var U=Yt();l(C,U)},$$slots:{default:!0}}),t(c),l(r,c)};S(tt,r=>{e(te)?r(at):r(rt,!1)})}l(Ke,Ce),_t(),Oe()}ht(["click"]);export{ga as component};
