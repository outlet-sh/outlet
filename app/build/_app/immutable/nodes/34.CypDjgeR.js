import"../chunks/DsnmJJEf.js";import{p as He,s as p,a as Je,u as Ye,b as t,i as e,j as se,f as w,d as Ge,h as a,c as l,t as V,n as O,r as s}from"../chunks/EWi02PFm.js";import{s as J}from"../chunks/CMlTvFs1.js";import{f as c,a as o,t as Y,c as le}from"../chunks/m1NGduc7.js";import{i as z}from"../chunks/Bv3BEGQz.js";import{e as Qe,i as Ve}from"../chunks/BU0M2qTC.js";import{s as We,a as Xe}from"../chunks/P1cg2ZFr.js";import{p as Ze}from"../chunks/BqHCot3g.js";import{I as et,J as tt,K as rt,L as at}from"../chunks/DtWifhjl.js";import{B as G,M as st,I as oe,S as lt,c as ot,A as ge,C as xe}from"../chunks/_5RYljtH.js";import{E as it}from"../chunks/B8lGLVp_.js";import{L as ye}from"../chunks/UGmSaeWH.js";import{B as be}from"../chunks/Bj7i9l3f.js";import{g as dt}from"../chunks/DkaYLNo_.js";import{P as $e}from"../chunks/xQC1cKWF.js";import{L as nt}from"../chunks/BHI5FN7e.js";import{S as ut}from"../chunks/DkjiDKpX.js";import{T as vt}from"../chunks/B-YSeal5.js";var ct=c("<p> </p>"),mt=c("<!> Add Field",1),pt=c('<div class="flex justify-center py-12"><!></div>'),ft=c("<!> Add Your First Field",1),_t=c('<span class="text-text-muted">Optional</span>'),ht=c('<tr><td class="font-medium"> </td><td><code class="text-xs bg-bg-secondary px-1.5 py-0.5 rounded"> </code></td><td><!></td><td><!></td><td class="text-right"><div class="flex justify-end gap-2"><!> <!></div></td></tr>'),gt=c('<div class="overflow-x-auto"><table class="table w-full"><thead><tr><th>Name</th><th>Merge Tag</th><th>Type</th><th>Required</th><th class="text-right">Actions</th></tr></thead><tbody></tbody></table></div>'),xt=c('<h4 class="font-medium text-text mb-2">Using Merge Tags</h4> <p class="text-sm text-text-muted mb-3">Use merge tags in your email templates to personalize content for each subscriber.</p> <div class="bg-bg-secondary p-3 rounded-lg"><code class="text-sm font-mono text-text"></code></div>',1),yt=c("<!> <!>",1),bt=c("<!> <!>",1),$t=c('<div><label for="field-options" class="form-label">Options</label> <!> <p class="mt-1 text-xs text-text-muted">Comma-separated list of options</p></div>'),Ft=c("<p> </p>"),wt=c('<div class="space-y-4"><div><label for="field-name" class="form-label">Field Name</label> <!> <p class="mt-1 text-xs text-text-muted">The label shown on the subscribe form</p></div> <div><label for="field-key" class="form-label">Merge Tag Key</label> <!> <p class="mt-1 text-xs text-text-muted"> </p></div> <div><label for="field-type" class="form-label">Field Type</label> <!></div> <!> <div><label for="field-placeholder" class="form-label">Placeholder (optional)</label> <!></div> <div><!> <p class="text-xs text-text-muted mt-1 ml-6">Subscribers must fill in this field to subscribe</p></div> <!></div>'),kt=c('<!> <div class="space-y-4"><div class="flex justify-between items-center"><div><h3 class="font-medium text-text">Custom Fields</h3> <p class="text-sm text-text-muted">Add custom fields to collect additional information from subscribers</p></div> <!></div> <!></div> <!>',1);function Ut(Fe,we){He(we,!0);const ke=()=>Xe(Ze,"$page",Ce),[Ce,Pe]=We();dt();let W=se(()=>ke().params.id),ie=p(Je([])),de=p(!0),j=p(!1),Q=p(!1),k=p(""),g=p(""),L=p("text"),R=p(!1),D=p(""),U=p(""),M=p(null),X=p(null),B=p("");Ye(()=>{ne()});async function ne(){t(de,!0);try{const r=await et({},e(W));t(ie,r.fields||[],!0)}catch(r){console.error("Failed to load custom fields:",r)}finally{t(de,!1)}}function Ae(r){return r.toLowerCase().replace(/[^a-z0-9]+/g,"_").replace(/^_|_$/g,"")}function Se(){e(M)||t(g,Ae(e(k)),!0)}function Z(){t(k,""),t(g,""),t(L,"text"),t(R,!1),t(D,""),t(U,""),t(M,null)}function Te(r){t(M,r,!0),t(k,r.name,!0),t(g,r.field_key,!0),t(L,r.field_type,!0),t(R,r.required,!0),t(D,r.placeholder||"",!0),t(U,r.options?.join(", ")||"",!0),t(j,!0)}async function qe(){if(!(!e(k)||!e(g))){t(Q,!0),t(B,"");try{const r=e(L)==="dropdown"&&e(U)?e(U).split(",").map(d=>d.trim()).filter(d=>d):void 0;e(M)?await tt({},{name:e(k),field_key:e(g),field_type:e(L),required:e(R),placeholder:e(D),options:r},e(W),e(M).id):await rt({},{name:e(k),field_key:e(g),field_type:e(L),required:e(R),placeholder:e(D),options:r},e(W)),t(j,!1),Z(),await ne()}catch(r){t(B,r.message||"Failed to save custom field",!0)}finally{t(Q,!1)}}}async function ze(r){if(confirm("Are you sure you want to delete this custom field? All data for this field will be lost.")){t(X,r,!0);try{await at({},e(W),r),await ne()}catch(d){t(B,d.message||"Failed to delete custom field",!0)}finally{t(X,null)}}}var me=kt(),pe=w(me);{var Le=r=>{ge(r,{type:"error",title:"Error",class:"mb-4",children:(d,m)=>{var h=ct(),x=l(h,!0);s(h),V(()=>J(x,e(B))),o(d,h)},$$slots:{default:!0}})};z(pe,r=>{e(B)&&r(Le)})}var ue=a(pe,2),ve=l(ue),Ee=a(l(ve),2);G(Ee,{type:"primary",onclick:()=>{Z(),t(j,!0)},children:(r,d)=>{var m=mt(),h=w(m);$e(h,{class:"mr-2 h-4 w-4"}),O(),o(r,m)},$$slots:{default:!0}}),s(ve);var Ne=a(ve,2);{var Oe=r=>{var d=pt(),m=l(d);ye(m,{}),s(d),o(r,d)},je=r=>{var d=le(),m=w(d);{var h=f=>{it(f,{get icon(){return nt},title:"No custom fields",message:"Add custom fields to collect more information from subscribers, like name, company, or phone number.",children:(y,b)=>{G(y,{type:"primary",onclick:()=>{Z(),t(j,!0)},children:(C,$)=>{var E=ft(),n=w(E);$e(n,{class:"mr-2 h-4 w-4"}),O(),o(C,E)},$$slots:{default:!0}})},$$slots:{default:!0}})},x=f=>{var y=yt(),b=w(y);xe(b,{children:($,E)=>{var n=gt(),P=l(n),u=a(l(P));Qe(u,21,()=>e(ie),Ve,(N,v)=>{var I=ht(),A=l(I),F=l(A,!0);s(A);var S=a(A),ee=l(S),i=l(ee,!0);s(ee),s(S);var T=a(S),te=l(T);be(te,{variant:"default",size:"sm",children:(_,K)=>{O();var re=Y();V(()=>J(re,e(v).field_type)),o(_,re)},$$slots:{default:!0}}),s(T);var q=a(T),ce=l(q);{var Be=_=>{be(_,{variant:"warning",size:"sm",children:(K,re)=>{O();var ae=Y("Required");o(K,ae)},$$slots:{default:!0}})},Ie=_=>{var K=_t();o(_,K)};z(ce,_=>{e(v).required?_(Be):_(Ie,!1)})}s(q);var fe=a(q),_e=l(fe),he=l(_e);G(he,{type:"ghost",size:"sm",onclick:()=>Te(e(v)),children:(_,K)=>{ut(_,{class:"h-4 w-4"})},$$slots:{default:!0}});var Ke=a(he,2);{let _=se(()=>e(X)===e(v).id);G(Ke,{type:"ghost",size:"sm",onclick:()=>ze(e(v).id),get disabled(){return e(_)},children:(K,re)=>{var ae=le(),Re=w(ae);{var De=H=>{ye(H,{size:"small"})},Ue=H=>{vt(H,{class:"h-4 w-4 text-red-500"})};z(Re,H=>{e(X)===e(v).id?H(De):H(Ue,!1)})}o(K,ae)},$$slots:{default:!0}})}s(_e),s(fe),s(I),V(()=>{J(F,e(v).name),J(i,`{{${e(v).field_key}}}`)}),o(N,I)}),s(u),s(P),s(n),o($,n)},$$slots:{default:!0}});var C=a(b,2);xe(C,{children:($,E)=>{var n=xt(),P=a(w(n),4),u=l(P);u.textContent="Hi {{name}}, thanks for signing up!",s(P),o($,n)},$$slots:{default:!0}}),o(f,y)};z(m,f=>{e(ie).length===0?f(h):f(x,!1)},!0)}o(r,d)};z(Ne,r=>{e(de)?r(Oe):r(je,!1)})}s(ue);var Me=a(ue,2);{const r=m=>{var h=bt(),x=w(h);G(x,{type:"secondary",onclick:()=>{t(j,!1),Z()},get disabled(){return e(Q)},children:(y,b)=>{O();var C=Y("Cancel");o(y,C)},$$slots:{default:!0}});var f=a(x,2);{let y=se(()=>!e(k)||!e(g)||e(Q));G(f,{type:"primary",onclick:qe,get disabled(){return e(y)},children:(b,C)=>{var $=le(),E=w($);{var n=u=>{var N=Y("Saving...");o(u,N)},P=u=>{var N=le(),v=w(N);{var I=F=>{var S=Y("Save Changes");o(F,S)},A=F=>{var S=Y("Add Field");o(F,S)};z(v,F=>{e(M)?F(I):F(A,!1)},!0)}o(u,N)};z(E,u=>{e(Q)?u(n):u(P,!1)})}o(b,$)},$$slots:{default:!0}})}o(m,h)};let d=se(()=>e(M)?"Edit Custom Field":"Add Custom Field");st(Me,{get title(){return e(d)},size:"md",get show(){return e(j)},set show(m){t(j,m,!0)},footer:r,children:(m,h)=>{var x=wt(),f=l(x),y=a(l(f),2);oe(y,{id:"field-name",type:"text",oninput:Se,placeholder:"e.g., First Name",get value(){return e(k)},set value(i){t(k,i,!0)}}),O(2),s(f);var b=a(f,2),C=a(l(b),2);oe(C,{id:"field-key",type:"text",placeholder:"e.g., first_name",get value(){return e(g)},set value(i){t(g,i,!0)}});var $=a(C,2),E=l($);s($),s(b);var n=a(b,2),P=a(l(n),2);lt(P,{options:[{value:"text",label:"Text"},{value:"number",label:"Number"},{value:"date",label:"Date"},{value:"dropdown",label:"Dropdown"}],get value(){return e(L)},set value(i){t(L,i,!0)}}),s(n);var u=a(n,2);{var N=i=>{var T=$t(),te=a(l(T),2);oe(te,{id:"field-options",type:"text",placeholder:"Option 1, Option 2, Option 3",get value(){return e(U)},set value(q){t(U,q,!0)}}),O(2),s(T),o(i,T)};z(u,i=>{e(L)==="dropdown"&&i(N)})}var v=a(u,2),I=a(l(v),2);oe(I,{id:"field-placeholder",type:"text",placeholder:"Enter your first name...",get value(){return e(D)},set value(i){t(D,i,!0)}}),s(v);var A=a(v,2),F=l(A);ot(F,{label:"Required field",get checked(){return e(R)},set checked(i){t(R,i,!0)}}),O(2),s(A);var S=a(A,2);{var ee=i=>{ge(i,{type:"error",title:"Error",children:(T,te)=>{var q=Ft(),ce=l(q,!0);s(q),V(()=>J(ce,e(B))),o(T,q)},$$slots:{default:!0}})};z(S,i=>{e(B)&&i(ee)})}s(x),V(()=>J(E,`Used in emails as ${`{{${e(g)||"field_key"}}}`}`)),o(m,x)},$$slots:{footer:!0,default:!0}})}o(Fe,me),Ge(),Pe()}export{Ut as component};
