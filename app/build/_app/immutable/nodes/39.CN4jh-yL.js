import"../chunks/DsnmJJEf.js";import{p as Dt,s as u,a as Ft,u as Ct,b as t,i as e,f as C,d as Mt,j as T,m as It,t as Y,c as s,h as i,g as Pt,r,n as f}from"../chunks/odI--4Kw.js";import{d as Nt,s as B}from"../chunks/BNMK9zrr.js";import{a as o,t as q,c as ye,f as m}from"../chunks/CCInJaqd.js";import{i as M}from"../chunks/COaB7F5h.js";import{e as Qe,i as Tt}from"../chunks/BohEjZuL.js";import{h as Rt}from"../chunks/hUjpWz_l.js";import{s as zt,a as jt}from"../chunks/DL1yFSKa.js";import{p as Vt}from"../chunks/CfNhSnGx.js";import{j as At,S as Bt,T as Et,U as Lt,k as Ot,V as Ut}from"../chunks/CORuJdE6.js";import{g as Wt}from"../chunks/BrgWd9TR.js";import{M as Kt,g as Yt,I as we,B as ue,A as qt,C as ze,h as Xe,f as Ht}from"../chunks/BnWrML5A.js";import{L as je}from"../chunks/D716f0vp.js";import{S as Gt}from"../chunks/BnIRYDf9.js";import{B as Ve}from"../chunks/BD7k7D4N.js";import{S as $e}from"../chunks/BhWE_OAM.js";import{M as Jt}from"../chunks/CLZYg7MR.js";import{C as Ze}from"../chunks/CDIdgPAf.js";import{R as et}from"../chunks/DgyWz8cz.js";import{T as Qt}from"../chunks/65BW-NJO.js";var Xt=m("<p> </p>"),Zt=m('<div class="flex items-center gap-2 text-green-600"><!> <span class="text-sm font-medium">Configured</span></div>'),ea=m('<div class="flex items-center gap-2 text-text-muted"><!> <span class="text-sm">Using defaults</span></div>'),ta=m(`<div class="card-header"><h2 class="card-title">Sender Identity</h2> <p class="card-subtitle">Configure how your emails appear to recipients</p></div> <div class="border border-border rounded-lg"><div class="p-4 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="card-section-title">Email Sender</h3> <p class="card-section-subtitle"><!></p></div></div> <div class="flex items-center gap-2"><!></div></div> <div class="border-t border-border p-4 bg-bg-secondary"><div class="space-y-4 max-w-lg"><div><label for="from-name" class="form-label">From Name</label> <!> <p class="mt-1 text-xs text-text-muted">The name shown in the recipient's inbox</p></div> <div><label for="from-email" class="form-label">From Email</label> <!> <p class="mt-1 text-xs text-text-muted">Must be a verified email address with your email provider</p></div> <div><label for="reply-to" class="form-label">Reply-To Email</label> <!> <p class="mt-1 text-xs text-text-muted">Where replies will be sent (optional, defaults to From Email)</p></div> <div class="flex justify-end gap-3 pt-2"><!></div></div></div></div>`,1),aa=m("<!> <span>Verify Domain</span>",1),ra=m('<div class="border border-border rounded-lg p-6 text-center"><div class="w-12 h-12 mx-auto bg-base-200 rounded-lg flex items-center justify-center mb-4"><!></div> <h3 class="text-base font-medium mb-2">No domains configured</h3> <p class="text-sm text-base-content/60 mb-4"><!></p> <!></div>'),sa=m("<!> <span>Checking...</span>",1),ia=m("<!> <span>Refresh</span>",1),oa=m('<tr><td><!></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all"> </code></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all max-w-xs block overflow-hidden text-ellipsis"> </code></td><td><span class="text-xs text-base-content/60 capitalize"> </span></td><td><button class="btn btn-ghost btn-xs" title="Copy value"><!></button></td></tr>'),la=m('<div class="p-4"><div class="flex items-center gap-2 mb-3"><!> <span class="text-sm font-medium">Add these DNS records to your domain</span></div> <div class="overflow-x-auto"><table class="table table-sm w-full"><thead><tr><th class="text-xs font-medium text-base-content/60 uppercase">Type</th><th class="text-xs font-medium text-base-content/60 uppercase">Name/Host</th><th class="text-xs font-medium text-base-content/60 uppercase">Value</th><th class="text-xs font-medium text-base-content/60 uppercase">Purpose</th><th class="w-10"></th></tr></thead><tbody></tbody></table></div> <div class="mt-4 p-3 bg-info/10 rounded-lg"><p class="text-xs text-info"><strong>Note:</strong> DNS changes can take up to 72 hours to propagate. Click "Refresh" to check verification status.</p></div></div>'),na=m('<div class="border border-border rounded-lg overflow-hidden mb-4 last:mb-0"><div class="p-4 flex items-center justify-between bg-base-200/50"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="font-medium"> </h3> <div class="flex items-center gap-2 mt-1"><span class="text-xs text-base-content/60">Verification:</span> <!> <span class="text-xs text-base-content/60 ml-2">DKIM:</span> <!></div></div></div> <div class="flex items-center gap-2"><!> <!></div></div> <!></div>'),da=m('<div class="card-header"><h2 class="card-title">Domain Verification</h2> <p class="card-subtitle">Verify your domain to improve email deliverability and enable DKIM signing</p></div> <!>',1),ca=m(`<div class="flex items-start gap-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div><h3 class="card-title">How it works</h3> <p class="card-subtitle">These settings are used as defaults for all emails sent from this brand, including campaigns, sequences, and transactional emails.
						You can override these settings on a per-campaign or per-sequence basis.</p></div></div>`),va=m('<div class="space-y-6"><!> <!> <!></div>'),ma=m("<!> <span>Setting up...</span>",1),ua=m("<!> <span>Verify Domain</span>",1),fa=m(`<div class="space-y-4"><div class="p-4 bg-info/10 rounded-lg"><h4 class="font-medium text-sm mb-2">What is MAIL FROM?</h4> <p class="text-xs text-base-content/70">The MAIL FROM domain (also called "envelope sender" or "Return-Path") is used for SPF authentication and bounce handling.
				Setting a custom MAIL FROM domain ensures your emails pass SPF checks with your own domain instead of amazonses.com.</p></div> <div><label for="mail-from-subdomain" class="form-label">MAIL FROM Subdomain</label> <div class="flex items-center gap-2"><!> <span class="text-sm text-base-content/60"> </span></div> <p class="mt-1 text-xs text-text-muted">Default is "mail". Use "bounce", "email", or "ses" if "mail" is already in use on your domain.</p></div> <div class="p-3 bg-warning/10 rounded-lg"><p class="text-xs text-warning"><strong>Note:</strong> Make sure the subdomain you choose isn't already used for other services (like your mail server).
				You'll need to add DNS records for this subdomain.</p></div> <div class="flex justify-end gap-3 pt-2"><!> <!></div></div>`),pa=m("<!> <!> <!> <!>",1);function Va(tt,at){Dt(at,!0);const rt=()=>jt(Vt,"$page",st),[st,it]=zt();let Ae=T(()=>rt().params.brandSlug),fe=u(!0),ke=u(!1),pe=u(!1),l=u(null),y=u(""),k=u(Ft([])),se=u(null),_e=u(!1),Se=u(null),X=u(null),ge=u(!1),O=u(null),ie=u(!1),he=u("mail"),oe=u(""),U=u(""),le=u(""),De=null;Ct(()=>(Fe(),()=>{De&&De()}));function ot(a){const d=Wt();d.isConnected()||d.connect(),d.send("subscribe",{org_id:a});const S=d.on("domain_identity_update",_=>{console.log("[WebSocket] Domain identity update received:",_),t(k,e(k).map(F=>F.id===_.id?{...F,verification_status:_.verification_status,dkim_status:_.dkim_status,mail_from_status:_.mail_from_status,last_checked_at:_.last_checked_at}:F),!0)}),D=d.on("domain_identity_created",_=>{console.log("[WebSocket] Domain identity created:",_),Fe()});De=()=>{S(),D()}}async function Fe(){t(fe,!0),t(y,"");try{if(!e(Ae)){t(y,"No brand selected"),t(fe,!1);return}t(l,await At({},e(Ae)),!0),ot(e(l).id),t(oe,e(l).from_name||"",!0),t(U,e(l).from_email||"",!0),t(le,e(l).reply_to||"",!0);try{const a=await Bt({},e(l).id);t(k,a.identities||[],!0)}catch(a){console.error("Failed to load domain identities:",a),t(k,[],!0)}}catch(a){console.error("Failed to load data:",a),t(y,a.message||"Failed to load data",!0)}finally{t(fe,!1)}}function lt(){t(he,"mail"),t(ie,!0)}async function nt(){if(e(l)){t(_e,!0),t(y,"");try{const a=await Et({},{domain:"",mail_from_subdomain:e(he)||"mail"},e(l).id);t(k,[...e(k),a],!0),t(ie,!1)}catch(a){console.error("Failed to create domain identity:",a),t(y,a.message||"Failed to create domain identity",!0)}finally{t(_e,!1)}}}async function dt(a){if(e(l)){t(se,a,!0),t(y,"");try{const d=await Ut({},e(l).id,a);t(k,e(k).map(S=>S.id===a?d:S),!0)}catch(d){console.error("Failed to refresh domain identity:",d),t(y,d.message||"Failed to refresh domain identity",!0)}finally{t(se,null)}}}function ct(a){t(O,a,!0),t(ge,!0)}async function vt(){if(!(!e(l)||!e(O))){t(X,e(O).id,!0),t(y,"");try{await Lt({},e(l).id,e(O).id),t(k,e(k).filter(a=>a.id!==e(O).id),!0),t(O,null),t(ge,!1)}catch(a){console.error("Failed to delete domain identity:",a),t(y,a.message||"Failed to delete domain identity",!0)}finally{t(X,null)}}}function mt(a,d){navigator.clipboard.writeText(a),t(Se,d,!0),setTimeout(()=>{t(Se,null)},2e3)}function Be(a){switch(a){case"Success":case"success":return{variant:"success",label:"Verified"};case"Pending":case"pending":return{variant:"warning",label:"Pending"};case"Failed":case"failed":case"temporary_failure":return{variant:"error",label:"Failed"};case"not_started":case"NotStarted":return{variant:"default",label:"Not Started"};default:return{variant:"default",label:a||"Unknown"}}}async function ut(){if(e(l)){t(ke,!0),t(pe,!1),t(y,"");try{await Ot({},{from_name:e(oe)||void 0,from_email:e(U)||void 0,reply_to:e(le)||void 0},e(l).id),t(pe,!0),setTimeout(()=>{t(pe,!1)},2e3),await Fe()}catch(a){console.error("Failed to save email settings:",a),t(y,a.message||"Failed to save email settings",!0)}finally{t(ke,!1)}}}let ft=T(()=>e(l)&&(e(oe)!==(e(l).from_name||"")||e(U)!==(e(l).from_email||"")||e(le)!==(e(l).reply_to||""))),Ee=T(()=>e(l)?.from_name||e(l)?.from_email);var Le=pa();Rt("1fr6do4",a=>{It(()=>{Pt.title=`Email Settings - ${(e(l)?.name||"Loading")??""}`})});var Oe=C(Le);{var pt=a=>{qt(a,{type:"error",title:"Error",children:(d,S)=>{var D=Xt(),_=s(D,!0);r(D),Y(()=>B(_,e(y))),o(d,D)},$$slots:{default:!0}})};M(Oe,a=>{e(y)&&a(pt)})}var Ue=i(Oe,2);{var _t=a=>{je(a,{size:"large"})},gt=a=>{var d=va(),S=s(d);ze(S,{children:(F,ne)=>{var E=ta(),H=i(C(E),2),W=s(H),G=s(W),v=s(G),R=s(v);Jt(R,{class:"h-6 w-6 text-blue-600"}),r(v);var w=i(v,2),z=i(s(w),2),c=s(z);{var K=n=>{var x=q();Y(()=>B(x,`${(e(l)?.from_name||"No name")??""} <${(e(l)?.from_email||"No email")??""}>`)),o(n,x)},$=n=>{var x=q("Not configured - using platform defaults");o(n,x)};M(c,n=>{e(Ee)?n(K):n($,!1)})}r(z),r(w),r(G);var b=i(G,2),I=s(b);{var J=n=>{var x=Zt(),g=s(x);Xe(g,{class:"h-5 w-5"}),f(2),r(x),o(n,x)},p=n=>{var x=ea(),g=s(x);Ze(g,{class:"h-5 w-5"}),f(2),r(x),o(n,x)};M(I,n=>{e(Ee)?n(J):n(p,!1)})}r(b),r(W);var j=i(W,2),Z=s(j),V=s(Z),de=i(s(V),2);we(de,{id:"from-name",type:"text",placeholder:"Acme Inc",get value(){return e(oe)},set value(n){t(oe,n,!0)}}),f(2),r(V);var ee=i(V,2),be=i(s(ee),2);we(be,{id:"from-email",type:"email",placeholder:"hello@yourdomain.com",get value(){return e(U)},set value(n){t(U,n,!0)}}),f(2),r(ee);var ce=i(ee,2),xe=i(s(ce),2);we(xe,{id:"reply-to",type:"email",placeholder:"support@yourdomain.com",get value(){return e(le)},set value(n){t(le,n,!0)}}),f(2),r(ce);var ve=i(ce,2),Ce=s(ve);{let n=T(()=>!e(ft));Gt(Ce,{label:"Save Settings",get saving(){return e(ke)},get saved(){return e(pe)},onclick:ut,get disabled(){return e(n)}})}r(ve),r(Z),r(j),r(H),o(F,E)},$$slots:{default:!0}});var D=i(S,2);ze(D,{children:(F,ne)=>{var E=da(),H=i(C(E),2);{var W=v=>{var R=ra(),w=s(R),z=s(w);$e(z,{class:"h-6 w-6 text-base-content/50"}),r(w);var c=i(w,4),K=s(c);{var $=p=>{var j=q("Set your From Email above first, then verify your domain.");o(p,j)},b=p=>{var j=q("Verify your domain to authenticate emails and improve deliverability.");o(p,j)};M(K,p=>{e(U)?p(b,!1):p($)})}r(c);var I=i(c,2);{var J=p=>{ue(p,{variant:"primary",onclick:lt,children:(j,Z)=>{var V=aa(),de=C(V);$e(de,{class:"h-4 w-4"}),f(2),o(j,V)},$$slots:{default:!0}})};M(I,p=>{e(U)&&p(J)})}r(R),o(v,R)},G=v=>{var R=ye(),w=C(R);Qe(w,17,()=>e(k),z=>z.id,(z,c)=>{const K=T(()=>Be(e(c).verification_status)),$=T(()=>Be(e(c).dkim_status));var b=na(),I=s(b),J=s(I),p=s(J),j=s(p);$e(j,{class:"h-5 w-5 text-primary"}),r(p);var Z=i(p,2),V=s(Z),de=s(V,!0);r(V);var ee=i(V,2),be=i(s(ee),2);Ve(be,{get variant(){return e(K).variant},size:"sm",children:(g,L)=>{f();var P=q();Y(()=>B(P,e(K).label)),o(g,P)},$$slots:{default:!0}});var ce=i(be,4);Ve(ce,{get variant(){return e($).variant},size:"sm",children:(g,L)=>{f();var P=q();Y(()=>B(P,e($).label)),o(g,P)},$$slots:{default:!0}}),r(ee),r(Z),r(J);var xe=i(J,2),ve=s(xe);{let g=T(()=>e(se)!==null||e(X)!==null);ue(ve,{variant:"ghost",size:"sm",onclick:()=>dt(e(c).id),get disabled(){return e(g)},children:(L,P)=>{var Q=ye(),te=C(Q);{var ae=h=>{var N=sa(),me=C(N);et(me,{class:"h-4 w-4 animate-spin"}),f(2),o(h,N)},re=h=>{var N=ia(),me=C(N);et(me,{class:"h-4 w-4"}),f(2),o(h,N)};M(te,h=>{e(se)===e(c).id?h(ae):h(re,!1)})}o(L,Q)},$$slots:{default:!0}})}var Ce=i(ve,2);{let g=T(()=>e(se)!==null||e(X)!==null);ue(Ce,{variant:"ghost",size:"sm",onclick:()=>ct(e(c)),get disabled(){return e(g)},children:(L,P)=>{var Q=ye(),te=C(Q);{var ae=h=>{je(h,{size:"normal"})},re=h=>{Qt(h,{class:"h-4 w-4 text-error"})};M(te,h=>{e(X)===e(c).id?h(ae):h(re,!1)})}o(L,Q)},$$slots:{default:!0}})}r(xe),r(I);var n=i(I,2);{var x=g=>{var L=la(),P=s(L),Q=s(P);Ze(Q,{class:"h-4 w-4 text-warning"}),f(2),r(P);var te=i(P,2),ae=s(te),re=i(s(ae));Qe(re,21,()=>e(c).dns_records,Tt,(h,N,me)=>{const Ke=T(()=>`${e(c).id}-${me}`);var Me=oa(),Ie=s(Me),bt=s(Ie);Ve(bt,{variant:"default",size:"sm",children:(A,_a)=>{f();var Je=q();Y(()=>B(Je,e(N).type)),o(A,Je)},$$slots:{default:!0}}),r(Ie);var Pe=i(Ie),Ye=s(Pe),xt=s(Ye,!0);r(Ye),r(Pe);var Ne=i(Pe),qe=s(Ne),yt=s(qe,!0);r(qe),r(Ne);var Te=i(Ne),He=s(Te),wt=s(He,!0);r(He),r(Te);var Ge=i(Te),Re=s(Ge);Re.__click=()=>mt(e(N).value,e(Ke));var $t=s(Re);{var kt=A=>{Xe(A,{class:"h-3 w-3 text-success"})},St=A=>{Ht(A,{class:"h-3 w-3"})};M($t,A=>{e(Se)===e(Ke)?A(kt):A(St,!1)})}r(Re),r(Ge),r(Me),Y(A=>{B(xt,e(N).name),B(yt,e(N).value),B(wt,A)},[()=>e(N).purpose.replace(/_/g," ")]),o(h,Me)}),r(re),r(ae),r(te),f(2),r(L),o(g,L)};M(n,g=>{e(c).dns_records&&e(c).dns_records.length>0&&g(x)})}r(b),Y(()=>B(de,e(c).domain)),o(z,b)}),o(v,R)};M(H,v=>{e(k).length===0?v(W):v(G,!1)})}o(F,E)},$$slots:{default:!0}});var _=i(D,2);ze(_,{children:(F,ne)=>{var E=ca();o(F,E)},$$slots:{default:!0}}),r(d),o(a,d)};M(Ue,a=>{e(fe)?a(_t):a(gt,!1)})}var We=i(Ue,2);Kt(We,{get open(){return e(ie)},onclose:()=>{t(ie,!1)},title:"Domain Verification Setup",children:(a,d)=>{var S=fa(),D=i(s(S),2),_=i(s(D),2),F=s(_);we(F,{id:"mail-from-subdomain",type:"text",placeholder:"mail",class:"w-32",get value(){return e(he)},set value(v){t(he,v,!0)}});var ne=i(F,2),E=s(ne);r(ne),r(_),f(2),r(D);var H=i(D,4),W=s(H);ue(W,{variant:"ghost",onclick:()=>{t(ie,!1)},children:(v,R)=>{f();var w=q("Cancel");o(v,w)},$$slots:{default:!0}});var G=i(W,2);ue(G,{variant:"primary",onclick:nt,get disabled(){return e(_e)},children:(v,R)=>{var w=ye(),z=C(w);{var c=$=>{var b=ma(),I=C(b);je(I,{size:"normal"}),f(2),o($,b)},K=$=>{var b=ua(),I=C(b);$e(I,{class:"h-4 w-4"}),f(2),o($,b)};M(z,$=>{e(_e)?$(c):$(K,!1)})}o(v,w)},$$slots:{default:!0}}),r(H),r(S),Y(v=>B(E,`.${v??""}`),[()=>e(U)?.split("@")[1]||"yourdomain.com"]),o(a,S)},$$slots:{default:!0}});var ht=i(We,2);{let a=T(()=>e(O)?.domain),d=T(()=>e(X)!==null);Yt(ht,{get open(){return e(ge)},onclose:()=>{t(ge,!1),t(O,null)},title:"Delete Domain Identity",get description(){return`Are you sure you want to delete the domain identity for ${e(a)??""}? You will need to set up DNS records again if you want to verify this domain later.`},confirmLabel:"Delete",confirmVariant:"error",onconfirm:vt,get loading(){return e(d)}})}o(tt,Le),Mt(),it()}Nt(["click"]);export{Va as component};
