import"../chunks/Bzak7iHL.js";import{f as h,p as mt,d as c,j as _t,u as xt,b as t,a as gt,h as ht,s as r,g as e,e as me,$ as yt,c as l,r as s,t as X,n as A}from"../chunks/Ip2DykXx.js";import{s as K}from"../chunks/DhOIAuLg.js";import{c as ge,a as o,f as v,t as re}from"../chunks/BPgbRZ5o.js";import{l as Ge,s as Je,i as S}from"../chunks/BeCi3WIf.js";import{e as bt,i as $t}from"../chunks/-0-Kn73z.js";import{h as kt}from"../chunks/vHZS38u2.js";import{r as Ne}from"../chunks/CmyOW3uE.js";import{d as St,A as wt,C as _e,B as xe,f as je,g as He,I as Z}from"../chunks/Bphptf_a.js";import{G as Bt,H as Pt,I as Dt,J as Ct,K as zt}from"../chunks/CtwFYI68.js";import{L as Ft}from"../chunks/sFH_xjRy.js";import{S as At}from"../chunks/CwztAqJg.js";import{B as se}from"../chunks/CK6k7lQK.js";import{P as Tt}from"../chunks/C0D2ZjIj.js";import{R as Mt}from"../chunks/CQK8yWuM.js";import{T as Rt}from"../chunks/Boqopfmd.js";import"../chunks/hUurZXsg.js";import{s as Ue}from"../chunks/Df8mRDld.js";import{I as Ze}from"../chunks/CYeJYM_Q.js";import{D as Et}from"../chunks/BZpcwiXl.js";function It(Y,L){const N=Ge(L,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.522.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const j=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"}]];Ze(Y,Je({name:"cloud"},()=>N,{get iconNode(){return j},children:(w,B)=>{var T=ge(),H=h(T);Ue(H,L,"default",{}),o(w,T)},$$slots:{default:!0}}))}function Kt(Y,L){const N=Ge(L,["children","$$slots","$$events","$$legacy"]);/**
 * @license lucide-svelte v0.522.0 - ISC
 *
 * ISC License
 *
 * Copyright (c) for portions of Lucide are held by Cole Bemis 2013-2022 as part of Feather (MIT). All other copyright (c) for Lucide are held by Lucide Contributors 2022.
 *
 * Permission to use, copy, modify, and/or distribute this software for any
 * purpose with or without fee is hereby granted, provided that the above
 * copyright notice and this permission notice appear in all copies.
 *
 * THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES
 * WITH REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF
 * MERCHANTABILITY AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR
 * ANY SPECIAL, DIRECT, INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES
 * WHATSOEVER RESULTING FROM LOSS OF USE, DATA OR PROFITS, WHETHER IN AN
 * ACTION OF CONTRACT, NEGLIGENCE OR OTHER TORTIOUS ACTION, ARISING OUT OF
 * OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.
 *
 */const j=[["line",{x1:"22",x2:"2",y1:"12",y2:"12"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16"}]];Ze(Y,Je({name:"hard-drive"},()=>N,{get iconNode(){return j},children:(w,B)=>{var T=ge(),H=h(T);Ue(H,L,"default",{}),o(w,T)},$$slots:{default:!0}}))}var Lt=v("<p> </p>"),Nt=v('<div class="mb-6"><!></div>'),jt=v('<label class="flex items-center gap-2"><input type="checkbox" class="rounded"/> <span class="text-sm text-text">Upload to S3</span></label>'),Ht=v("<!> ",1),Gt=v('<div class="flex items-center justify-between mb-4"><h2 class="text-lg font-medium text-text">Create Backup</h2></div> <div class="space-y-4"><div class="flex items-center gap-4"><label class="flex items-center gap-2"><input type="checkbox" class="rounded"/> <span class="text-sm text-text">Compress backup (gzip)</span></label> <!></div> <!></div>',1),Jt=v('<p class="text-sm text-text-muted text-center py-8">No backups yet. Create your first backup above.</p>'),Ut=v('<!> <span class="ml-1">S3</span>',1),Zt=v('<!> <span class="ml-1">Local</span>',1),qt=v('<tr class="border-b border-border hover:bg-bg-secondary"><td class="py-2 px-3 text-sm font-mono"> </td><td class="py-2 px-3 text-sm"> </td><td class="py-2 px-3 text-sm"><!></td><td class="py-2 px-3 text-sm"><!></td><td class="py-2 px-3 text-sm"><!></td><td class="py-2 px-3 text-sm text-text-muted"> </td><td class="py-2 px-3 text-right"><div class="flex items-center justify-end gap-1"><!> <!></div></td></tr>'),Ot=v('<div class="overflow-x-auto"><table class="w-full"><thead><tr class="border-b border-border"><th class="text-left py-2 px-3 text-sm font-medium text-text-muted">Filename</th><th class="text-left py-2 px-3 text-sm font-medium text-text-muted">Size</th><th class="text-left py-2 px-3 text-sm font-medium text-text-muted">Type</th><th class="text-left py-2 px-3 text-sm font-medium text-text-muted">Storage</th><th class="text-left py-2 px-3 text-sm font-medium text-text-muted">Status</th><th class="text-left py-2 px-3 text-sm font-medium text-text-muted">Created</th><th class="text-right py-2 px-3 text-sm font-medium text-text-muted">Actions</th></tr></thead><tbody></tbody></table></div>'),Qt=v('<div class="flex items-center justify-between mb-4"><h2 class="text-lg font-medium text-text">Backup History</h2> <!></div> <!>',1),Vt=v('<div class="grid grid-cols-2 gap-4"><div><label for="s3-bucket" class="form-label">S3 Bucket</label> <!></div> <div><label for="s3-region" class="form-label">S3 Region</label> <!></div></div> <div><label for="s3-prefix" class="form-label">S3 Key Prefix (optional)</label> <!></div> <div class="grid grid-cols-2 gap-4"><div><label for="s3-access-key" class="form-label">Access Key ID</label> <!></div> <div><label for="s3-secret-key" class="form-label">Secret Access Key</label> <!></div></div>',1),Wt=v('<h2 class="text-lg font-medium text-text mb-4">S3 Storage Settings</h2> <div class="space-y-4"><!> <!></div>',1),Xt=v('<p class="text-sm text-text-muted"> </p>'),Yt=v('<div class="grid grid-cols-2 gap-4"><div><label for="schedule-cron" class="form-label">Schedule (Cron)</label> <!> <p class="mt-1 text-xs text-text-muted">Default: 3 AM daily (0 3 * * *)</p></div> <div><label for="retention-days" class="form-label">Retention (days)</label> <!> <p class="mt-1 text-xs text-text-muted">Backups older than this will be deleted</p></div></div> <!>',1),ea=v('<h2 class="text-lg font-medium text-text mb-4">Scheduled Backups</h2> <div class="space-y-4"><!> <!></div>',1),ta=v('<div class="space-y-6"><!> <!> <!> <!> <div class="flex justify-end"><!></div></div>'),aa=v("<!> <!> <!>",1);function ka(Y,L){mt(L,!0);let N=c(!0),j=c(_t([])),w=c(null),B=c(""),T=c(!1),H=c(!0),he=c(!1),ye=c(!1),le=c(!1),q=c(!1),oe=c(""),de=c(""),be=c(""),$e=c(""),ie=c(""),ee=c(!1),ne=c("0 3 * * *"),ce=c(30),te=c(!1),O=c(null),ke=c(!1);xt(()=>{ue()});async function ue(){t(N,!0),t(B,"");try{const[a,i]=await Promise.all([Bt({page:1,page_size:50}),Pt()]);t(j,a.backups||[],!0),t(w,i,!0),t(q,i.s3_enabled,!0),t(oe,i.s3_bucket||"",!0),t(de,i.s3_region||"",!0),t(ie,i.s3_prefix||"",!0),t(ee,i.schedule_enabled,!0),t(ne,i.schedule_cron||"0 3 * * *",!0),t(ce,i.retention_days||30,!0)}catch(a){console.error("Failed to load backup data:",a),t(B,a.message||"Failed to load backup data",!0)}finally{t(N,!1)}}async function qe(){t(T,!0),t(B,"");try{await Ct({compress:e(H),upload_to_s3:e(he)&&e(q)}),await ue()}catch(a){console.error("Failed to create backup:",a),t(B,a.message||"Failed to create backup",!0)}finally{t(T,!1)}}async function Oe(){t(ye,!0),t(le,!1),t(B,"");try{const a=await zt({s3_enabled:e(q),s3_bucket:e(oe),s3_region:e(de),s3_access_key:e(be),s3_secret_key:e($e),s3_prefix:e(ie),schedule_enabled:e(ee),schedule_cron:e(ne),retention_days:e(ce)});t(w,a,!0),t(le,!0),setTimeout(()=>{t(le,!1)},2e3)}catch(a){console.error("Failed to save settings:",a),t(B,a.message||"Failed to save settings",!0)}finally{t(ye,!1)}}function Qe(a){t(O,a,!0),t(te,!0)}async function Ve(){if(e(O)){t(ke,!0);try{await Dt({},e(O).id),t(te,!1),t(O,null),await ue()}catch(a){console.error("Failed to delete backup:",a),t(B,a.message||"Failed to delete backup",!0)}finally{t(ke,!1)}}}function We(a){window.open(`/api/admin/backup/${a.id}/download`,"_blank")}function Xe(a){if(a===0)return"0 B";const i=1024,P=["B","KB","MB","GB"],G=Math.floor(Math.log(a)/Math.log(i));return parseFloat((a/Math.pow(i,G)).toFixed(2))+" "+P[G]}function Ae(a){return a?new Date(a).toLocaleString():"-"}var Te=aa();kt("iipz64",a=>{ht(()=>{yt.title="Backup - Settings"})});var Me=h(Te);{var Ye=a=>{var i=Nt(),P=l(i);wt(P,{type:"error",title:"Error",children:(G,Se)=>{var Q=Lt(),ve=l(Q,!0);s(Q),X(()=>K(ve,e(B))),o(G,Q)},$$slots:{default:!0}}),s(i),o(a,i)};S(Me,a=>{e(B)&&a(Ye)})}var Re=r(Me,2);{var et=a=>{Ft(a,{size:"large"})},tt=a=>{var i=ta(),P=l(i);_e(P,{children:(J,we)=>{var D=Gt(),$=r(h(D),2),C=l($),R=l(C),E=l(R);Ne(E),A(2),s(R);var _=r(R,2);{var p=u=>{var x=jt(),y=l(x);Ne(y),A(2),s(x),je(y,()=>e(he),n=>t(he,n)),o(u,x)};S(_,u=>{var x;(x=e(w))!=null&&x.s3_enabled&&u(p)})}s(C);var f=r(C,2);xe(f,{type:"primary",onclick:qe,get disabled(){return e(T)},children:(u,x)=>{var y=Ht(),n=h(y);Tt(n,{class:"mr-2 h-4 w-4"});var z=r(n);X(()=>K(z,` ${e(T)?"Creating Backup...":"Create Backup Now"}`)),o(u,y)},$$slots:{default:!0}}),s($),je(E,()=>e(H),u=>t(H,u)),o(J,D)},$$slots:{default:!0}});var G=r(P,2);_e(G,{children:(J,we)=>{var D=Qt(),$=h(D),C=r(l($),2);xe(C,{type:"ghost",onclick:ue,children:(p,f)=>{Mt(p,{class:"h-4 w-4"})},$$slots:{default:!0}}),s($);var R=r($,2);{var E=p=>{var f=Jt();o(p,f)},_=p=>{var f=Ot(),u=l(f),x=r(l(u));bt(x,21,()=>e(j),$t,(y,n)=>{var z=qt(),U=l(z),k=l(U,!0);s(U);var g=r(U),ae=l(g,!0);s(g);var I=r(g),Be=l(I);se(Be,{type:"secondary",children:(d,m)=>{A();var M=re();X(()=>K(M,e(n).backup_type)),o(d,M)},$$slots:{default:!0}}),s(I);var b=r(I),F=l(b);{var st=d=>{var m=Ut(),M=h(m);It(M,{class:"h-4 w-4 inline text-primary"}),A(2),o(d,m)},lt=d=>{var m=Zt(),M=h(m);Kt(M,{class:"h-4 w-4 inline text-text-muted"}),A(2),o(d,m)};S(F,d=>{e(n).storage_type==="s3"?d(st):d(lt,!1)})}s(b);var Pe=r(b),ot=l(Pe);{var dt=d=>{se(d,{type:"success",children:(m,M)=>{A();var Ce=re("Completed");o(m,Ce)},$$slots:{default:!0}})},it=d=>{var m=ge(),M=h(m);{var Ce=V=>{se(V,{type:"warning",children:(pe,Le)=>{A();var ze=re("In Progress");o(pe,ze)},$$slots:{default:!0}})},vt=V=>{var pe=ge(),Le=h(pe);{var ze=W=>{se(W,{type:"error",children:(Fe,ft)=>{A();var fe=re("Failed");o(Fe,fe)},$$slots:{default:!0}})},pt=W=>{se(W,{type:"secondary",children:(Fe,ft)=>{A();var fe=re();X(()=>K(fe,e(n).status)),o(Fe,fe)},$$slots:{default:!0}})};S(Le,W=>{e(n).status==="failed"?W(ze):W(pt,!1)},!0)}o(V,pe)};S(M,V=>{e(n).status==="in_progress"?V(Ce):V(vt,!1)},!0)}o(d,m)};S(ot,d=>{e(n).status==="completed"?d(dt):d(it,!1)})}s(Pe);var De=r(Pe),nt=l(De,!0);s(De);var Ee=r(De),Ie=l(Ee),Ke=l(Ie);{var ct=d=>{xe(d,{type:"ghost",size:"icon",onclick:()=>We(e(n)),children:(m,M)=>{Et(m,{class:"h-4 w-4"})},$$slots:{default:!0}})};S(Ke,d=>{e(n).status==="completed"&&d(ct)})}var ut=r(Ke,2);xe(ut,{type:"ghost",size:"icon",onclick:()=>Qe(e(n)),children:(d,m)=>{Rt(d,{class:"h-4 w-4 text-red-500"})},$$slots:{default:!0}}),s(Ie),s(Ee),s(z),X((d,m)=>{K(k,e(n).filename),K(ae,d),K(nt,m)},[()=>Xe(e(n).file_size),()=>Ae(e(n).started_at)]),o(y,z)}),s(x),s(u),s(f),o(p,f)};S(R,p=>{e(j).length===0?p(E):p(_,!1)})}o(J,D)},$$slots:{default:!0}});var Se=r(G,2);_e(Se,{children:(J,we)=>{var D=Wt(),$=r(h(D),2),C=l($);He(C,{label:"Enable S3 backup storage",get checked(){return e(q)},set checked(_){t(q,_,!0)}});var R=r(C,2);{var E=_=>{var p=Vt(),f=h(p),u=l(f),x=r(l(u),2);Z(x,{id:"s3-bucket",type:"text",placeholder:"my-backup-bucket",get value(){return e(oe)},set value(b){t(oe,b,!0)}}),s(u);var y=r(u,2),n=r(l(y),2);Z(n,{id:"s3-region",type:"text",placeholder:"us-east-1",get value(){return e(de)},set value(b){t(de,b,!0)}}),s(y),s(f);var z=r(f,2),U=r(l(z),2);Z(U,{id:"s3-prefix",type:"text",placeholder:"backups/outlet/",get value(){return e(ie)},set value(b){t(ie,b,!0)}}),s(z);var k=r(z,2),g=l(k),ae=r(l(g),2);{let b=me(()=>{var F;return(F=e(w))!=null&&F.has_s3_creds?"••••••••":"Enter access key"});Z(ae,{id:"s3-access-key",type:"password",get placeholder(){return e(b)},get value(){return e(be)},set value(F){t(be,F,!0)}})}s(g);var I=r(g,2),Be=r(l(I),2);{let b=me(()=>{var F;return(F=e(w))!=null&&F.has_s3_creds?"••••••••":"Enter secret key"});Z(Be,{id:"s3-secret-key",type:"password",get placeholder(){return e(b)},get value(){return e($e)},set value(F){t($e,F,!0)}})}s(I),s(k),o(_,p)};S(R,_=>{e(q)&&_(E)})}s($),o(J,D)},$$slots:{default:!0}});var Q=r(Se,2);_e(Q,{children:(J,we)=>{var D=ea(),$=r(h(D),2),C=l($);He(C,{label:"Enable scheduled backups",get checked(){return e(ee)},set checked(_){t(ee,_,!0)}});var R=r(C,2);{var E=_=>{var p=Yt(),f=h(p),u=l(f),x=r(l(u),2);Z(x,{id:"schedule-cron",type:"text",placeholder:"0 3 * * *",get value(){return e(ne)},set value(k){t(ne,k,!0)}}),A(2),s(u);var y=r(u,2),n=r(l(y),2);Z(n,{id:"retention-days",type:"number",min:"1",max:"365",get value(){return e(ce)},set value(k){t(ce,k,!0)}}),A(2),s(y),s(f);var z=r(f,2);{var U=k=>{var g=Xt(),ae=l(g);s(g),X(I=>K(ae,`Last backup: ${I??""}`),[()=>Ae(e(w).last_backup_at)]),o(k,g)};S(z,k=>{var g;(g=e(w))!=null&&g.last_backup_at&&k(U)})}o(_,p)};S(R,_=>{e(ee)&&_(E)})}s($),o(J,D)},$$slots:{default:!0}});var ve=r(Q,2),rt=l(ve);At(rt,{label:"Save Settings",get saving(){return e(ye)},get saved(){return e(le)},onclick:Oe}),s(ve),s(i),o(a,i)};S(Re,a=>{e(N)?a(et):a(tt,!1)})}var at=r(Re,2);{let a=me(()=>{var P;return`Are you sure you want to delete "${(P=e(O))==null?void 0:P.filename}"? This action cannot be undone.`}),i=me(()=>e(ke)?"Deleting...":"Delete");St(at,{title:"Delete Backup",get description(){return e(a)},get actionLabel(){return e(i)},actionType:"danger",onAction:Ve,onCancel:()=>{t(te,!1),t(O,null)},get open(){return e(te)},set open(P){t(te,P,!0)}})}o(Y,Te),gt()}export{ka as component};
