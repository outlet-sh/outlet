import"../chunks/DsnmJJEf.js";import{f as S,p as He,c as o,r,t as R,i as e,j as ae,d as Je,s as F,a as Re,u as ft,b as i,h as l,n as k,m as pt}from"../chunks/EWi02PFm.js";import{s as x}from"../chunks/CMlTvFs1.js";import{c as re,a as s,f as u,t as A}from"../chunks/m1NGduc7.js";import{l as _t,s as mt,p as me,i as z}from"../chunks/Bv3BEGQz.js";import{a as ht,c as bt,e as he,i as be,s as gt}from"../chunks/BU0M2qTC.js";import{ao as $t,ap as yt,aq as xt,ar as kt,as as wt,at as Ct}from"../chunks/DtWifhjl.js";import{a as Pt,s as zt,B as M,M as Te,I as Ne,c as Ie,A as De,g as St,e as Wt,X as Et,C as qe,p as Xe}from"../chunks/_5RYljtH.js";import{L as Ye}from"../chunks/UGmSaeWH.js";import{s as Lt}from"../chunks/CYBLM2wj.js";import{B as ge}from"../chunks/Bj7i9l3f.js";import{P as Ve}from"../chunks/xQC1cKWF.js";import{R as Ft}from"../chunks/Ckz2ALzz.js";import{T as Rt}from"../chunks/CvWreysG.js";import"../chunks/BBXvuiDC.js";import{T as Tt}from"../chunks/B-YSeal5.js";function Dt(ce,T){const H=_t(T,["children","$$slots","$$events","$$legacy"]);const D=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"}],["path",{d:"m2 2 20 20"}]];Pt(ce,mt({name:"eye-off"},()=>H,{get iconNode(){return D},children:(J,N)=>{var I=re(),Y=S(I);zt(Y,T,"default",{}),s(J,I)},$$slots:{default:!0}}))}var At=u('<div class="overflow-x-auto rounded-lg bg-base-200"><table><!></table></div>');function Ge(ce,T){He(T,!0);let H=me(T,"zebra",3,!1),D=me(T,"pinRows",3,!1),J=me(T,"pinCols",3,!1),N=me(T,"size",3,"md"),I=me(T,"class",3,"");const Y={xs:"table-xs",sm:"table-sm",md:"",lg:"table-lg"};let h=ae(()=>`table ${Y[N()]} ${H()?"table-zebra":""} ${D()?"table-pin-rows":""} ${J()?"table-pin-cols":""} ${I()}`.trim());var K=At(),ve=o(K),se=o(ve);Lt(se,()=>T.children),r(ve),r(K),R(()=>ht(ve,1,bt(e(h)))),s(ce,K),Je()}var Ot=u("<!> Add Webhook",1),Mt=u('<div class="flex justify-center py-12"><!></div>'),Ut=u("<!> Add Your First Webhook",1),jt=u('<p class="text-text-muted">No webhooks configured yet.</p> <!>',1),Bt=u('<tr><td class="font-mono text-sm max-w-xs truncate"> </td><td><div class="flex flex-wrap gap-1"><!> <!></div></td><td><!></td><td><div class="text-sm"><span class="text-green-600"> </span> <span class="text-text-muted">/</span> <span class="text-red-600"> </span></div></td><td class="text-sm text-text-muted"> </td><td><div class="flex items-center justify-end gap-2"><!> <!> <!> <!></div></td></tr>'),Nt=u('<thead><tr><th>URL</th><th>Events</th><th>Status</th><th>Deliveries</th><th>Last Delivery</th><th class="text-right">Actions</th></tr></thead> <tbody></tbody>',1),It=u('<p class="mt-1 text-sm"> </p>'),qt=u("<strong> </strong> <!> <!>",1),Xt=u('<div class="flex justify-end gap-3"><!> <!></div>'),Yt=u('<div><h4 class="text-sm font-medium text-text-muted mb-2"> </h4> <div class="space-y-2 pl-2"></div></div>'),Vt=u('<div class="space-y-4"><div><label class="form-label" for="webhook-url">Endpoint URL</label> <!></div> <div><label class="form-label">Events to Subscribe</label> <div class="mt-2 space-y-4 max-h-64 overflow-y-auto"></div></div> <div><!></div></div>'),Gt=u('<div class="space-y-4"><!> <div><label class="form-label">Signing Secret</label> <div class="flex gap-2"><!> <!></div> <p class="mt-2 text-sm text-text-muted">Use this secret to verify that webhook payloads are from Outlet. Check the <code>X-Webhook-Signature</code> header.</p></div></div>'),Ht=u('<div class="flex justify-center py-8"><!></div>'),Jt=u('<p class="text-center text-text-muted py-8">No delivery logs yet.</p>'),Kt=u('<span class="flex items-center gap-1 text-green-600"><!> </span>'),Qt=u('<span class="flex items-center gap-1 text-red-600"><!> Error</span>'),Zt=u('<span class="text-red-600"> </span>'),ea=u('<tr><td><!></td><td><!></td><td class="text-sm text-text-muted"> </td><td class="text-sm text-text-muted"> </td></tr>'),ta=u("<thead><tr><th>Event</th><th>Status</th><th>Duration</th><th>Time</th></tr></thead> <tbody></tbody>",1),aa=u('<div class="max-h-96 overflow-y-auto"><!></div>'),ra=u('<div class="space-y-6"><div class="flex items-center justify-between"><div><h2 class="text-lg font-medium text-text">Webhooks</h2> <p class="mt-1 text-sm text-text-muted">Receive real-time notifications when events happen in your account.</p></div> <!></div> <!> <!> <!></div> <!> <!> <!>',1);function $a(ce,T){He(T,!0);let H=F(!0),D=F(""),J=F(Re([])),N=F(!1),I=F(!1),Y=F(!1),h=F(Re({url:"",events:[],active:!0})),K=F(""),ve=F(""),se=F(Re([])),we=F(!1),$e=F(null),O=F(null);const Ke=[{value:"checkout.completed",label:"Checkout Completed",category:"Orders"},{value:"order.created",label:"Order Created",category:"Orders"},{value:"order.completed",label:"Order Completed",category:"Orders"},{value:"payment.succeeded",label:"Payment Succeeded",category:"Payments"},{value:"payment.failed",label:"Payment Failed",category:"Payments"},{value:"refund.created",label:"Refund Created",category:"Payments"},{value:"subscription.created",label:"Subscription Created",category:"Subscriptions"},{value:"subscription.updated",label:"Subscription Updated",category:"Subscriptions"},{value:"subscription.canceled",label:"Subscription Canceled",category:"Subscriptions"},{value:"subscription.renewed",label:"Subscription Renewed",category:"Subscriptions"},{value:"customer.created",label:"Customer Created",category:"Customers"},{value:"customer.updated",label:"Customer Updated",category:"Customers"},{value:"contact.created",label:"Contact Created",category:"Contacts"},{value:"contact.unsubscribed",label:"Contact Unsubscribed",category:"Contacts"},{value:"email.sent",label:"Email Sent",category:"Email"},{value:"email.bounced",label:"Email Bounced",category:"Email"},{value:"email.opened",label:"Email Opened",category:"Email"},{value:"email.clicked",label:"Email Clicked",category:"Email"}];let Qe=ae(()=>()=>{const t={};for(const a of Ke)t[a.category]||(t[a.category]=[]),t[a.category].push(a);return t});ft(()=>{ye()});async function ye(){i(H,!0),i(D,"");try{const t=await $t();i(J,t.webhooks||[],!0)}catch(t){console.error("Failed to load webhooks:",t),i(D,t.message||"Failed to load webhooks",!0)}finally{i(H,!1)}}async function Ze(){if(!e(h).url||e(h).events.length===0){i(D,"URL and at least one event are required");return}try{const t=await yt({url:e(h).url,events:e(h).events,active:e(h).active});i(K,t.secret,!0),i(N,!1),i(Y,!0),i(h,{url:"",events:[],active:!0},!0),await ye()}catch(t){console.error("Failed to create webhook:",t),i(D,t.message||"Failed to create webhook",!0)}}async function et(t){try{await wt({},{active:!t.active},t.id),await ye()}catch(a){console.error("Failed to update webhook:",a),i(D,a.message||"Failed to update webhook",!0)}}async function tt(t){if(confirm("Are you sure you want to delete this webhook?"))try{await Ct({},t),await ye()}catch(a){console.error("Failed to delete webhook:",a),i(D,a.message||"Failed to delete webhook",!0)}}async function at(t){i($e,t,!0),i(O,null);try{i(O,await kt({},t),!0)}catch(a){console.error("Failed to test webhook:",a),i(O,{success:!1,status_code:0,error:a.message||"Test failed"},!0)}finally{i($e,null)}}async function rt(t){i(ve,t,!0),i(we,!0),i(I,!0),i(se,[],!0);try{const a=await xt({limit:50},t);i(se,a.logs||[],!0)}catch(a){console.error("Failed to load webhook logs:",a)}finally{i(we,!1)}}function st(t){e(h).events.indexOf(t)===-1?e(h).events=[...e(h).events,t]:e(h).events=e(h).events.filter(c=>c!==t)}function ot(){navigator.clipboard.writeText(e(K))}function Ae(t){return t?new Date(t).toLocaleString():"Never"}var Oe=ra(),Ce=S(Oe),Pe=o(Ce),lt=l(o(Pe),2);M(lt,{onclick:()=>i(N,!0),children:(t,a)=>{var c=Ot(),n=S(c);Ve(n,{size:16,class:"mr-2"}),k(),s(t,c)},$$slots:{default:!0}}),r(Pe);var Me=l(Pe,2);{var it=t=>{De(t,{variant:"error",children:(a,c)=>{k();var n=A();R(()=>x(n,e(D))),s(a,n)},$$slots:{default:!0}})};z(Me,t=>{e(D)&&t(it)})}var Ue=l(Me,2);{var dt=t=>{var a=Mt(),c=o(a);Ye(c,{size:"lg"}),r(a),s(t,a)},nt=t=>{var a=re(),c=S(a);{var n=f=>{qe(f,{class:"py-12 text-center",children:($,p)=>{var b=jt(),w=l(S(b),2);M(w,{class:"mt-4",onclick:()=>i(N,!0),children:(y,g)=>{var _=Ut(),d=S(_);Ve(d,{size:16,class:"mr-2"}),k(),s(y,_)},$$slots:{default:!0}}),s($,b)},$$slots:{default:!0}})},m=f=>{qe(f,{children:($,p)=>{Ge($,{children:(b,w)=>{var y=Nt(),g=l(S(y),2);he(g,21,()=>e(J),be,(_,d)=>{var Q=Bt(),U=o(Q),oe=o(U,!0);r(U);var V=l(U),G=o(V),le=o(G);he(le,17,()=>e(d).events.slice(0,2),be,(v,W)=>{ge(v,{variant:"secondary",class:"text-xs",children:(de,E)=>{k();var ne=A();R(()=>x(ne,e(W))),s(de,ne)},$$slots:{default:!0}})});var C=l(le,2);{var Z=v=>{ge(v,{variant:"secondary",class:"text-xs",children:(W,de)=>{k();var E=A();R(()=>x(E,`+${e(d).events.length-2} more`)),s(W,E)},$$slots:{default:!0}})};z(C,v=>{e(d).events.length>2&&v(Z)})}r(G),r(V);var ee=l(V),ze=o(ee);{var ue=v=>{ge(v,{variant:"success",children:(W,de)=>{k();var E=A("Active");s(W,E)},$$slots:{default:!0}})},Se=v=>{ge(v,{variant:"secondary",children:(W,de)=>{k();var E=A("Inactive");s(W,E)},$$slots:{default:!0}})};z(ze,v=>{e(d).active?v(ue):v(Se,!1)})}r(ee);var fe=l(ee),xe=o(fe),te=o(xe),We=o(te,!0);r(te);var pe=l(te,4),Ee=o(pe,!0);r(pe),r(xe),r(fe);var P=l(fe),q=o(P,!0);r(P);var j=l(P),ie=o(j),ke=o(ie);M(ke,{variant:"ghost",size:"sm",onclick:()=>rt(e(d).id),title:"View Logs",children:(v,W)=>{Xe(v,{size:16})},$$slots:{default:!0}});var X=l(ke,2);{let v=ae(()=>e($e)===e(d).id);M(X,{variant:"ghost",size:"sm",onclick:()=>at(e(d).id),get disabled(){return e(v)},title:"Test Webhook",children:(W,de)=>{var E=re(),ne=S(E);{var Le=L=>{Ft(L,{size:16,class:"animate-spin"})},Fe=L=>{Rt(L,{size:16})};z(ne,L=>{e($e)===e(d).id?L(Le):L(Fe,!1)})}s(W,E)},$$slots:{default:!0}})}var B=l(X,2);{let v=ae(()=>e(d).active?"Disable":"Enable");M(B,{variant:"ghost",size:"sm",onclick:()=>et(e(d)),get title(){return e(v)},children:(W,de)=>{var E=re(),ne=S(E);{var Le=L=>{Dt(L,{size:16})},Fe=L=>{Xe(L,{size:16})};z(ne,L=>{e(d).active?L(Le):L(Fe,!1)})}s(W,E)},$$slots:{default:!0}})}var _e=l(B,2);M(_e,{variant:"ghost",size:"sm",class:"text-red-600 hover:text-red-700",onclick:()=>tt(e(d).id),title:"Delete",children:(v,W)=>{Tt(v,{size:16})},$$slots:{default:!0}}),r(ie),r(j),r(Q),R(v=>{gt(U,"title",e(d).url),x(oe,e(d).url),x(We,e(d).deliveries_success||0),x(Ee,e(d).deliveries_failed||0),x(q,v)},[()=>Ae(e(d).last_delivery_at)]),s(_,Q)}),r(g),s(b,y)},$$slots:{default:!0}})},$$slots:{default:!0}})};z(c,f=>{e(J).length===0?f(n):f(m,!1)},!0)}s(t,a)};z(Ue,t=>{e(H)?t(dt):t(nt,!1)})}var ct=l(Ue,2);{var vt=t=>{{let a=ae(()=>e(O).success?"success":"error");De(t,{get variant(){return e(a)},dismissable:!0,onclose:()=>i(O,null),children:(c,n)=>{var m=qt(),f=S(m),$=o(f);r(f);var p=l(f,2);{var b=g=>{var _=A();R(()=>x(_,`- Status: ${e(O).status_code??""}`)),s(g,_)};z(p,g=>{e(O).status_code&&g(b)})}var w=l(p,2);{var y=g=>{var _=It(),d=o(_,!0);r(_),R(()=>x(d,e(O).error)),s(g,_)};z(w,g=>{e(O).error&&g(y)})}R(()=>x($,`Test ${e(O).success?"Successful":"Failed"}`)),s(c,m)},$$slots:{default:!0}})}};z(ct,t=>{e(O)&&t(vt)})}r(Ce);var je=l(Ce,2);Te(je,{title:"Add Webhook",get open(){return e(N)},set open(a){i(N,a,!0)},footer:a=>{var c=Xt(),n=o(c);M(n,{variant:"secondary",onclick:()=>i(N,!1),children:(f,$)=>{k();var p=A("Cancel");s(f,p)},$$slots:{default:!0}});var m=l(n,2);M(m,{onclick:Ze,children:(f,$)=>{k();var p=A("Create Webhook");s(f,p)},$$slots:{default:!0}}),r(c),s(a,c)},children:(a,c)=>{var n=Vt(),m=o(n),f=l(o(m),2);Ne(f,{id:"webhook-url",type:"url",placeholder:"https://your-server.com/webhook",get value(){return e(h).url},set value(y){e(h).url=y}}),r(m);var $=l(m,2),p=l(o($),2);he(p,21,()=>Object.entries(e(Qe)()),be,(y,g)=>{var _=ae(()=>pt(e(g),2));let d=()=>e(_)[0],Q=()=>e(_)[1];var U=Yt(),oe=o(U),V=o(oe,!0);r(oe);var G=l(oe,2);he(G,21,Q,be,(le,C)=>{{let Z=ae(()=>e(h).events.includes(e(C).value));Ie(le,{get label(){return e(C).label},get checked(){return e(Z)},onchange:()=>st(e(C).value)})}}),r(G),r(U),R(()=>x(V,d())),s(y,U)}),r(p),r($);var b=l($,2),w=o(b);Ie(w,{label:"Active",get checked(){return e(h).active},set checked(y){e(h).active=y}}),r(b),r(n),s(a,n)},$$slots:{footer:!0,default:!0}});var Be=l(je,2);Te(Be,{title:"Webhook Created",get open(){return e(Y)},set open(a){i(Y,a,!0)},footer:a=>{M(a,{onclick:()=>i(Y,!1),children:(c,n)=>{k();var m=A("Done");s(c,m)},$$slots:{default:!0}})},children:(a,c)=>{var n=Gt(),m=o(n);De(m,{variant:"warning",children:(w,y)=>{k();var g=A("Save this secret now. You won't be able to see it again.");s(w,g)},$$slots:{default:!0}});var f=l(m,2),$=l(o(f),2),p=o($);Ne(p,{get value(){return e(K)},readonly:!0,class:"font-mono text-sm"});var b=l(p,2);M(b,{variant:"secondary",onclick:ot,children:(w,y)=>{St(w,{size:16})},$$slots:{default:!0}}),r($),k(2),r(f),r(n),s(a,n)},$$slots:{footer:!0,default:!0}});var ut=l(Be,2);Te(ut,{title:"Webhook Delivery Logs",size:"lg",get open(){return e(I)},set open(a){i(I,a,!0)},footer:a=>{M(a,{variant:"secondary",onclick:()=>i(I,!1),children:(c,n)=>{k();var m=A("Close");s(c,m)},$$slots:{default:!0}})},children:(a,c)=>{var n=re(),m=S(n);{var f=p=>{var b=Ht(),w=o(b);Ye(w,{}),r(b),s(p,b)},$=p=>{var b=re(),w=S(b);{var y=_=>{var d=Jt();s(_,d)},g=_=>{var d=aa(),Q=o(d);Ge(Q,{children:(U,oe)=>{var V=ta(),G=l(S(V),2);he(G,21,()=>e(se),be,(le,C)=>{var Z=ea(),ee=o(Z),ze=o(ee);ge(ze,{variant:"secondary",children:(P,q)=>{k();var j=A();R(()=>x(j,e(C).event)),s(P,j)},$$slots:{default:!0}}),r(ee);var ue=l(ee),Se=o(ue);{var fe=P=>{var q=Kt(),j=o(q);Wt(j,{size:14});var ie=l(j);r(q),R(()=>x(ie,` ${e(C).status_code??""}`)),s(P,q)},xe=P=>{var q=re(),j=S(q);{var ie=X=>{var B=Qt(),_e=o(B);Et(_e,{size:14}),k(),r(B),s(X,B)},ke=X=>{var B=Zt(),_e=o(B,!0);r(B),R(()=>x(_e,e(C).status_code)),s(X,B)};z(j,X=>{e(C).error?X(ie):X(ke,!1)},!0)}s(P,q)};z(Se,P=>{e(C).status_code>=200&&e(C).status_code<300?P(fe):P(xe,!1)})}r(ue);var te=l(ue),We=o(te);r(te);var pe=l(te),Ee=o(pe,!0);r(pe),r(Z),R(P=>{x(We,`${(e(C).duration||0)??""}ms`),x(Ee,P)},[()=>Ae(e(C).delivered_at)]),s(le,Z)}),r(G),s(U,V)},$$slots:{default:!0}}),r(d),s(_,d)};z(w,_=>{e(se).length===0?_(y):_(g,!1)},!0)}s(p,b)};z(m,p=>{e(we)?p(f):p($,!1)})}s(a,n)},$$slots:{footer:!0,default:!0}}),s(ce,Oe),Je()}export{$a as component};
