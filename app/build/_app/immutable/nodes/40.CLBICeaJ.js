import"../chunks/DsnmJJEf.js";import{p as dt,s as h,a as ct,u as vt,b as s,i as e,f as j,d as mt,m as ut,g as ft,h as o,c as a,r as t,t as A,n as _,j as O}from"../chunks/odI--4Kw.js";import{d as pt,s as D}from"../chunks/BNMK9zrr.js";import{a as l,f as u,t as W,c as Be}from"../chunks/CCInJaqd.js";import{i as C}from"../chunks/COaB7F5h.js";import{e as Re,i as _t}from"../chunks/BohEjZuL.js";import{h as gt}from"../chunks/hUjpWz_l.js";import{b as ht}from"../chunks/Bt-Xh7oU.js";import{Q as bt,R as xt,k as yt,S as wt,T as $t}from"../chunks/DsZuZzfy.js";import{g as kt}from"../chunks/B2niTBGE.js";import{A as St,C as he,I as be,i as Me,B as Ve,f as Ct}from"../chunks/D_7vKuD1.js";import{L as Ae}from"../chunks/D716f0vp.js";import{S as It}from"../chunks/lTIIkWs3.js";import{B as xe}from"../chunks/BD7k7D4N.js";import{M as Dt}from"../chunks/CQcKoRKH.js";import{C as Oe}from"../chunks/BG0OWad_.js";import{S as ye}from"../chunks/DVtLLjfo.js";import{R as Ft}from"../chunks/CQ1n2zyf.js";var Pt=u("<p> </p>"),Nt=u('<div class="flex items-center gap-2 text-green-600"><!> <span class="text-sm font-medium">Configured</span></div>'),zt=u('<div class="flex items-center gap-2 text-text-muted"><!> <span class="text-sm">Using defaults</span></div>'),Et=u(`<div class="card-header"><h2 class="card-title">Sender Identity</h2> <p class="card-subtitle">Configure how your emails appear to recipients</p></div> <div class="border border-border rounded-lg"><div class="p-4 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="card-section-title">Email Sender</h3> <p class="card-section-subtitle"><!></p></div></div> <div class="flex items-center gap-2"><!></div></div> <div class="border-t border-border p-4 bg-bg-secondary"><div class="space-y-4 max-w-lg"><div><label for="from-name" class="form-label">From Name</label> <!> <p class="mt-1 text-xs text-text-muted">The name shown in the recipient's inbox</p></div> <div><label for="from-email" class="form-label">From Email</label> <!> <p class="mt-1 text-xs text-text-muted">Must be a verified email address with your email provider</p></div> <div><label for="reply-to" class="form-label">Reply-To Email</label> <!> <p class="mt-1 text-xs text-text-muted">Where replies will be sent (optional, defaults to From Email)</p></div> <div class="flex justify-end gap-3 pt-2"><!></div></div></div></div>`,1),Tt=u("<!> <span>Setting up...</span>",1),jt=u("<!> <span>Verify Domain</span>",1),Bt=u('<div class="border border-border rounded-lg p-6 text-center"><div class="w-12 h-12 mx-auto bg-base-200 rounded-lg flex items-center justify-center mb-4"><!></div> <h3 class="text-base font-medium mb-2">No domains configured</h3> <p class="text-sm text-base-content/60 mb-4"><!></p> <!></div>'),Rt=u("<!> <span>Refresh</span>",1),Mt=u('<tr><td><!></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all"> </code></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all max-w-xs block overflow-hidden text-ellipsis"> </code></td><td><span class="text-xs text-base-content/60 capitalize"> </span></td><td><button class="btn btn-ghost btn-xs" title="Copy value"><!></button></td></tr>'),Vt=u('<div class="p-4"><div class="flex items-center gap-2 mb-3"><!> <span class="text-sm font-medium">Add these DNS records to your domain</span></div> <div class="overflow-x-auto"><table class="table table-sm w-full"><thead><tr><th class="text-xs font-medium text-base-content/60 uppercase">Type</th><th class="text-xs font-medium text-base-content/60 uppercase">Name/Host</th><th class="text-xs font-medium text-base-content/60 uppercase">Value</th><th class="text-xs font-medium text-base-content/60 uppercase">Purpose</th><th class="w-10"></th></tr></thead><tbody></tbody></table></div> <div class="mt-4 p-3 bg-info/10 rounded-lg"><p class="text-xs text-info"><strong>Note:</strong> DNS changes can take up to 72 hours to propagate. Click "Refresh" to check verification status.</p></div></div>'),At=u('<div class="border border-border rounded-lg overflow-hidden mb-4 last:mb-0"><div class="p-4 flex items-center justify-between bg-base-200/50"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="font-medium"> </h3> <div class="flex items-center gap-2 mt-1"><span class="text-xs text-base-content/60">Verification:</span> <!> <span class="text-xs text-base-content/60 ml-2">DKIM:</span> <!></div></div></div> <!></div> <!></div>'),Ot=u('<div class="card-header"><h2 class="card-title">Domain Verification</h2> <p class="card-subtitle">Verify your domain to improve email deliverability and enable DKIM signing</p></div> <!>',1),Wt=u(`<div class="flex items-start gap-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div><h3 class="card-title">How it works</h3> <p class="card-subtitle">These settings are used as defaults for all emails sent from this brand, including campaigns, sequences, and transactional emails.
						You can override these settings on a per-campaign or per-sequence basis.</p></div></div>`),Kt=u('<div class="space-y-6"><!> <!> <!></div>'),Lt=u("<!> <!>",1);function ca(We,Ke){dt(Ke,!0);let ee=h(!0),oe=h(!1),te=h(!1),d=h(null),b=h(""),x=h(ct([])),ae=h(!1),re=h(!1),le=h(null),H=h(""),B=h(""),Q=h(""),ne=null;vt(()=>(we(),Le(),()=>{ne&&ne()}));function Le(){const r=localStorage.getItem("currentOrgId");if(!r)return;const n=kt();n.isConnected()||n.connect(),n.send("subscribe",{org_id:r}),ne=n.on("domain_identity_update",p=>{console.log("[WebSocket] Domain identity update received:",p),s(x,e(x).map(y=>y.id===p.id?{...y,verification_status:p.verification_status,dkim_status:p.dkim_status,mail_from_status:p.mail_from_status,last_checked_at:p.last_checked_at}:y),!0)})}async function we(){s(ee,!0),s(b,"");try{const r=ht?localStorage.getItem("currentOrgId"):null;if(!r){s(b,"No organization selected"),s(ee,!1);return}s(d,await bt({},r),!0),s(H,e(d).from_name||"",!0),s(B,e(d).from_email||"",!0),s(Q,e(d).reply_to||"",!0);try{const n=await xt({},r);s(x,n.identities||[],!0)}catch(n){console.error("Failed to load domain identities:",n),s(x,[],!0)}}catch(r){console.error("Failed to load data:",r),s(b,r.message||"Failed to load data",!0)}finally{s(ee,!1)}}async function Ue(){if(e(d)){s(re,!0),s(b,"");try{const r=await $t({},{domain:""},e(d).id);s(x,[...e(x),r],!0)}catch(r){console.error("Failed to create domain identity:",r),s(b,r.message||"Failed to create domain identity",!0)}finally{s(re,!1)}}}async function qe(r){if(e(d)){s(ae,!0),s(b,"");try{const n=await wt({},e(d).id,r);s(x,e(x).map(p=>p.id===r?n:p),!0)}catch(n){console.error("Failed to refresh domain identity:",n),s(b,n.message||"Failed to refresh domain identity",!0)}finally{s(ae,!1)}}}function He(r,n){navigator.clipboard.writeText(r),s(le,n,!0),setTimeout(()=>{s(le,null)},2e3)}function $e(r){switch(r){case"Success":case"success":return{variant:"success",label:"Verified"};case"Pending":case"pending":return{variant:"warning",label:"Pending"};case"Failed":case"failed":case"temporary_failure":return{variant:"error",label:"Failed"};default:return{variant:"default",label:r||"Unknown"}}}async function Qe(){if(e(d)){s(oe,!0),s(te,!1),s(b,"");try{await yt({},{from_name:e(H)||void 0,from_email:e(B)||void 0,reply_to:e(Q)||void 0},e(d).id),s(te,!0),setTimeout(()=>{s(te,!1)},2e3),await we()}catch(r){console.error("Failed to save email settings:",r),s(b,r.message||"Failed to save email settings",!0)}finally{s(oe,!1)}}}let Ye=O(()=>e(d)&&(e(H)!==(e(d).from_name||"")||e(B)!==(e(d).from_email||"")||e(Q)!==(e(d).reply_to||""))),ke=O(()=>e(d)?.from_name||e(d)?.from_email);var Se=Lt();gt("1fr6do4",r=>{ut(()=>{ft.title=`Email Settings - ${(e(d)?.name||"Loading")??""}`})});var Ce=j(Se);{var Ge=r=>{St(r,{type:"error",title:"Error",children:(n,p)=>{var y=Pt(),de=a(y,!0);t(y),A(()=>D(de,e(b))),l(n,y)},$$slots:{default:!0}})};C(Ce,r=>{e(b)&&r(Ge)})}var Je=o(Ce,2);{var Xe=r=>{Ae(r,{size:"large"})},Ze=r=>{var n=Kt(),p=a(n);he(p,{children:(Y,Ie)=>{var R=Et(),se=o(j(R),2),G=a(se),J=a(G),w=a(J),F=a(w);Dt(F,{class:"h-6 w-6 text-blue-600"}),t(w);var P=o(w,2),N=o(a(P),2),f=a(N);{var K=i=>{var c=W();A(()=>D(c,`${(e(d)?.from_name||"No name")??""} <${(e(d)?.from_email||"No email")??""}>`)),l(i,c)},L=i=>{var c=W("Not configured - using platform defaults");l(i,c)};C(f,i=>{e(ke)?i(K):i(L,!1)})}t(N),t(P),t(J);var z=o(J,2),M=a(z);{var V=i=>{var c=Nt(),m=a(c);Me(m,{class:"h-5 w-5"}),_(2),t(c),l(i,c)},v=i=>{var c=zt(),m=a(c);Oe(m,{class:"h-5 w-5"}),_(2),t(c),l(i,c)};C(M,i=>{e(ke)?i(V):i(v,!1)})}t(z),t(G);var $=o(G,2),U=a($),k=a(U),X=o(a(k),2);be(X,{id:"from-name",type:"text",placeholder:"Acme Inc",get value(){return e(H)},set value(i){s(H,i,!0)}}),_(2),t(k);var E=o(k,2),q=o(a(E),2);be(q,{id:"from-email",type:"email",placeholder:"hello@yourdomain.com",get value(){return e(B)},set value(i){s(B,i,!0)}}),_(2),t(E);var g=o(E,2),I=o(a(g),2);be(I,{id:"reply-to",type:"email",placeholder:"support@yourdomain.com",get value(){return e(Q)},set value(i){s(Q,i,!0)}}),_(2),t(g);var T=o(g,2),ce=a(T);{let i=O(()=>!e(Ye));It(ce,{label:"Save Settings",get saving(){return e(oe)},get saved(){return e(te)},onclick:Qe,get disabled(){return e(i)}})}t(T),t(U),t($),t(se),l(Y,R)},$$slots:{default:!0}});var y=o(p,2);he(y,{children:(Y,Ie)=>{var R=Ot(),se=o(j(R),2);{var G=w=>{var F=Bt(),P=a(F),N=a(P);ye(N,{class:"h-6 w-6 text-base-content/50"}),t(P);var f=o(P,4),K=a(f);{var L=v=>{var $=W("Set your From Email above first, then verify your domain.");l(v,$)},z=v=>{var $=W("Verify your domain to authenticate emails and improve deliverability.");l(v,$)};C(K,v=>{e(B)?v(z,!1):v(L)})}t(f);var M=o(f,2);{var V=v=>{Ve(v,{variant:"primary",onclick:Ue,get disabled(){return e(re)},children:($,U)=>{var k=Be(),X=j(k);{var E=g=>{var I=Tt(),T=j(I);Ae(T,{size:"normal"}),_(2),l(g,I)},q=g=>{var I=jt(),T=j(I);ye(T,{class:"h-4 w-4"}),_(2),l(g,I)};C(X,g=>{e(re)?g(E):g(q,!1)})}l($,k)},$$slots:{default:!0}})};C(M,v=>{e(B)&&v(V)})}t(F),l(w,F)},J=w=>{var F=Be(),P=j(F);Re(P,17,()=>e(x),N=>N.id,(N,f)=>{const K=O(()=>$e(e(f).verification_status)),L=O(()=>$e(e(f).dkim_status));var z=At(),M=a(z),V=a(M),v=a(V),$=a(v);ye($,{class:"h-5 w-5 text-primary"}),t(v);var U=o(v,2),k=a(U),X=a(k,!0);t(k);var E=o(k,2),q=o(a(E),2);xe(q,{get variant(){return e(K).variant},size:"sm",children:(i,c)=>{_();var m=W();A(()=>D(m,e(K).label)),l(i,m)},$$slots:{default:!0}});var g=o(q,4);xe(g,{get variant(){return e(L).variant},size:"sm",children:(i,c)=>{_();var m=W();A(()=>D(m,e(L).label)),l(i,m)},$$slots:{default:!0}}),t(E),t(U),t(V);var I=o(V,2);Ve(I,{variant:"ghost",size:"sm",onclick:()=>qe(e(f).id),get disabled(){return e(ae)},children:(i,c)=>{var m=Rt(),ve=j(m);{let ie=O(()=>e(ae)?"animate-spin":"");Ft(ve,{get class(){return`h-4 w-4 ${e(ie)??""}`}})}_(2),l(i,m)},$$slots:{default:!0}}),t(M);var T=o(M,2);{var ce=i=>{var c=Vt(),m=a(c),ve=a(m);Oe(ve,{class:"h-4 w-4 text-warning"}),_(2),t(m);var ie=o(m,2),De=a(ie),Fe=o(a(De));Re(Fe,21,()=>e(f).dns_records,_t,(et,Z,tt)=>{const Pe=O(()=>`${e(f).id}-${tt}`);var me=Mt(),ue=a(me),at=a(ue);xe(at,{variant:"default",size:"sm",children:(S,Ut)=>{_();var je=W();A(()=>D(je,e(Z).type)),l(S,je)},$$slots:{default:!0}}),t(ue);var fe=o(ue),Ne=a(fe),rt=a(Ne,!0);t(Ne),t(fe);var pe=o(fe),ze=a(pe),st=a(ze,!0);t(ze),t(pe);var _e=o(pe),Ee=a(_e),it=a(Ee,!0);t(Ee),t(_e);var Te=o(_e),ge=a(Te);ge.__click=()=>He(e(Z).value,e(Pe));var ot=a(ge);{var lt=S=>{Me(S,{class:"h-3 w-3 text-success"})},nt=S=>{Ct(S,{class:"h-3 w-3"})};C(ot,S=>{e(le)===e(Pe)?S(lt):S(nt,!1)})}t(ge),t(Te),t(me),A(S=>{D(rt,e(Z).name),D(st,e(Z).value),D(it,S)},[()=>e(Z).purpose.replace(/_/g," ")]),l(et,me)}),t(Fe),t(De),t(ie),_(2),t(c),l(i,c)};C(T,i=>{e(f).dns_records&&e(f).dns_records.length>0&&i(ce)})}t(z),A(()=>D(X,e(f).domain)),l(N,z)}),l(w,F)};C(se,w=>{e(x).length===0?w(G):w(J,!1)})}l(Y,R)},$$slots:{default:!0}});var de=o(y,2);he(de,{children:(Y,Ie)=>{var R=Wt();l(Y,R)},$$slots:{default:!0}}),t(n),l(r,n)};C(Je,r=>{e(ee)?r(Xe):r(Ze,!1)})}l(We,Se),mt()}pt(["click"]);export{ca as component};
