import"../chunks/DsnmJJEf.js";import{p as ft,u as _t,i as e,b as t,f as y,d as bt,j as S,s as v,m as gt,h as o,g as xt,c as l,r as s,n as f,t as J}from"../chunks/odI--4Kw.js";import{d as ht,s as K}from"../chunks/BNMK9zrr.js";import{a as n,f as p,c as ze,t as $}from"../chunks/CCInJaqd.js";import{i as D}from"../chunks/COaB7F5h.js";import{g as yt,B as V,p as $t,A as Le,X as wt,q as Tt,I as Pt,S as kt,l as Ct,P as St,E as Dt,j as At}from"../chunks/BnWrML5A.js";import{h as Et}from"../chunks/hUjpWz_l.js";import{r as jt}from"../chunks/BohEjZuL.js";import{s as zt,a as Lt}from"../chunks/DL1yFSKa.js";import{p as It}from"../chunks/CfNhSnGx.js";import{g as Q}from"../chunks/DWh3c8Cl.js";import{a1 as Vt,a0 as Bt,a2 as Ft}from"../chunks/CORuJdE6.js";import{L as Ht}from"../chunks/D716f0vp.js";import{B as ue}from"../chunks/BD7k7D4N.js";import{S as Mt,T as Nt}from"../chunks/BK0beTfW.js";import{A as qt}from"../chunks/BCZXMA-Y.js";import{T as Ot}from"../chunks/65BW-NJO.js";var Gt=p('<div class="flex justify-center py-12"><!></div>'),Rt=p("<p>The requested template could not be found.</p> <!>",1),Ut=p('<div class="p-6"><!></div>'),Wt=p("<!> Cancel",1),Xt=p("<!> Preview",1),Zt=p("<!> <!>",1),Jt=p("<p> </p>"),Kt=p('<div class="px-6 pt-4"><!></div>'),Qt=p("<!> Delete Template",1),Yt=p(`<div class="fixed inset-0 z-50 bg-base-200"><div class="h-full flex flex-col"><div class="bg-base-100 border-b border-base-300 px-6 py-4 flex items-center justify-between flex-shrink-0"><div class="flex items-center gap-4"><button type="button" class="p-2 rounded-lg hover:bg-base-200 transition-colors text-base-content/60 hover:text-base-content"><!></button> <div><div class="flex items-center gap-2"><input type="text" placeholder="Template Name" class="text-lg font-semibold text-base-content bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-base-content/40 w-64"/> <!> <!></div> <p class="text-xs text-base-content/50">Email Template</p></div></div> <div class="flex items-center gap-3"><!> <!> <!></div></div> <!> <div class="flex-1 overflow-hidden flex"><div class="w-80 bg-base-100 border-r border-base-300 p-6 overflow-y-auto flex-shrink-0"><div class="space-y-6"><div><label class="form-label">Slug</label> <p class="text-sm text-base-content/70 bg-base-200 px-3 py-2 rounded-md font-mono"> </p> <p class="mt-1 text-xs text-base-content/50 italic">Cannot be changed after creation</p></div> <div><label for="template-description" class="form-label">Description</label> <!></div> <div><label for="template-category" class="form-label">Category</label> <!></div> <div class="flex items-center justify-between py-2"><span class="text-sm font-medium text-base-content">Active</span> <!></div> <!> <div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-error mb-3">Danger Zone</h4> <p class="text-xs text-base-content/60 mb-3">Permanently delete this template. This action cannot be undone.</p> <!></div></div></div> <div class="flex-1 flex flex-col overflow-hidden p-6 gap-4"><div class="flex-1 min-h-0"><!></div> <div class="flex-shrink-0"><div class="flex items-center justify-between mb-1"><label for="plain-text" class="form-label mb-0">Plain Text Version</label> <button type="button" class="text-xs text-primary hover:text-primary/80">Regenerate from HTML</button></div> <!> <p class="mt-1 text-xs text-base-content/50 italic">Plain text version for email clients that don't support HTML.</p></div></div></div></div></div>`),ea=p('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4"><div class="bg-base-100 rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] flex flex-col"><div class="flex items-center justify-between p-4 border-b border-base-300"><h3 class="text-lg font-medium text-base-content"> </h3> <!></div> <div class="flex-1 overflow-auto p-4 bg-white"><!></div></div></div>'),ta=p("<!> <!> <!>",1);function xa(Ie,Ve){ft(Ve,!0);const me=()=>Lt(It,"$page",Be),[Be,Fe]=zt();let A=S(()=>me().params.id),G=S(()=>`/${me().params.brandSlug}`),Y=v(!0),i=v(null),b=v(""),w=v(""),pe=v(""),B=v(""),T=v("general"),P=v(""),E=v(""),j=v(!0),R=v(!1),U=v(!1),ee=v(!1),W=v(!1),te=v(!1),fe=v(null);const He=[{name:"content",label:"Main content area"},{name:"email",label:"Subscriber email"},{name:"name",label:"Subscriber name"},{name:"name,fallback=Friend",label:"Name with fallback"},{name:"unsubscribe_url",label:"Unsubscribe link"},{name:"web_version_url",label:"Web version link"}],_e=[{value:"general",label:"General"},{value:"newsletter",label:"Newsletter"},{value:"promotional",label:"Promotional"},{value:"transactional",label:"Transactional"}];let Me=S(()=>e(i)!==null&&(e(w)!==e(i).name||e(B)!==(e(i).description||"")||e(T)!==e(i).category||e(P)!==e(i).html_body||e(E)!==(e(i).plain_text||"")||e(j)!==e(i).is_active));_t(()=>{Ne()});async function Ne(){if(e(A)){t(Y,!0),t(b,"");try{t(i,await Vt({},e(A)),!0),t(w,e(i).name,!0),t(pe,e(i).slug,!0),t(B,e(i).description||"",!0),t(T,e(i).category,!0),t(P,e(i).html_body,!0),t(E,e(i).plain_text||"",!0),t(j,e(i).is_active,!0)}catch(r){console.error("Failed to load template:",r),t(b,"Failed to load template")}finally{t(Y,!1)}}}async function qe(){if(!(!e(i)||!e(A)||!e(w).trim())){t(R,!0),t(U,!1),t(b,"");try{const r=await Ft({},{name:e(w).trim(),description:e(B).trim()||void 0,category:e(T),html_body:e(P),plain_text:e(E)||void 0,is_active:e(j)},e(A));t(i,r,!0),t(U,!0),setTimeout(()=>{t(U,!1)},2e3)}catch(r){console.error("Failed to save template:",r),t(b,r.message||"Failed to save template",!0)}finally{t(R,!1)}}}async function Oe(){await qe(),e(b)||Q(`${e(G)}/templates`)}async function Ge(){if(e(A)){t(te,!0);try{await Bt({},e(A)),Q(`${e(G)}/templates`)}catch(r){t(b,r.message||"Failed to delete template",!0)}finally{t(te,!1)}}}function be(){Q(`${e(G)}/templates`)}function Re(){const r=document.createElement("div");r.innerHTML=e(P),t(E,r.textContent||r.innerText||"",!0)}function Ue(r){switch(r){case"newsletter":return"info";case"promotional":return"warning";case"transactional":return"success";default:return"default"}}function We(r){return _e.find(_=>_.value===r)?.label||r}var ge=ta();Et("k8ernf",r=>{gt(()=>{xt.title=`${(e(i)?.name||"Template")??""} | Outlet`})});var xe=y(ge);{var Xe=r=>{var m=Gt(),_=l(m);Ht(_,{size:"lg"}),s(m),n(r,m)},Ze=r=>{var m=ze(),_=y(m);{var F=x=>{var g=Ut(),k=l(g);Le(k,{type:"error",title:"Template not found",children:(C,z)=>{var h=Rt(),M=o(y(h),2);V(M,{type:"primary",class:"mt-3",onclick:()=>Q(`${e(G)}/templates`),children:(X,ae)=>{f();var N=$("Back to Templates");n(X,N)},$$slots:{default:!0}}),n(C,h)},$$slots:{default:!0}}),s(g),n(x,g)},H=x=>{var g=Yt(),k=l(g),C=l(k),z=l(C),h=l(z);h.__click=be;var M=l(h);qt(M,{class:"h-5 w-5"}),s(h);var X=o(h,2),ae=l(X),N=l(ae);jt(N);var ye=o(N,2);{let a=S(()=>Ue(e(T)));ue(ye,{get variant(){return e(a)},size:"sm",children:(c,u)=>{f();var d=$();J(q=>K(d,q),[()=>We(e(T))]),n(c,d)},$$slots:{default:!0}})}var Qe=o(ye,2);{var Ye=a=>{ue(a,{variant:"success",size:"sm",children:(c,u)=>{f();var d=$("Active");n(c,d)},$$slots:{default:!0}})},et=a=>{ue(a,{variant:"default",size:"sm",children:(c,u)=>{f();var d=$("Inactive");n(c,d)},$$slots:{default:!0}})};D(Qe,a=>{e(j)?a(Ye):a(et,!1)})}s(ae),f(2),s(X),s(z);var $e=o(z,2),we=l($e);V(we,{type:"secondary",onclick:be,children:(a,c)=>{var u=Wt(),d=y(u);wt(d,{class:"mr-2 h-4 w-4"}),f(),n(a,u)},$$slots:{default:!0}});var Te=o(we,2);V(Te,{type:"secondary",onclick:()=>t(ee,!0),children:(a,c)=>{var u=Xt(),d=y(u);Tt(d,{class:"mr-2 h-4 w-4"}),f(),n(a,u)},$$slots:{default:!0}});var tt=o(Te,2);{let a=S(()=>e(R)||!e(Me));V(tt,{type:"primary",onclick:Oe,get disabled(){return e(a)},children:(c,u)=>{var d=Zt(),q=y(d);Mt(q,{class:"mr-2 h-4 w-4"});var O=o(q,2);{var ve=L=>{var Z=$("Saving...");n(L,Z)},ct=L=>{var Z=ze(),ut=y(Z);{var mt=I=>{var ce=$("Saved!");n(I,ce)},pt=I=>{var ce=$("Save & Close");n(I,ce)};D(ut,I=>{e(U)?I(mt):I(pt,!1)},!0)}n(L,Z)};D(O,L=>{e(R)?L(ve):L(ct,!1)})}n(c,d)},$$slots:{default:!0}})}s($e),s(C);var Pe=o(C,2);{var at=a=>{var c=Kt(),u=l(c);Le(u,{type:"error",title:"Error",onclose:()=>t(b,""),children:(d,q)=>{var O=Jt(),ve=l(O,!0);s(O),J(()=>K(ve,e(b))),n(d,O)},$$slots:{default:!0}}),s(c),n(a,c)};D(Pe,a=>{e(b)&&a(at)})}var ke=o(Pe,2),re=l(ke),Ce=l(re),le=l(Ce),Se=o(l(le),2),rt=l(Se,!0);s(Se),f(2),s(le);var se=o(le,2),lt=o(l(se),2);Pt(lt,{id:"template-description",type:"text",placeholder:"Optional description",get value(){return e(B)},set value(a){t(B,a,!0)}}),s(se);var oe=o(se,2),st=o(l(oe),2);kt(st,{id:"template-category",get options(){return _e},get value(){return e(T)},set value(a){t(T,a,!0)}}),s(oe);var ne=o(oe,2),ot=o(l(ne),2);Ct(ot,{get checked(){return e(j)},set checked(a){t(j,a,!0)}}),s(ne);var De=o(ne,2);St(De,{get variables(){return He},get insertVariable(){return e(fe)}});var Ae=o(De,2),nt=o(l(Ae),4);V(nt,{type:"danger",size:"sm",onclick:()=>t(W,!0),children:(a,c)=>{var u=Qt(),d=y(u);Ot(d,{class:"mr-2 h-4 w-4"}),f(),n(a,u)},$$slots:{default:!0}}),s(Ae),s(Ce),s(re);var Ee=o(re,2),ie=l(Ee),it=l(ie);Dt(it,{placeholder:"Start designing your email template...",showVariableInserts:!1,onInsertVariable:a=>t(fe,a,!0),class:"h-full",get value(){return e(P)},set value(a){t(P,a,!0)}}),s(ie);var je=o(ie,2),de=l(je),dt=o(l(de),2);dt.__click=Re,s(de);var vt=o(de,2);Nt(vt,{id:"plain-text",placeholder:"Auto-generated from HTML if left empty...",rows:4,get value(){return e(E)},set value(a){t(E,a,!0)}}),f(2),s(je),s(Ee),s(ke),s(k),s(g),J(()=>K(rt,e(pe))),At(N,()=>e(w),a=>t(w,a)),n(x,g)};D(_,x=>{e(i)?x(H,!1):x(F)},!0)}n(r,m)};D(xe,r=>{e(Y)?r(Xe):r(Ze,!1)})}var he=o(xe,2);{var Je=r=>{var m=ea(),_=l(m),F=l(_),H=l(F),x=l(H);s(H);var g=o(H,2);V(g,{type:"secondary",onclick:()=>t(ee,!1),children:(z,h)=>{f();var M=$("Close");n(z,M)},$$slots:{default:!0}}),s(F);var k=o(F,2),C=l(k);$t(C,()=>e(P)),s(k),s(_),s(m),J(()=>K(x,`Preview: ${e(w)??""}`)),n(r,m)};D(he,r=>{e(ee)&&e(i)&&r(Je)})}var Ke=o(he,2);{let r=S(()=>`Are you sure you want to delete "${e(i)?.name}"? This action cannot be undone.`),m=S(()=>e(te)?"Deleting...":"Delete");yt(Ke,{title:"Delete Template",get description(){return e(r)},get actionLabel(){return e(m)},actionType:"danger",onAction:Ge,onCancel:()=>t(W,!1),get open(){return e(W)},set open(_){t(W,_,!0)}})}n(Ie,ge),bt(),Fe()}ht(["click"]);export{xa as component};
