import"../chunks/DsnmJJEf.js";import{f as h,p as Lt,s as v,a as Ne,u as Ft,b as t,i as e,j as E,d as It,l as zt,h as a,g as Bt,c as i,r as l,n as A,t as Y}from"../chunks/DDjrJUyi.js";import{s as B}from"../chunks/CwHIudaz.js";import{c as de,a as n,f as x,t as L}from"../chunks/DbkN8AN9.js";import{l as Mt,s as Nt,i as F}from"../chunks/CGvWOYBA.js";import{s as Ht,e as Ot,i as Rt}from"../chunks/aSjiVL0V.js";import{h as Gt}from"../chunks/DHP91Nzo.js";import{s as Wt,a as Yt}from"../chunks/Bcmc20em.js";import{p as Jt}from"../chunks/Bmxv2sD2.js";import{g as He}from"../chunks/COzNDyHQ.js";import{ad as Kt,a0 as Qt,D as Ut,w as Vt,G as Xt,F as Ze,ae as Zt,af as ea,ag as ta}from"../chunks/yWEY6ChK.js";import{a as aa,s as ra,i as sa,A as et,B as C,C as Oe,I as ne,S as Re,n as la}from"../chunks/Bkv3Tidq.js";import{E as ia}from"../chunks/B00BxIdJ.js";import{L as oa}from"../chunks/BWhLmYGf.js";import{B as tt}from"../chunks/42UF-HRp.js";import{T as at}from"../chunks/-AgFL7sc.js";import{A as na}from"../chunks/-3LX6BNL.js";import{P as da,a as ca}from"../chunks/BTJkFoQ_.js";import{T as rt}from"../chunks/DxriTNl7.js";import{P as st}from"../chunks/BPUqRg7c.js";import{A as va}from"../chunks/C3zrvNYs.js";import{M as ua}from"../chunks/BinJvwcy.js";import"../chunks/BrWG_zvm.js";import{C as ma}from"../chunks/Bi_z5Ly_.js";import{S as pa}from"../chunks/BRZEcUHv.js";function fa(Pe,ce){const te=Mt(ce,["children","$$slots","$$events","$$legacy"]);const Ae=[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]];aa(Pe,Nt({name:"grip-vertical"},()=>te,{get iconNode(){return Ae},children:(Ee,M)=>{var k=de(),J=h(k);ra(J,ce,"default",{}),n(Ee,k)},$$slots:{default:!0}}))}var _a=x('<div class="flex justify-center py-12"><!></div>'),ga=x("<p>The requested autoresponder could not be found.</p> <!>",1),$a=x('<div class="flex items-center gap-1 text-sm text-text-muted mt-1"><span>On completion:</span> <!> <span class="text-primary"> </span></div>'),ya=x("<!> Pause",1),ha=x("<!> Activate",1),xa=x("<p> </p>"),ba=x("<!> Delete",1),wa=x('<h2 class="text-lg font-medium text-text mb-4">Settings</h2> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="seq-name" class="form-label">Name</label> <!></div> <div><label for="seq-trigger" class="form-label">Trigger</label> <!></div></div> <div class="mt-4"><label for="seq-list" class="form-label">List</label> <p class="text-sm text-text-muted mb-2">Move this autoresponder to a different list.</p> <!></div> <div class="mt-4"><label for="seq-on-completion" class="form-label">On Completion</label> <p class="text-sm text-text-muted mb-2">Automatically enroll contacts in another sequence when they complete this one.</p> <!></div> <div class="mt-4 flex items-center gap-4"><!> <!></div>',1),qa=x("<!> Add Email",1),Sa=x("<!> <!>",1),Pa=x('<div class="space-y-4"><div><label for="email-subject" class="form-label">Subject</label> <!></div> <div><label for="email-delay" class="form-label">Send</label> <div class="flex items-center gap-2"><!> <span class="text-text-muted"> </span></div></div> <div><label for="email-body" class="form-label">Content (HTML)</label> <!></div></div>'),Aa=x('<h3 class="font-medium text-text mb-4">Edit Email</h3> <div class="space-y-4"><div><label for="edit-subject" class="form-label">Subject</label> <!></div> <div><label for="edit-delay" class="form-label">Delay (hours)</label> <!></div> <div><label for="edit-body" class="form-label">Content (HTML)</label> <!></div> <div class="flex gap-2"><!> <!></div></div>',1),Ea=x("<!> Add Email",1),Ca=x('<div class="text-text-muted"><!></div> <div class="flex items-center justify-center h-8 w-8 rounded-full bg-primary text-white text-sm font-medium"></div> <div class="flex-1 min-w-0"><div class="font-medium text-text truncate"> </div> <div class="text-sm text-text-muted flex items-center gap-2"><!> </div></div> <div class="flex items-center gap-2"><!> <!></div>',1),ja=x('<div class="space-y-3"></div>'),ka=x('<div class="flex items-center gap-4 mb-6"><a class="p-2 rounded-lg hover:bg-bg-secondary transition-colors text-text-muted hover:text-text"><!></a> <div class="flex-1"><div class="flex items-center gap-2 text-sm text-text-muted mb-1"><span> </span> <span>/</span> <span>Autoresponder</span></div> <div class="flex items-center gap-3"><h1 class="text-2xl font-semibold text-text"> </h1> <!></div> <!></div> <!></div> <!> <!> <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-medium text-text">Emails</h2> <!></div> <!> <!> <!>',1),Ta=x('<div class="p-6 max-w-4xl mx-auto"><!></div> <!>',1);function sr(Pe,ce){Lt(ce,!0);const te=()=>Yt(Jt,"$page",Ae),[Ae,Ee]=Wt();let M=E(()=>te().params.id),k=E(()=>te().params.seqId),J=E(()=>`/${te().params.orgSlug}`),Ce=v(!0),d=v(null),K=v(Ne([])),Ge=v(null),We=v(Ne([])),Ye=v(Ne([])),S=v(""),O=v(""),Q=v("signup"),ve=v(!0),N=v(""),U=v(""),ue=v(!1),me=v(!1),V=v(!1),ae=v(!1),X=v(""),pe=v(0),fe=v(""),Z=v(null),re=v(""),_e=v(0),ge=v(""),$e=v(!1),ye=v(!1),je=v(!1),ke=v(null);Ft(()=>{he()});async function he(){t(Ce,!0),t(S,"");try{const[r,g,T,De]=await Promise.all([Kt({},e(k)),Qt({},e(M)),Ut(),Vt()]);t(d,r.sequence,!0),t(K,(r.templates||[]).sort((se,H)=>se.position-H.position),!0),t(Ge,g,!0),t(We,De.lists||[],!0),t(Ye,(T.sequences||[]).filter(se=>se.id!==e(k)),!0),t(O,e(d).name,!0),t(Q,e(d).trigger_event,!0),t(ve,e(d).is_active,!0),t(N,e(d).list_id||e(M),!0),t(U,e(d).on_completion_sequence_id||"",!0)}catch(r){console.error("Failed to load sequence:",r),t(S,"Failed to load autoresponder")}finally{t(Ce,!1)}}async function lt(){if(!(!e(d)||!e(O).trim())){t(ue,!0),t(me,!1),t(S,"");try{const r=e(N)!==e(M),g=await Ze({},{name:e(O).trim(),trigger_event:e(Q),is_active:e(ve),list_id:e(N),on_completion_sequence_id:e(U)||null},e(k));e(d).name=e(O).trim(),e(d).trigger_event=e(Q),e(d).is_active=e(ve),e(d).list_id=e(N),e(d).on_completion_sequence_id=e(U)||"",e(d).on_completion_sequence_name=g.on_completion_sequence_name||"",t(me,!0),r?He(`${e(J)}/lists/${e(N)}/autoresponders/${e(k)}`):setTimeout(()=>{t(me,!1)},2e3)}catch(r){t(S,r.message||"Failed to save",!0)}finally{t(ue,!1)}}}async function it(){if(e(d))try{await Ze({},{is_active:!e(d).is_active},e(k)),e(d).is_active=!e(d).is_active,t(ve,e(d).is_active,!0)}catch(r){t(S,r.message||"Failed to toggle status",!0)}}function Je(){t(X,""),t(pe,e(K).length===0?0:24,!0),t(fe,""),t(V,!0)}async function ot(){if(e(X).trim()){t(ae,!0),t(S,"");try{await Zt({sequence_id:e(k),subject:e(X).trim(),delay_hours:e(pe),html_body:e(fe)||"<p>Email content here</p>",is_active:!0,position:e(K).length+1}),t(V,!1),await he()}catch(r){t(S,r.message||"Failed to create email",!0)}finally{t(ae,!1)}}}function nt(r){t(Z,r,!0),t(re,r.subject,!0),t(_e,r.delay_hours,!0),t(ge,r.html_body,!0)}async function dt(){if(!(!e(Z)||!e(re).trim())){t($e,!0),t(S,"");try{await ea({},{subject:e(re).trim(),delay_hours:e(_e),html_body:e(ge)},e(Z).id),t(Z,null),await he()}catch(r){t(S,r.message||"Failed to save email",!0)}finally{t($e,!1)}}}async function ct(r){t(ke,r,!0);try{await ta({},r),await he()}catch(g){t(S,g.message||"Failed to delete email",!0)}finally{t(ke,null)}}async function vt(){t(je,!0);try{await Xt({},e(k)),He(`${e(J)}/lists/${e(M)}?tab=autoresponders`)}catch(r){t(S,r.message||"Failed to delete autoresponder",!0)}finally{t(je,!1)}}function ut(r){if(r===0)return"Immediately";if(r<24)return`${r} hour${r===1?"":"s"} after`;const g=Math.floor(r/24),T=r%24;return T===0?`${g} day${g===1?"":"s"} after`:`${g}d ${T}h after`}var Ke=Ta();Gt("4ksnzs",r=>{zt(()=>{Bt.title=`${(e(d)?.name||"Autoresponder")??""} | Outlet`})});var Te=h(Ke),mt=i(Te);{var pt=r=>{var g=_a(),T=i(g);oa(T,{size:"large"}),l(g),n(r,g)},ft=r=>{var g=de(),T=h(g);{var De=H=>{et(H,{type:"error",title:"Not found",children:(xe,be)=>{var R=ga(),Le=a(h(R),2);C(Le,{type:"primary",class:"mt-3",onclick:()=>He(`${e(J)}/lists/${e(M)}`),children:(le,we)=>{A();var qe=L("Back to List");n(le,qe)},$$slots:{default:!0}}),n(xe,R)},$$slots:{default:!0}})},se=H=>{var xe=ka(),be=h(xe),R=i(be),Le=i(R);na(Le,{class:"h-5 w-5"}),l(R);var le=a(R,2),we=i(le),qe=i(we),gt=i(qe,!0);l(qe),A(4),l(we);var Fe=a(we,2),Ie=i(Fe),$t=i(Ie,!0);l(Ie);var yt=a(Ie,2);{var ht=o=>{tt(o,{variant:"success",size:"sm",children:(c,m)=>{A();var s=L("Active");n(c,s)},$$slots:{default:!0}})},xt=o=>{tt(o,{variant:"default",size:"sm",children:(c,m)=>{A();var s=L("Paused");n(c,s)},$$slots:{default:!0}})};F(yt,o=>{e(d).is_active?o(ht):o(xt,!1)})}l(Fe);var bt=a(Fe,2);{var wt=o=>{var c=$a(),m=a(i(c),2);va(m,{class:"h-3 w-3"});var s=a(m,2),u=i(s,!0);l(s),l(c),Y(()=>B(u,e(d).on_completion_sequence_name)),n(o,c)};F(bt,o=>{e(d).on_completion_sequence_name&&o(wt)})}l(le);var qt=a(le,2);{let o=E(()=>e(d).is_active?"secondary":"primary");C(qt,{get type(){return e(o)},onclick:it,children:(c,m)=>{var s=de(),u=h(s);{var $=_=>{var p=ya(),b=h(p);da(b,{class:"mr-2 h-4 w-4"}),A(),n(_,p)},y=_=>{var p=ha(),b=h(p);ca(b,{class:"mr-2 h-4 w-4"}),A(),n(_,p)};F(u,_=>{e(d).is_active?_($):_(y,!1)})}n(c,s)},$$slots:{default:!0}})}l(be);var Qe=a(be,2);{var St=o=>{et(o,{type:"error",title:"Error",class:"mb-4",children:(c,m)=>{var s=xa(),u=i(s,!0);l(s),Y(()=>B(u,e(S))),n(c,s)},$$slots:{default:!0}})};F(Qe,o=>{e(S)&&o(St)})}var Ue=a(Qe,2);Oe(Ue,{class:"mb-6",children:(o,c)=>{var m=wa(),s=a(h(m),2),u=i(s),$=a(i(u),2);ne($,{id:"seq-name",type:"text",get value(){return e(O)},set value(w){t(O,w,!0)}}),l(u);var y=a(u,2),_=a(i(y),2);Re(_,{id:"seq-trigger",options:[{value:"signup",label:"On signup"},{value:"manual",label:"Manual enrollment"}],get value(){return e(Q)},set value(w){t(Q,w,!0)}}),l(y),l(s);var p=a(s,2),b=a(i(p),4);{let w=E(()=>e(We).map(f=>({value:String(f.id),label:f.name})));Re(b,{id:"seq-list",get options(){return e(w)},get value(){return e(N)},set value(f){t(N,f,!0)}})}l(p);var I=a(p,2),D=a(i(I),4);{let w=E(()=>[{value:"",label:"None (do nothing)"},...e(Ye).map(f=>({value:f.id,label:f.name}))]);Re(D,{id:"seq-on-completion",get options(){return e(w)},get value(){return e(U)},set value(f){t(U,f,!0)}})}l(I);var j=a(I,2),q=i(j);{let w=E(()=>e(ue)||e(O)===e(d).name&&e(Q)===e(d).trigger_event&&e(N)===(e(d).list_id||e(M))&&e(U)===(e(d).on_completion_sequence_id||""));C(q,{type:"primary",onclick:lt,get disabled(){return e(w)},children:(f,ie)=>{var G=de(),Se=h(G);{var Be=z=>{var oe=L("Saving...");n(z,oe)},W=z=>{var oe=de(),kt=h(oe);{var Tt=ee=>{var Me=L("Saved!");n(ee,Me)},Dt=ee=>{var Me=L("Save Changes");n(ee,Me)};F(kt,ee=>{e(me)?ee(Tt):ee(Dt,!1)},!0)}n(z,oe)};F(Se,z=>{e(ue)?z(Be):z(W,!1)})}n(f,G)},$$slots:{default:!0}})}var P=a(q,2);C(P,{type:"danger",onclick:()=>t(ye,!0),children:(w,f)=>{var ie=ba(),G=h(ie);rt(G,{class:"mr-2 h-4 w-4"}),A(),n(w,ie)},$$slots:{default:!0}}),l(j),n(o,m)},$$slots:{default:!0}});var ze=a(Ue,2),Pt=a(i(ze),2);C(Pt,{type:"primary",onclick:Je,get disabled(){return e(V)},children:(o,c)=>{var m=qa(),s=h(m);st(s,{class:"mr-2 h-4 w-4"}),A(),n(o,m)},$$slots:{default:!0}}),l(ze);var Ve=a(ze,2);la(Ve,{title:"Add Email to Sequence",get show(){return e(V)},set show(c){t(V,c,!0)},footer:c=>{var m=Sa(),s=h(m);C(s,{type:"secondary",onclick:()=>t(V,!1),get disabled(){return e(ae)},children:($,y)=>{A();var _=L("Cancel");n($,_)},$$slots:{default:!0}});var u=a(s,2);{let $=E(()=>!e(X).trim()||e(ae));C(u,{type:"primary",onclick:ot,get disabled(){return e($)},children:(y,_)=>{A();var p=L();Y(()=>B(p,e(ae)?"Adding...":"Add Email")),n(y,p)},$$slots:{default:!0}})}n(c,m)},children:(c,m)=>{var s=Pa(),u=i(s),$=a(i(u),2);ne($,{id:"email-subject",type:"text",placeholder:"Welcome to our newsletter!",get value(){return e(X)},set value(q){t(X,q,!0)}}),l(u);var y=a(u,2),_=a(i(y),2),p=i(_);ne(p,{id:"email-delay",type:"number",min:0,class:"w-24",get value(){return e(pe)},set value(q){t(pe,q,!0)}});var b=a(p,2),I=i(b);l(b),l(_),l(y);var D=a(y,2),j=a(i(D),2);at(j,{id:"email-body",rows:6,placeholder:"<p>Your email content...</p>",get value(){return e(fe)},set value(q){t(fe,q,!0)}}),l(D),l(s),Y(()=>B(I,`hours after ${e(K).length===0?"signup":"previous email"}`)),n(c,s)},$$slots:{footer:!0,default:!0}});var Xe=a(Ve,2);{var At=o=>{Oe(o,{class:"mb-4 border-primary",children:(c,m)=>{var s=Aa(),u=a(h(s),2),$=i(u),y=a(i($),2);ne(y,{id:"edit-subject",type:"text",get value(){return e(re)},set value(P){t(re,P,!0)}}),l($);var _=a($,2),p=a(i(_),2);ne(p,{id:"edit-delay",type:"number",min:0,class:"w-32",get value(){return e(_e)},set value(P){t(_e,P,!0)}}),l(_);var b=a(_,2),I=a(i(b),2);at(I,{id:"edit-body",rows:8,get value(){return e(ge)},set value(P){t(ge,P,!0)}}),l(b);var D=a(b,2),j=i(D);C(j,{type:"primary",onclick:dt,get disabled(){return e($e)},children:(P,w)=>{A();var f=L();Y(()=>B(f,e($e)?"Saving...":"Save")),n(P,f)},$$slots:{default:!0}});var q=a(j,2);C(q,{type:"secondary",onclick:()=>t(Z,null),children:(P,w)=>{A();var f=L("Cancel");n(P,f)},$$slots:{default:!0}}),l(D),l(u),n(c,s)},$$slots:{default:!0}})};F(Xe,o=>{e(Z)&&o(At)})}var Et=a(Xe,2);{var Ct=o=>{ia(o,{get icon(){return ua},title:"No emails yet",description:"Add your first email to this autoresponder sequence.",children:(c,m)=>{C(c,{type:"primary",onclick:Je,children:(s,u)=>{var $=Ea(),y=h($);st(y,{class:"mr-2 h-4 w-4"}),A(),n(s,$)},$$slots:{default:!0}})},$$slots:{default:!0}})},jt=o=>{var c=ja();Ot(c,21,()=>e(K),Rt,(m,s,u)=>{{let $=E(()=>e(s).is_active?"":"opacity-60");Oe(m,{get class(){return`flex items-center gap-4 ${e($)??""}`},children:(y,_)=>{var p=Ca(),b=h(p),I=i(b);fa(I,{class:"h-5 w-5"}),l(b);var D=a(b,2);D.textContent=u+1;var j=a(D,2),q=i(j),P=i(q,!0);l(q);var w=a(q,2),f=i(w);ma(f,{class:"h-3 w-3"});var ie=a(f);l(w),l(j);var G=a(j,2),Se=i(G);C(Se,{type:"ghost",size:"sm",onclick:()=>nt(e(s)),children:(W,z)=>{pa(W,{class:"h-4 w-4"})},$$slots:{default:!0}});var Be=a(Se,2);{let W=E(()=>e(ke)===e(s).id);C(Be,{type:"ghost",size:"sm",onclick:()=>ct(e(s).id),get disabled(){return e(W)},class:"text-error hover:bg-error/10",children:(z,oe)=>{rt(z,{class:"h-4 w-4"})},$$slots:{default:!0}})}l(G),Y(W=>{B(P,e(s).subject),B(ie,` ${W??""}`)},[()=>ut(e(s).delay_hours)]),n(y,p)},$$slots:{default:!0}})}}),l(c),n(o,c)};F(Et,o=>{e(K).length===0?o(Ct):o(jt,!1)})}Y(()=>{Ht(R,"href",`${e(J)??""}/lists/${e(M)??""}`),B(gt,e(Ge)?.name),B($t,e(d).name)}),n(H,xe)};F(T,H=>{e(d)?H(se,!1):H(De)},!0)}n(r,g)};F(mt,r=>{e(Ce)?r(pt):r(ft,!1)})}l(Te);var _t=a(Te,2);{let r=E(()=>`Are you sure you want to delete "${e(d)?.name}"? This will delete all emails in this sequence. This action cannot be undone.`),g=E(()=>e(je)?"Deleting...":"Delete");sa(_t,{title:"Delete Autoresponder",get description(){return e(r)},get actionLabel(){return e(g)},actionType:"danger",onAction:vt,onCancel:()=>t(ye,!1),get open(){return e(ye)},set open(T){t(ye,T,!0)}})}n(Pe,Ke),It(),Ee()}export{sr as component};
