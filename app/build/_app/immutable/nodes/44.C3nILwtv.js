import"../chunks/DsnmJJEf.js";import{p as ft,u as _t,i as e,b as t,f as y,d as bt,j as S,s as v,m as gt,h as o,g as xt,c as l,r as s,n as f,t as J}from"../chunks/odI--4Kw.js";import{d as ht,s as K}from"../chunks/BNMK9zrr.js";import{a as n,f as p,c as Le,t as $}from"../chunks/CCInJaqd.js";import{i as D}from"../chunks/COaB7F5h.js";import{h as yt,B as V,o as $t,A as je,X as wt,p as Tt,I as kt,S as Pt,m as Ct,P as St,E as Dt,k as At}from"../chunks/D_7vKuD1.js";import{h as Et}from"../chunks/hUjpWz_l.js";import{r as zt}from"../chunks/BohEjZuL.js";import{s as Lt,a as jt}from"../chunks/DL1yFSKa.js";import{p as It}from"../chunks/CUmUlLWG.js";import{g as Q}from"../chunks/Dk4plwcb.js";import{$ as Vt,_ as Bt,a0 as Ft}from"../chunks/DsZuZzfy.js";import{L as Ht}from"../chunks/D716f0vp.js";import{B as ue}from"../chunks/BD7k7D4N.js";import{S as Mt,T as Nt}from"../chunks/Ceo3VJKj.js";import{A as Ot}from"../chunks/CUtZKp-H.js";import{T as qt}from"../chunks/DLmn3-pQ.js";var Gt=p('<div class="flex justify-center py-12"><!></div>'),Rt=p("<p>The requested template could not be found.</p> <!>",1),Ut=p('<div class="p-6"><!></div>'),Wt=p("<!> Cancel",1),Xt=p("<!> Preview",1),Zt=p("<!> <!>",1),Jt=p("<p> </p>"),Kt=p('<div class="px-6 pt-4"><!></div>'),Qt=p("<!> Delete Template",1),Yt=p(`<div class="fixed inset-0 z-50 bg-base-200"><div class="h-full flex flex-col"><div class="bg-base-100 border-b border-base-300 px-6 py-4 flex items-center justify-between flex-shrink-0"><div class="flex items-center gap-4"><button type="button" class="p-2 rounded-lg hover:bg-base-200 transition-colors text-base-content/60 hover:text-base-content"><!></button> <div><div class="flex items-center gap-2"><input type="text" placeholder="Template Name" class="text-lg font-semibold text-base-content bg-transparent border-none focus:outline-none focus:ring-0 placeholder:text-base-content/40 w-64"/> <!> <!></div> <p class="text-xs text-base-content/50">Email Template</p></div></div> <div class="flex items-center gap-3"><!> <!> <!></div></div> <!> <div class="flex-1 overflow-hidden flex"><div class="w-80 bg-base-100 border-r border-base-300 p-6 overflow-y-auto flex-shrink-0"><div class="space-y-6"><div><label class="form-label">Slug</label> <p class="text-sm text-base-content/70 bg-base-200 px-3 py-2 rounded-md font-mono"> </p> <p class="mt-1 text-xs text-base-content/50 italic">Cannot be changed after creation</p></div> <div><label for="template-description" class="form-label">Description</label> <!></div> <div><label for="template-category" class="form-label">Category</label> <!></div> <div class="flex items-center justify-between py-2"><span class="text-sm font-medium text-base-content">Active</span> <!></div> <!> <div class="border-t border-base-300 pt-6"><h4 class="text-sm font-medium text-error mb-3">Danger Zone</h4> <p class="text-xs text-base-content/60 mb-3">Permanently delete this template. This action cannot be undone.</p> <!></div></div></div> <div class="flex-1 flex flex-col overflow-hidden p-6 gap-4"><div class="flex-1 min-h-0"><!></div> <div class="flex-shrink-0"><div class="flex items-center justify-between mb-1"><label for="plain-text" class="form-label mb-0">Plain Text Version</label> <button type="button" class="text-xs text-primary hover:text-primary/80">Regenerate from HTML</button></div> <!> <p class="mt-1 text-xs text-base-content/50 italic">Plain text version for email clients that don't support HTML.</p></div></div></div></div></div>`),ea=p('<div class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4"><div class="bg-base-100 rounded-xl shadow-xl max-w-3xl w-full max-h-[90vh] flex flex-col"><div class="flex items-center justify-between p-4 border-b border-base-300"><h3 class="text-lg font-medium text-base-content"> </h3> <!></div> <div class="flex-1 overflow-auto p-4 bg-white"><!></div></div></div>'),ta=p("<!> <!> <!>",1);function xa(Ie,Ve){ft(Ve,!0);const me=()=>jt(It,"$page",Be),[Be,Fe]=Lt();let A=S(()=>me().params.id),G=S(()=>`/${me().params.brandSlug}`),Y=v(!0),i=v(null),b=v(""),w=v(""),pe=v(""),B=v(""),T=v("general"),k=v(""),E=v(""),z=v(!0),R=v(!1),U=v(!1),ee=v(!1),W=v(!1),te=v(!1),fe=v(null);const He=[{name:"content",label:"Main content area"},{name:"email",label:"Subscriber email"},{name:"name",label:"Subscriber name"},{name:"name,fallback=Friend",label:"Name with fallback"},{name:"unsubscribe_url",label:"Unsubscribe link"},{name:"web_version_url",label:"Web version link"}],_e=[{value:"general",label:"General"},{value:"newsletter",label:"Newsletter"},{value:"promotional",label:"Promotional"},{value:"transactional",label:"Transactional"}];let Me=S(()=>e(i)!==null&&(e(w)!==e(i).name||e(B)!==(e(i).description||"")||e(T)!==e(i).category||e(k)!==e(i).html_body||e(E)!==(e(i).plain_text||"")||e(z)!==e(i).is_active));_t(()=>{Ne()});async function Ne(){if(e(A)){t(Y,!0),t(b,"");try{t(i,await Vt({},e(A)),!0),t(w,e(i).name,!0),t(pe,e(i).slug,!0),t(B,e(i).description||"",!0),t(T,e(i).category,!0),t(k,e(i).html_body,!0),t(E,e(i).plain_text||"",!0),t(z,e(i).is_active,!0)}catch(r){console.error("Failed to load template:",r),t(b,"Failed to load template")}finally{t(Y,!1)}}}async function Oe(){if(!(!e(i)||!e(A)||!e(w).trim())){t(R,!0),t(U,!1),t(b,"");try{const r=await Ft({},{name:e(w).trim(),description:e(B).trim()||void 0,category:e(T),html_body:e(k),plain_text:e(E)||void 0,is_active:e(z)},e(A));t(i,r,!0),t(U,!0),setTimeout(()=>{t(U,!1)},2e3)}catch(r){console.error("Failed to save template:",r),t(b,r.message||"Failed to save template",!0)}finally{t(R,!1)}}}async function qe(){await Oe(),e(b)||Q(`${e(G)}/templates`)}async function Ge(){if(e(A)){t(te,!0);try{await Bt({},e(A)),Q(`${e(G)}/templates`)}catch(r){t(b,r.message||"Failed to delete template",!0)}finally{t(te,!1)}}}function be(){Q(`${e(G)}/templates`)}function Re(){const r=document.createElement("div");r.innerHTML=e(k),t(E,r.textContent||r.innerText||"",!0)}function Ue(r){switch(r){case"newsletter":return"info";case"promotional":return"warning";case"transactional":return"success";default:return"default"}}function We(r){return _e.find(_=>_.value===r)?.label||r}var ge=ta();Et("k8ernf",r=>{gt(()=>{xt.title=`${(e(i)?.name||"Template")??""} | Outlet`})});var xe=y(ge);{var Xe=r=>{var m=Gt(),_=l(m);Ht(_,{size:"lg"}),s(m),n(r,m)},Ze=r=>{var m=Le(),_=y(m);{var F=x=>{var g=Ut(),P=l(g);je(P,{type:"error",title:"Template not found",children:(C,L)=>{var h=Rt(),M=o(y(h),2);V(M,{type:"primary",class:"mt-3",onclick:()=>Q(`${e(G)}/templates`),children:(X,ae)=>{f();var N=$("Back to Templates");n(X,N)},$$slots:{default:!0}}),n(C,h)},$$slots:{default:!0}}),s(g),n(x,g)},H=x=>{var g=Yt(),P=l(g),C=l(P),L=l(C),h=l(L);h.__click=be;var M=l(h);Ot(M,{class:"h-5 w-5"}),s(h);var X=o(h,2),ae=l(X),N=l(ae);zt(N);var ye=o(N,2);{let a=S(()=>Ue(e(T)));ue(ye,{get variant(){return e(a)},size:"sm",children:(c,u)=>{f();var d=$();J(O=>K(d,O),[()=>We(e(T))]),n(c,d)},$$slots:{default:!0}})}var Qe=o(ye,2);{var Ye=a=>{ue(a,{variant:"success",size:"sm",children:(c,u)=>{f();var d=$("Active");n(c,d)},$$slots:{default:!0}})},et=a=>{ue(a,{variant:"default",size:"sm",children:(c,u)=>{f();var d=$("Inactive");n(c,d)},$$slots:{default:!0}})};D(Qe,a=>{e(z)?a(Ye):a(et,!1)})}s(ae),f(2),s(X),s(L);var $e=o(L,2),we=l($e);V(we,{type:"secondary",onclick:be,children:(a,c)=>{var u=Wt(),d=y(u);wt(d,{class:"mr-2 h-4 w-4"}),f(),n(a,u)},$$slots:{default:!0}});var Te=o(we,2);V(Te,{type:"secondary",onclick:()=>t(ee,!0),children:(a,c)=>{var u=Xt(),d=y(u);Tt(d,{class:"mr-2 h-4 w-4"}),f(),n(a,u)},$$slots:{default:!0}});var tt=o(Te,2);{let a=S(()=>e(R)||!e(Me));V(tt,{type:"primary",onclick:qe,get disabled(){return e(a)},children:(c,u)=>{var d=Zt(),O=y(d);Mt(O,{class:"mr-2 h-4 w-4"});var q=o(O,2);{var ve=j=>{var Z=$("Saving...");n(j,Z)},ct=j=>{var Z=Le(),ut=y(Z);{var mt=I=>{var ce=$("Saved!");n(I,ce)},pt=I=>{var ce=$("Save & Close");n(I,ce)};D(ut,I=>{e(U)?I(mt):I(pt,!1)},!0)}n(j,Z)};D(q,j=>{e(R)?j(ve):j(ct,!1)})}n(c,d)},$$slots:{default:!0}})}s($e),s(C);var ke=o(C,2);{var at=a=>{var c=Kt(),u=l(c);je(u,{type:"error",title:"Error",onclose:()=>t(b,""),children:(d,O)=>{var q=Jt(),ve=l(q,!0);s(q),J(()=>K(ve,e(b))),n(d,q)},$$slots:{default:!0}}),s(c),n(a,c)};D(ke,a=>{e(b)&&a(at)})}var Pe=o(ke,2),re=l(Pe),Ce=l(re),le=l(Ce),Se=o(l(le),2),rt=l(Se,!0);s(Se),f(2),s(le);var se=o(le,2),lt=o(l(se),2);kt(lt,{id:"template-description",type:"text",placeholder:"Optional description",get value(){return e(B)},set value(a){t(B,a,!0)}}),s(se);var oe=o(se,2),st=o(l(oe),2);Pt(st,{id:"template-category",get options(){return _e},get value(){return e(T)},set value(a){t(T,a,!0)}}),s(oe);var ne=o(oe,2),ot=o(l(ne),2);Ct(ot,{get checked(){return e(z)},set checked(a){t(z,a,!0)}}),s(ne);var De=o(ne,2);St(De,{get variables(){return He},get insertVariable(){return e(fe)}});var Ae=o(De,2),nt=o(l(Ae),4);V(nt,{type:"danger",size:"sm",onclick:()=>t(W,!0),children:(a,c)=>{var u=Qt(),d=y(u);qt(d,{class:"mr-2 h-4 w-4"}),f(),n(a,u)},$$slots:{default:!0}}),s(Ae),s(Ce),s(re);var Ee=o(re,2),ie=l(Ee),it=l(ie);Dt(it,{placeholder:"Start designing your email template...",showVariableInserts:!1,onInsertVariable:a=>t(fe,a,!0),class:"h-full",get value(){return e(k)},set value(a){t(k,a,!0)}}),s(ie);var ze=o(ie,2),de=l(ze),dt=o(l(de),2);dt.__click=Re,s(de);var vt=o(de,2);Nt(vt,{id:"plain-text",placeholder:"Auto-generated from HTML if left empty...",rows:4,get value(){return e(E)},set value(a){t(E,a,!0)}}),f(2),s(ze),s(Ee),s(Pe),s(P),s(g),J(()=>K(rt,e(pe))),At(N,()=>e(w),a=>t(w,a)),n(x,g)};D(_,x=>{e(i)?x(H,!1):x(F)},!0)}n(r,m)};D(xe,r=>{e(Y)?r(Xe):r(Ze,!1)})}var he=o(xe,2);{var Je=r=>{var m=ea(),_=l(m),F=l(_),H=l(F),x=l(H);s(H);var g=o(H,2);V(g,{type:"secondary",onclick:()=>t(ee,!1),children:(L,h)=>{f();var M=$("Close");n(L,M)},$$slots:{default:!0}}),s(F);var P=o(F,2),C=l(P);$t(C,()=>e(k)),s(P),s(_),s(m),J(()=>K(x,`Preview: ${e(w)??""}`)),n(r,m)};D(he,r=>{e(ee)&&e(i)&&r(Je)})}var Ke=o(he,2);{let r=S(()=>`Are you sure you want to delete "${e(i)?.name}"? This action cannot be undone.`),m=S(()=>e(te)?"Deleting...":"Delete");yt(Ke,{title:"Delete Template",get description(){return e(r)},get actionLabel(){return e(m)},actionType:"danger",onAction:Ge,onCancel:()=>t(W,!1),get open(){return e(W)},set open(_){t(W,_,!0)}})}n(Ie,ge),bt(),Fe()}ht(["click"]);export{xa as component};
