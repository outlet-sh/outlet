import"../chunks/DsnmJJEf.js";import{f,p as Ct,s as c,a as Ye,u as Lt,b as t,i as e,d as It,j as q,m as Dt,h as r,g as zt,c as l,r as s,n as w,t as ve}from"../chunks/odI--4Kw.js";import{d as Ft,s as E}from"../chunks/BNMK9zrr.js";import{c as he,a as d,f as p,t as ue}from"../chunks/CCInJaqd.js";import{l as Mt,s as Nt,i as T}from"../chunks/COaB7F5h.js";import{s as Bt,e as Ht,i as Vt}from"../chunks/BohEjZuL.js";import{h as Ot}from"../chunks/hUjpWz_l.js";import{s as Rt,a as Wt}from"../chunks/DL1yFSKa.js";import{p as Gt}from"../chunks/BjuI_FD0.js";import{g as Ze}from"../chunks/CHD2oXEM.js";import{ae as Xt,a1 as Jt,E as Kt,w as Qt,H as Ut,af as Yt,ag as Zt,G as dt,ah as ea}from"../chunks/cAHYBDdg.js";import{a as ta,s as aa,h as ra,B as A,X as sa,I as et,P as la,E as ia,A as ct,C as vt,S as tt}from"../chunks/Bx02zSD-.js";import{E as oa}from"../chunks/DWAH7Nnh.js";import{L as na}from"../chunks/D716f0vp.js";import{B as ut}from"../chunks/BD7k7D4N.js";import{S as da,T as ca}from"../chunks/BnsCOi1c.js";import{A as va}from"../chunks/BVgBxdXH.js";import{P as ua,a as ma}from"../chunks/B-7Fxcrb.js";import{T as mt}from"../chunks/CwD6Wilq.js";import{P as ft}from"../chunks/DaHdHLtU.js";import{A as fa}from"../chunks/8MlE4Hm4.js";import{M as pa}from"../chunks/CrfBT87S.js";import"../chunks/B9hjHVe6.js";import{C as _a}from"../chunks/7IKYCLhN.js";import{S as ga}from"../chunks/DwX3URvx.js";function xa(Le,be){const me=Mt(be,["children","$$slots","$$events","$$legacy"]);const Ie=[["circle",{cx:"9",cy:"12",r:"1"}],["circle",{cx:"9",cy:"5",r:"1"}],["circle",{cx:"9",cy:"19",r:"1"}],["circle",{cx:"15",cy:"12",r:"1"}],["circle",{cx:"15",cy:"5",r:"1"}],["circle",{cx:"15",cy:"19",r:"1"}]];ta(Le,Nt({name:"grip-vertical"},()=>me,{get iconNode(){return Ie},children:(De,z)=>{var S=he(),te=f(S);aa(te,be,"default",{}),d(De,S)},$$slots:{default:!0}}))}var ha=p('<div class="flex justify-center py-12"><!></div>'),ba=p("<p>The requested autoresponder could not be found.</p> <!>",1),$a=p('<div class="flex items-center gap-1 text-sm text-text-muted mt-1"><span>On completion:</span> <!> <span class="text-primary"> </span></div>'),ya=p("<!> Pause",1),qa=p("<!> Activate",1),wa=p("<p> </p>"),Sa=p("<!> Delete",1),Pa=p('<h2 class="text-lg font-medium text-text mb-4">Settings</h2> <div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="seq-name" class="form-label">Name</label> <!></div> <div><label for="seq-trigger" class="form-label">Trigger</label> <!></div></div> <div class="mt-4"><label for="seq-list" class="form-label">List</label> <p class="text-sm text-text-muted mb-2">Move this autoresponder to a different list.</p> <!></div> <div class="mt-4"><label for="seq-on-completion" class="form-label">On Completion</label> <p class="text-sm text-text-muted mb-2">Automatically enroll contacts in another sequence when they complete this one.</p> <!></div> <div class="mt-4 flex items-center gap-4"><!> <!></div>',1),Ea=p("<!> Add Email",1),Ta=p("<!> Add Email",1),Aa=p('<div class="text-text-muted"><!></div> <div class="flex items-center justify-center h-8 w-8 rounded-full bg-primary text-white text-sm font-medium"></div> <div class="flex-1 min-w-0"><div class="font-medium text-text truncate"> </div> <div class="text-sm text-text-muted flex items-center gap-2"><!> </div></div> <div class="flex items-center gap-2"><!> <!></div>',1),ka=p('<div class="space-y-3"></div>'),ja=p('<div class="flex items-center gap-4 mb-6"><a class="p-2 rounded-lg hover:bg-bg-secondary transition-colors text-text-muted hover:text-text"><!></a> <div class="flex-1"><div class="flex items-center gap-2 text-sm text-text-muted mb-1"><span> </span> <span>/</span> <span>Autoresponder</span></div> <div class="flex items-center gap-3"><h1 class="text-2xl font-semibold text-text"> </h1> <!></div> <!></div> <!></div> <!> <!> <div class="flex items-center justify-between mb-4"><h2 class="text-lg font-medium text-text">Emails</h2> <!></div> <!>',1),Ca=p("<!> Cancel",1),La=p("<!> ",1),Ia=p('<div class="fixed inset-0 z-50 bg-base-200"><div class="h-full flex flex-col"><div class="bg-base-100 border-b border-base-300 px-6 py-4 flex items-center justify-between flex-shrink-0"><h3 class="text-lg font-semibold text-base-content"> </h3> <div class="flex items-center gap-3"><!> <!></div></div> <div class="flex-1 overflow-hidden flex"><div class="w-80 bg-base-100 border-r border-base-300 p-6 overflow-y-auto flex-shrink-0"><div class="space-y-6"><div><label for="email-subject" class="form-label">Subject Line</label> <!></div> <div><label for="email-delay" class="form-label">Send Timing</label> <div class="flex items-center gap-2"><!> <span class="text-sm text-base-content/70"> </span></div> <p class="mt-1 text-xs text-base-content/50 italic"> </p></div> <div class="bg-base-200 rounded-lg p-4"><h4 class="text-sm font-medium text-base-content mb-2">About This Email</h4> <p class="text-xs text-base-content/70">This email is part of your autoresponder sequence. It will be sent automatically based on the timing you set above.</p></div> <!></div></div> <div class="flex-1 flex flex-col overflow-hidden p-6 gap-4"><div class="flex-1 min-h-0"><!></div> <div class="flex-shrink-0"><div class="flex items-center justify-between mb-1"><label for="email-plaintext" class="form-label mb-0">Plain Text Version</label> <button type="button" class="text-xs text-primary hover:text-primary/80">Regenerate from HTML</button></div> <!> <p class="mt-1 text-xs text-base-content/50 italic">Auto-generated from HTML if left empty. Edit to customize.</p></div></div></div></div></div>'),Da=p('<div class="p-6 max-w-5xl mx-auto"><!></div> <!> <!>',1);function or(Le,be){Ct(be,!0);const me=()=>Wt(Gt,"$page",Ie),[Ie,De]=Rt();let z=q(()=>me().params.id),S=q(()=>me().params.seqId),te=q(()=>`/${me().params.brandSlug}`),ze=c(!0),i=c(null),ae=c(Ye([])),at=c(null),rt=c(Ye([])),st=c(Ye([])),b=c(""),O=c(""),re=c("signup"),$e=c(!0),F=c(""),se=c(""),ye=c(!1),qe=c(!1),fe=c(!1),le=c(null),M=c(""),N=c(0),R=c(""),W=c(""),we=c(!1),Fe=c(!1),lt=c(null),Se=c(!1),Me=c(!1),Ne=c(null);const pt=[{name:"name",label:"Subscriber name"},{name:"email",label:"Subscriber email"},{name:"name,fallback=Friend",label:"Name with fallback"}];Lt(()=>{Be()});async function Be(){t(ze,!0),t(b,"");try{const[a,u,h,G]=await Promise.all([Xt({},e(S)),Jt({},e(z)),Kt(),Qt()]);t(i,a.sequence,!0),t(ae,(a.templates||[]).sort((k,P)=>k.position-P.position),!0),t(at,u,!0),t(rt,G.lists||[],!0),t(st,(h.sequences||[]).filter(k=>k.id!==e(S)),!0),t(O,e(i).name,!0),t(re,e(i).trigger_event,!0),t($e,e(i).is_active,!0),t(F,e(i).list_id||e(z),!0),t(se,e(i).on_completion_sequence_id||"",!0)}catch(a){console.error("Failed to load sequence:",a),t(b,"Failed to load autoresponder")}finally{t(ze,!1)}}async function _t(){if(!(!e(i)||!e(O).trim())){t(ye,!0),t(qe,!1),t(b,"");try{const a=e(F)!==e(z),u=await dt({},{name:e(O).trim(),trigger_event:e(re),is_active:e($e),list_id:e(F),on_completion_sequence_id:e(se)||null},e(S));e(i).name=e(O).trim(),e(i).trigger_event=e(re),e(i).is_active=e($e),e(i).list_id=e(F),e(i).on_completion_sequence_id=e(se)||"",e(i).on_completion_sequence_name=u.on_completion_sequence_name||"",t(qe,!0),a?Ze(`${e(te)}/lists/${e(F)}/autoresponders/${e(S)}`):setTimeout(()=>{t(qe,!1)},2e3)}catch(a){t(b,a.message||"Failed to save",!0)}finally{t(ye,!1)}}}async function gt(){if(e(i))try{await dt({},{is_active:!e(i).is_active},e(S)),e(i).is_active=!e(i).is_active,t($e,e(i).is_active,!0)}catch(a){t(b,a.message||"Failed to toggle status",!0)}}function it(){t(le,null),t(M,""),t(N,e(ae).length===0?0:24,!0),t(R,""),t(W,""),t(fe,!0)}function xt(a){t(le,a,!0),t(M,a.subject,!0),t(N,a.delay_hours,!0),t(R,a.html_body,!0),t(W,a.plain_text||"",!0),t(fe,!0)}async function ht(){if(!e(M).trim()){t(b,"Subject is required");return}t(we,!0),t(Fe,!1),t(b,"");try{e(le)?await Yt({},{subject:e(M).trim(),delay_hours:e(N),html_body:e(R)||"<p>Email content here</p>",plain_text:e(W).trim()||void 0},e(le).id):await Zt({sequence_id:e(S),subject:e(M).trim(),delay_hours:e(N),html_body:e(R)||"<p>Email content here</p>",plain_text:e(W).trim()||void 0,is_active:!0,position:e(ae).length+1}),t(Fe,!0),t(fe,!1),await Be()}catch(a){t(b,a.message||"Failed to save email",!0)}finally{t(we,!1)}}async function bt(a){t(Ne,a,!0);try{await ea({},a),await Be()}catch(u){t(b,u.message||"Failed to delete email",!0)}finally{t(Ne,null)}}async function $t(){t(Me,!0);try{await Ut({},e(S)),Ze(`${e(te)}/lists/${e(z)}/autoresponders`)}catch(a){t(b,a.message||"Failed to delete autoresponder",!0)}finally{t(Me,!1)}}function yt(){const a=document.createElement("div");a.innerHTML=e(R),t(W,a.textContent||a.innerText||"",!0)}function qt(a){if(a===0)return"Immediately";if(a<24)return`${a} hour${a===1?"":"s"} after`;const u=Math.floor(a/24),h=a%24;return h===0?`${u} day${u===1?"":"s"} after`:`${u}d ${h}h after`}var ot=Da();Ot("1ak94jh",a=>{Dt(()=>{zt.title=`${(e(i)?.name||"Autoresponder")??""} | Outlet`})});var He=f(ot),wt=l(He);{var St=a=>{var u=ha(),h=l(u);na(h,{size:"large"}),s(u),d(a,u)},Pt=a=>{var u=he(),h=f(u);{var G=P=>{ct(P,{type:"error",title:"Not found",children:(X,J)=>{var j=ba(),ie=r(f(j),2);A(ie,{type:"primary",class:"mt-3",onclick:()=>Ze(`${e(te)}/lists/${e(z)}`),children:(C,K)=>{w();var B=ue("Back to List");d(C,B)},$$slots:{default:!0}}),d(X,j)},$$slots:{default:!0}})},k=P=>{var X=ja(),J=f(X),j=l(J),ie=l(j);va(ie,{class:"h-5 w-5"}),s(j);var C=r(j,2),K=l(C),B=l(K),Ve=l(B,!0);s(B),w(4),s(K);var Q=r(K,2),U=l(Q),Pe=l(U,!0);s(U);var Ee=r(U,2);{var Oe=o=>{ut(o,{variant:"success",size:"sm",children:(v,m)=>{w();var n=ue("Active");d(v,n)},$$slots:{default:!0}})},Te=o=>{ut(o,{variant:"default",size:"sm",children:(v,m)=>{w();var n=ue("Paused");d(v,n)},$$slots:{default:!0}})};T(Ee,o=>{e(i).is_active?o(Oe):o(Te,!1)})}s(Q);var Re=r(Q,2);{var We=o=>{var v=$a(),m=r(l(v),2);fa(m,{class:"h-3 w-3"});var n=r(m,2),$=l(n,!0);s(n),s(v),ve(()=>E($,e(i).on_completion_sequence_name)),d(o,v)};T(Re,o=>{e(i).on_completion_sequence_name&&o(We)})}s(C);var Ae=r(C,2);{let o=q(()=>e(i).is_active?"secondary":"primary");A(Ae,{get type(){return e(o)},onclick:gt,children:(v,m)=>{var n=he(),$=f(n);{var H=L=>{var y=ya(),I=f(y);ua(I,{class:"mr-2 h-4 w-4"}),w(),d(L,y)},V=L=>{var y=qa(),I=f(y);ma(I,{class:"mr-2 h-4 w-4"}),w(),d(L,y)};T($,L=>{e(i).is_active?L(H):L(V,!1)})}d(v,n)},$$slots:{default:!0}})}s(J);var oe=r(J,2);{var Ge=o=>{ct(o,{type:"error",title:"Error",class:"mb-4",children:(v,m)=>{var n=wa(),$=l(n,!0);s(n),ve(()=>E($,e(b))),d(v,n)},$$slots:{default:!0}})};T(oe,o=>{e(b)&&o(Ge)})}var pe=r(oe,2);vt(pe,{class:"mb-6",children:(o,v)=>{var m=Pa(),n=r(f(m),2),$=l(n),H=r(l($),2);et(H,{id:"seq-name",type:"text",get value(){return e(O)},set value(x){t(O,x,!0)}}),s($);var V=r($,2),L=r(l(V),2);tt(L,{id:"seq-trigger",options:[{value:"signup",label:"On signup"},{value:"manual",label:"Manual enrollment"}],get value(){return e(re)},set value(x){t(re,x,!0)}}),s(V),s(n);var y=r(n,2),I=r(l(y),4);{let x=q(()=>e(rt).map(g=>({value:String(g.id),label:g.name})));tt(I,{id:"seq-list",get options(){return e(x)},get value(){return e(F)},set value(g){t(F,g,!0)}})}s(y);var _e=r(y,2),je=r(l(_e),4);{let x=q(()=>[{value:"",label:"None (do nothing)"},...e(st).map(g=>({value:g.id,label:g.name}))]);tt(je,{id:"seq-on-completion",get options(){return e(x)},get value(){return e(se)},set value(g){t(se,g,!0)}})}s(_e);var ne=r(_e,2),de=l(ne);{let x=q(()=>e(ye)||e(O)===e(i).name&&e(re)===e(i).trigger_event&&e(F)===(e(i).list_id||e(z))&&e(se)===(e(i).on_completion_sequence_id||""));A(de,{type:"primary",onclick:_t,get disabled(){return e(x)},children:(g,ge)=>{var Z=he(),Ce=f(Z);{var Qe=D=>{var xe=ue("Saving...");d(D,xe)},ee=D=>{var xe=he(),At=f(xe);{var kt=ce=>{var Ue=ue("Saved!");d(ce,Ue)},jt=ce=>{var Ue=ue("Save Changes");d(ce,Ue)};T(At,ce=>{e(qe)?ce(kt):ce(jt,!1)},!0)}d(D,xe)};T(Ce,D=>{e(ye)?D(Qe):D(ee,!1)})}d(g,Z)},$$slots:{default:!0}})}var Ke=r(de,2);A(Ke,{type:"danger",onclick:()=>t(Se,!0),children:(x,g)=>{var ge=Sa(),Z=f(ge);mt(Z,{class:"mr-2 h-4 w-4"}),w(),d(x,ge)},$$slots:{default:!0}}),s(ne),d(o,m)},$$slots:{default:!0}});var Y=r(pe,2),Xe=r(l(Y),2);A(Xe,{type:"primary",onclick:it,children:(o,v)=>{var m=Ea(),n=f(m);ft(n,{class:"mr-2 h-4 w-4"}),w(),d(o,m)},$$slots:{default:!0}}),s(Y);var Je=r(Y,2);{var _=o=>{oa(o,{get icon(){return pa},title:"No emails yet",description:"Add your first email to this autoresponder sequence.",children:(v,m)=>{A(v,{type:"primary",onclick:it,children:(n,$)=>{var H=Ta(),V=f(H);ft(V,{class:"mr-2 h-4 w-4"}),w(),d(n,H)},$$slots:{default:!0}})},$$slots:{default:!0}})},ke=o=>{var v=ka();Ht(v,21,()=>e(ae),Vt,(m,n,$)=>{{let H=q(()=>e(n).is_active?"":"opacity-60");vt(m,{get class(){return`flex items-center gap-4 ${e(H)??""}`},children:(V,L)=>{var y=Aa(),I=f(y),_e=l(I);xa(_e,{class:"h-5 w-5"}),s(I);var je=r(I,2);je.textContent=$+1;var ne=r(je,2),de=l(ne),Ke=l(de,!0);s(de);var x=r(de,2),g=l(x);_a(g,{class:"h-3 w-3"});var ge=r(g);s(x),s(ne);var Z=r(ne,2),Ce=l(Z);A(Ce,{type:"ghost",size:"sm",onclick:()=>xt(e(n)),children:(ee,D)=>{ga(ee,{class:"h-4 w-4"})},$$slots:{default:!0}});var Qe=r(Ce,2);{let ee=q(()=>e(Ne)===e(n).id);A(Qe,{type:"ghost",size:"sm",onclick:()=>bt(e(n).id),get disabled(){return e(ee)},class:"text-error hover:bg-error/10",children:(D,xe)=>{mt(D,{class:"h-4 w-4"})},$$slots:{default:!0}})}s(Z),ve(ee=>{E(Ke,e(n).subject),E(ge,` ${ee??""}`)},[()=>qt(e(n).delay_hours)]),d(V,y)},$$slots:{default:!0}})}}),s(v),d(o,v)};T(Je,o=>{e(ae).length===0?o(_):o(ke,!1)})}ve(()=>{Bt(j,"href",`${e(te)??""}/lists/${e(z)??""}/autoresponders`),E(Ve,e(at)?.name),E(Pe,e(i).name)}),d(P,X)};T(h,P=>{e(i)?P(k,!1):P(G)},!0)}d(a,u)};T(wt,a=>{e(ze)?a(St):a(Pt,!1)})}s(He);var nt=r(He,2);{var Et=a=>{var u=Ia(),h=l(u),G=l(h),k=l(G),P=l(k,!0);s(k);var X=r(k,2),J=l(X);A(J,{type:"secondary",onclick:()=>t(fe,!1),children:(_,ke)=>{var o=Ca(),v=f(o);sa(v,{class:"mr-2 h-4 w-4"}),w(),d(_,o)},$$slots:{default:!0}});var j=r(J,2);{let _=q(()=>e(we)||!e(M).trim());A(j,{type:"primary",onclick:ht,get disabled(){return e(_)},children:(ke,o)=>{var v=La(),m=f(v);da(m,{class:"mr-2 h-4 w-4"});var n=r(m);ve(()=>E(n,` ${e(we)?"Saving...":e(Fe)?"Saved!":"Save & Close"}`)),d(ke,v)},$$slots:{default:!0}})}s(X),s(G);var ie=r(G,2),C=l(ie),K=l(C),B=l(K),Ve=r(l(B),2);et(Ve,{id:"email-subject",type:"text",placeholder:"Welcome to our newsletter!",get value(){return e(M)},set value(_){t(M,_,!0)}}),s(B);var Q=r(B,2),U=r(l(Q),2),Pe=l(U);et(Pe,{id:"email-delay",type:"number",min:0,class:"w-24",get value(){return e(N)},set value(_){t(N,_,!0)}});var Ee=r(Pe,2),Oe=l(Ee);s(Ee),s(U);var Te=r(U,2),Re=l(Te,!0);s(Te),s(Q);var We=r(Q,4);la(We,{get variables(){return pt},get insertVariable(){return e(lt)}}),s(K),s(C);var Ae=r(C,2),oe=l(Ae),Ge=l(oe);ia(Ge,{placeholder:"Write your sequence email content...",showVariableInserts:!1,onInsertVariable:_=>t(lt,_,!0),class:"h-full",get value(){return e(R)},set value(_){t(R,_,!0)}}),s(oe);var pe=r(oe,2),Y=l(pe),Xe=r(l(Y),2);Xe.__click=yt,s(Y);var Je=r(Y,2);ca(Je,{id:"email-plaintext",placeholder:"Plain text version of this email",rows:4,get value(){return e(W)},set value(_){t(W,_,!0)}}),w(2),s(pe),s(Ae),s(ie),s(h),s(u),ve(()=>{E(P,e(le)?"Edit Sequence Email":"Add Sequence Email"),E(Oe,`hours after ${e(ae).length===0&&!e(le)?"signup":"previous email"}`),E(Re,e(N)===0?"Sends immediately":`Waits ${e(N)} hours`)}),d(a,u)};T(nt,a=>{e(fe)&&a(Et)})}var Tt=r(nt,2);{let a=q(()=>`Are you sure you want to delete "${e(i)?.name}"? This will delete all emails in this sequence. This action cannot be undone.`),u=q(()=>e(Me)?"Deleting...":"Delete");ra(Tt,{title:"Delete Autoresponder",get description(){return e(a)},get actionLabel(){return e(u)},actionType:"danger",onAction:$t,onCancel:()=>t(Se,!1),get open(){return e(Se)},set open(h){t(Se,h,!0)}})}d(Le,ot),It(),De()}Ft(["click"]);export{or as component};
