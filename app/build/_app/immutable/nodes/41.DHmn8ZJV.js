import"../chunks/DsnmJJEf.js";import{f as C,p as He,c as o,r,t as D,i as e,j as se,d as Je,s as R,a as Me,u as ht,b as i,h as l,n as w,m as bt}from"../chunks/DDjrJUyi.js";import{s as x}from"../chunks/CwHIudaz.js";import{c as K,a as s,f as u,t as A}from"../chunks/DbkN8AN9.js";import{l as Ke,s as Qe,p as me,i as E}from"../chunks/CGvWOYBA.js";import{a as gt,c as $t,e as he,i as be,s as yt}from"../chunks/aSjiVL0V.js";import{an as xt,ao as kt,ap as wt,aq as Ct,ar as Pt,as as zt}from"../chunks/yWEY6ChK.js";import{a as Ze,s as et,B as N,M as Re,I as Be,c as Ie,A as De,g as St,e as Wt,X as Et,C as qe,E as Ve}from"../chunks/DkmOYVX9.js";import{L as Xe}from"../chunks/BWhLmYGf.js";import{s as Lt}from"../chunks/X2O9fsyW.js";import{B as ge}from"../chunks/42UF-HRp.js";import{P as Ye}from"../chunks/D07NXJ8f.js";import{R as Ft}from"../chunks/Di8xpufM.js";import"../chunks/BrWG_zvm.js";import{T as Mt}from"../chunks/DQqcPUXs.js";function Rt(Q,k){const V=Ke(k,["children","$$slots","$$events","$$legacy"]);const P=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143"}],["path",{d:"m2 2 20 20"}]];Ze(Q,Qe({name:"eye-off"},()=>V,{get iconNode(){return P},children:(X,U)=>{var T=K(),j=C(T);et(j,k,"default",{}),s(X,T)},$$slots:{default:!0}}))}function Dt(Q,k){const V=Ke(k,["children","$$slots","$$events","$$legacy"]);const P=[["path",{d:"M14.5 2v17.5c0 1.4-1.1 2.5-2.5 2.5c-1.4 0-2.5-1.1-2.5-2.5V2"}],["path",{d:"M8.5 2h7"}],["path",{d:"M14.5 16h-5"}]];Ze(Q,Qe({name:"test-tube"},()=>V,{get iconNode(){return P},children:(X,U)=>{var T=K(),j=C(T);et(j,k,"default",{}),s(X,T)},$$slots:{default:!0}}))}var Tt=u('<div class="overflow-x-auto rounded-lg bg-base-200"><table><!></table></div>');function Ge(Q,k){He(k,!0);let V=me(k,"zebra",3,!1),P=me(k,"pinRows",3,!1),X=me(k,"pinCols",3,!1),U=me(k,"size",3,"md"),T=me(k,"class",3,"");const j={xs:"table-xs",sm:"table-sm",md:"",lg:"table-lg"};let h=se(()=>`table ${j[U()]} ${V()?"table-zebra":""} ${P()?"table-pin-rows":""} ${X()?"table-pin-cols":""} ${T()}`.trim());var Z=Tt(),ve=o(Z),oe=o(ve);Lt(oe,()=>k.children),r(ve),r(Z),D(()=>gt(ve,1,$t(e(h)))),s(Q,Z),Je()}var At=u("<!> Add Webhook",1),Ot=u('<div class="flex justify-center py-12"><!></div>'),Nt=u("<!> Add Your First Webhook",1),Ut=u('<p class="text-text-muted">No webhooks configured yet.</p> <!>',1),jt=u('<tr><td class="font-mono text-sm max-w-xs truncate"> </td><td><div class="flex flex-wrap gap-1"><!> <!></div></td><td><!></td><td><div class="text-sm"><span class="text-green-600"> </span> <span class="text-text-muted">/</span> <span class="text-red-600"> </span></div></td><td class="text-sm text-text-muted"> </td><td><div class="flex items-center justify-end gap-2"><!> <!> <!> <!></div></td></tr>'),Bt=u('<thead><tr><th>URL</th><th>Events</th><th>Status</th><th>Deliveries</th><th>Last Delivery</th><th class="text-right">Actions</th></tr></thead> <tbody></tbody>',1),It=u('<p class="mt-1 text-sm"> </p>'),qt=u("<strong> </strong> <!> <!>",1),Vt=u('<div class="flex justify-end gap-3"><!> <!></div>'),Xt=u('<div><h4 class="text-sm font-medium text-text-muted mb-2"> </h4> <div class="space-y-2 pl-2"></div></div>'),Yt=u('<div class="space-y-4"><div><label class="form-label" for="webhook-url">Endpoint URL</label> <!></div> <div><label class="form-label">Events to Subscribe</label> <div class="mt-2 space-y-4 max-h-64 overflow-y-auto"></div></div> <div><!></div></div>'),Gt=u('<div class="space-y-4"><!> <div><label class="form-label">Signing Secret</label> <div class="flex gap-2"><!> <!></div> <p class="mt-2 text-sm text-text-muted">Use this secret to verify that webhook payloads are from Outlet. Check the <code>X-Webhook-Signature</code> header.</p></div></div>'),Ht=u('<div class="flex justify-center py-8"><!></div>'),Jt=u('<p class="text-center text-text-muted py-8">No delivery logs yet.</p>'),Kt=u('<span class="flex items-center gap-1 text-green-600"><!> </span>'),Qt=u('<span class="flex items-center gap-1 text-red-600"><!> Error</span>'),Zt=u('<span class="text-red-600"> </span>'),ea=u('<tr><td><!></td><td><!></td><td class="text-sm text-text-muted"> </td><td class="text-sm text-text-muted"> </td></tr>'),ta=u("<thead><tr><th>Event</th><th>Status</th><th>Duration</th><th>Time</th></tr></thead> <tbody></tbody>",1),aa=u('<div class="max-h-96 overflow-y-auto"><!></div>'),ra=u('<div class="space-y-6"><div class="flex items-center justify-between"><div><h2 class="text-lg font-medium text-text">Webhooks</h2> <p class="mt-1 text-sm text-text-muted">Receive real-time notifications when events happen in your account.</p></div> <!></div> <!> <!> <!></div> <!> <!> <!>',1);function ga(Q,k){He(k,!0);let V=R(!0),P=R(""),X=R(Me([])),U=R(!1),T=R(!1),j=R(!1),h=R(Me({url:"",events:[],active:!0})),Z=R(""),ve=R(""),oe=R(Me([])),we=R(!1),$e=R(null),O=R(null);const tt=[{value:"checkout.completed",label:"Checkout Completed",category:"Orders"},{value:"order.created",label:"Order Created",category:"Orders"},{value:"order.completed",label:"Order Completed",category:"Orders"},{value:"payment.succeeded",label:"Payment Succeeded",category:"Payments"},{value:"payment.failed",label:"Payment Failed",category:"Payments"},{value:"refund.created",label:"Refund Created",category:"Payments"},{value:"subscription.created",label:"Subscription Created",category:"Subscriptions"},{value:"subscription.updated",label:"Subscription Updated",category:"Subscriptions"},{value:"subscription.canceled",label:"Subscription Canceled",category:"Subscriptions"},{value:"subscription.renewed",label:"Subscription Renewed",category:"Subscriptions"},{value:"customer.created",label:"Customer Created",category:"Customers"},{value:"customer.updated",label:"Customer Updated",category:"Customers"},{value:"contact.created",label:"Contact Created",category:"Contacts"},{value:"contact.unsubscribed",label:"Contact Unsubscribed",category:"Contacts"},{value:"email.sent",label:"Email Sent",category:"Email"},{value:"email.bounced",label:"Email Bounced",category:"Email"},{value:"email.opened",label:"Email Opened",category:"Email"},{value:"email.clicked",label:"Email Clicked",category:"Email"}];let at=se(()=>()=>{const t={};for(const a of tt)t[a.category]||(t[a.category]=[]),t[a.category].push(a);return t});ht(()=>{ye()});async function ye(){i(V,!0),i(P,"");try{const t=await xt();i(X,t.webhooks||[],!0)}catch(t){console.error("Failed to load webhooks:",t),i(P,t.message||"Failed to load webhooks",!0)}finally{i(V,!1)}}async function rt(){if(!e(h).url||e(h).events.length===0){i(P,"URL and at least one event are required");return}try{const t=await kt({url:e(h).url,events:e(h).events,active:e(h).active});i(Z,t.secret,!0),i(U,!1),i(j,!0),i(h,{url:"",events:[],active:!0},!0),await ye()}catch(t){console.error("Failed to create webhook:",t),i(P,t.message||"Failed to create webhook",!0)}}async function st(t){try{await Pt({},{active:!t.active},t.id),await ye()}catch(a){console.error("Failed to update webhook:",a),i(P,a.message||"Failed to update webhook",!0)}}async function ot(t){if(confirm("Are you sure you want to delete this webhook?"))try{await zt({},t),await ye()}catch(a){console.error("Failed to delete webhook:",a),i(P,a.message||"Failed to delete webhook",!0)}}async function lt(t){i($e,t,!0),i(O,null);try{i(O,await Ct({},t),!0)}catch(a){console.error("Failed to test webhook:",a),i(O,{success:!1,status_code:0,error:a.message||"Test failed"},!0)}finally{i($e,null)}}async function it(t){i(ve,t,!0),i(we,!0),i(T,!0),i(oe,[],!0);try{const a=await wt({limit:50},t);i(oe,a.logs||[],!0)}catch(a){console.error("Failed to load webhook logs:",a)}finally{i(we,!1)}}function nt(t){e(h).events.indexOf(t)===-1?e(h).events=[...e(h).events,t]:e(h).events=e(h).events.filter(c=>c!==t)}function dt(){navigator.clipboard.writeText(e(Z))}function Te(t){return t?new Date(t).toLocaleString():"Never"}var Ae=ra(),Ce=C(Ae),Pe=o(Ce),ct=l(o(Pe),2);N(ct,{onclick:()=>i(U,!0),children:(t,a)=>{var c=At(),d=C(c);Ye(d,{size:16,class:"mr-2"}),w(),s(t,c)},$$slots:{default:!0}}),r(Pe);var Oe=l(Pe,2);{var vt=t=>{De(t,{variant:"error",children:(a,c)=>{w();var d=A();D(()=>x(d,e(P))),s(a,d)},$$slots:{default:!0}})};E(Oe,t=>{e(P)&&t(vt)})}var Ne=l(Oe,2);{var ut=t=>{var a=Ot(),c=o(a);Xe(c,{size:"lg"}),r(a),s(t,a)},ft=t=>{var a=K(),c=C(a);{var d=f=>{qe(f,{class:"py-12 text-center",children:($,p)=>{var b=Ut(),z=l(C(b),2);N(z,{class:"mt-4",onclick:()=>i(U,!0),children:(y,g)=>{var _=Nt(),n=C(_);Ye(n,{size:16,class:"mr-2"}),w(),s(y,_)},$$slots:{default:!0}}),s($,b)},$$slots:{default:!0}})},m=f=>{qe(f,{children:($,p)=>{Ge($,{children:(b,z)=>{var y=Bt(),g=l(C(y),2);he(g,21,()=>e(X),be,(_,n)=>{var ee=jt(),B=o(ee),le=o(B,!0);r(B);var H=l(B),J=o(H),ie=o(J);he(ie,17,()=>e(n).events.slice(0,2),be,(v,L)=>{ge(v,{variant:"secondary",class:"text-xs",children:(de,F)=>{w();var ce=A();D(()=>x(ce,e(L))),s(de,ce)},$$slots:{default:!0}})});var S=l(ie,2);{var te=v=>{ge(v,{variant:"secondary",class:"text-xs",children:(L,de)=>{w();var F=A();D(()=>x(F,`+${e(n).events.length-2} more`)),s(L,F)},$$slots:{default:!0}})};E(S,v=>{e(n).events.length>2&&v(te)})}r(J),r(H);var ae=l(H),ze=o(ae);{var ue=v=>{ge(v,{variant:"success",children:(L,de)=>{w();var F=A("Active");s(L,F)},$$slots:{default:!0}})},Se=v=>{ge(v,{variant:"secondary",children:(L,de)=>{w();var F=A("Inactive");s(L,F)},$$slots:{default:!0}})};E(ze,v=>{e(n).active?v(ue):v(Se,!1)})}r(ae);var fe=l(ae),xe=o(fe),re=o(xe),We=o(re,!0);r(re);var pe=l(re,4),Ee=o(pe,!0);r(pe),r(xe),r(fe);var W=l(fe),Y=o(W,!0);r(W);var I=l(W),ne=o(I),ke=o(ne);N(ke,{variant:"ghost",size:"sm",onclick:()=>it(e(n).id),title:"View Logs",children:(v,L)=>{Ve(v,{size:16})},$$slots:{default:!0}});var G=l(ke,2);{let v=se(()=>e($e)===e(n).id);N(G,{variant:"ghost",size:"sm",onclick:()=>lt(e(n).id),get disabled(){return e(v)},title:"Test Webhook",children:(L,de)=>{var F=K(),ce=C(F);{var Le=M=>{Ft(M,{size:16,class:"animate-spin"})},Fe=M=>{Dt(M,{size:16})};E(ce,M=>{e($e)===e(n).id?M(Le):M(Fe,!1)})}s(L,F)},$$slots:{default:!0}})}var q=l(G,2);{let v=se(()=>e(n).active?"Disable":"Enable");N(q,{variant:"ghost",size:"sm",onclick:()=>st(e(n)),get title(){return e(v)},children:(L,de)=>{var F=K(),ce=C(F);{var Le=M=>{Rt(M,{size:16})},Fe=M=>{Ve(M,{size:16})};E(ce,M=>{e(n).active?M(Le):M(Fe,!1)})}s(L,F)},$$slots:{default:!0}})}var _e=l(q,2);N(_e,{variant:"ghost",size:"sm",class:"text-red-600 hover:text-red-700",onclick:()=>ot(e(n).id),title:"Delete",children:(v,L)=>{Mt(v,{size:16})},$$slots:{default:!0}}),r(ne),r(I),r(ee),D(v=>{yt(B,"title",e(n).url),x(le,e(n).url),x(We,e(n).deliveries_success||0),x(Ee,e(n).deliveries_failed||0),x(Y,v)},[()=>Te(e(n).last_delivery_at)]),s(_,ee)}),r(g),s(b,y)},$$slots:{default:!0}})},$$slots:{default:!0}})};E(c,f=>{e(X).length===0?f(d):f(m,!1)},!0)}s(t,a)};E(Ne,t=>{e(V)?t(ut):t(ft,!1)})}var pt=l(Ne,2);{var _t=t=>{{let a=se(()=>e(O).success?"success":"error");De(t,{get variant(){return e(a)},dismissable:!0,onclose:()=>i(O,null),children:(c,d)=>{var m=qt(),f=C(m),$=o(f);r(f);var p=l(f,2);{var b=g=>{var _=A();D(()=>x(_,`- Status: ${e(O).status_code??""}`)),s(g,_)};E(p,g=>{e(O).status_code&&g(b)})}var z=l(p,2);{var y=g=>{var _=It(),n=o(_,!0);r(_),D(()=>x(n,e(O).error)),s(g,_)};E(z,g=>{e(O).error&&g(y)})}D(()=>x($,`Test ${e(O).success?"Successful":"Failed"}`)),s(c,m)},$$slots:{default:!0}})}};E(pt,t=>{e(O)&&t(_t)})}r(Ce);var Ue=l(Ce,2);Re(Ue,{title:"Add Webhook",get open(){return e(U)},set open(a){i(U,a,!0)},footer:a=>{var c=Vt(),d=o(c);N(d,{variant:"secondary",onclick:()=>i(U,!1),children:(f,$)=>{w();var p=A("Cancel");s(f,p)},$$slots:{default:!0}});var m=l(d,2);N(m,{onclick:rt,children:(f,$)=>{w();var p=A("Create Webhook");s(f,p)},$$slots:{default:!0}}),r(c),s(a,c)},children:(a,c)=>{var d=Yt(),m=o(d),f=l(o(m),2);Be(f,{id:"webhook-url",type:"url",placeholder:"https://your-server.com/webhook",get value(){return e(h).url},set value(y){e(h).url=y}}),r(m);var $=l(m,2),p=l(o($),2);he(p,21,()=>Object.entries(e(at)()),be,(y,g)=>{var _=se(()=>bt(e(g),2));let n=()=>e(_)[0],ee=()=>e(_)[1];var B=Xt(),le=o(B),H=o(le,!0);r(le);var J=l(le,2);he(J,21,ee,be,(ie,S)=>{{let te=se(()=>e(h).events.includes(e(S).value));Ie(ie,{get label(){return e(S).label},get checked(){return e(te)},onchange:()=>nt(e(S).value)})}}),r(J),r(B),D(()=>x(H,n())),s(y,B)}),r(p),r($);var b=l($,2),z=o(b);Ie(z,{label:"Active",get checked(){return e(h).active},set checked(y){e(h).active=y}}),r(b),r(d),s(a,d)},$$slots:{footer:!0,default:!0}});var je=l(Ue,2);Re(je,{title:"Webhook Created",get open(){return e(j)},set open(a){i(j,a,!0)},footer:a=>{N(a,{onclick:()=>i(j,!1),children:(c,d)=>{w();var m=A("Done");s(c,m)},$$slots:{default:!0}})},children:(a,c)=>{var d=Gt(),m=o(d);De(m,{variant:"warning",children:(z,y)=>{w();var g=A("Save this secret now. You won't be able to see it again.");s(z,g)},$$slots:{default:!0}});var f=l(m,2),$=l(o(f),2),p=o($);Be(p,{get value(){return e(Z)},readonly:!0,class:"font-mono text-sm"});var b=l(p,2);N(b,{variant:"secondary",onclick:dt,children:(z,y)=>{St(z,{size:16})},$$slots:{default:!0}}),r($),w(2),r(f),r(d),s(a,d)},$$slots:{footer:!0,default:!0}});var mt=l(je,2);Re(mt,{title:"Webhook Delivery Logs",size:"lg",get open(){return e(T)},set open(a){i(T,a,!0)},footer:a=>{N(a,{variant:"secondary",onclick:()=>i(T,!1),children:(c,d)=>{w();var m=A("Close");s(c,m)},$$slots:{default:!0}})},children:(a,c)=>{var d=K(),m=C(d);{var f=p=>{var b=Ht(),z=o(b);Xe(z,{}),r(b),s(p,b)},$=p=>{var b=K(),z=C(b);{var y=_=>{var n=Jt();s(_,n)},g=_=>{var n=aa(),ee=o(n);Ge(ee,{children:(B,le)=>{var H=ta(),J=l(C(H),2);he(J,21,()=>e(oe),be,(ie,S)=>{var te=ea(),ae=o(te),ze=o(ae);ge(ze,{variant:"secondary",children:(W,Y)=>{w();var I=A();D(()=>x(I,e(S).event)),s(W,I)},$$slots:{default:!0}}),r(ae);var ue=l(ae),Se=o(ue);{var fe=W=>{var Y=Kt(),I=o(Y);Wt(I,{size:14});var ne=l(I);r(Y),D(()=>x(ne,` ${e(S).status_code??""}`)),s(W,Y)},xe=W=>{var Y=K(),I=C(Y);{var ne=G=>{var q=Qt(),_e=o(q);Et(_e,{size:14}),w(),r(q),s(G,q)},ke=G=>{var q=Zt(),_e=o(q,!0);r(q),D(()=>x(_e,e(S).status_code)),s(G,q)};E(I,G=>{e(S).error?G(ne):G(ke,!1)},!0)}s(W,Y)};E(Se,W=>{e(S).status_code>=200&&e(S).status_code<300?W(fe):W(xe,!1)})}r(ue);var re=l(ue),We=o(re);r(re);var pe=l(re),Ee=o(pe,!0);r(pe),r(te),D(W=>{x(We,`${(e(S).duration||0)??""}ms`),x(Ee,W)},[()=>Te(e(S).delivered_at)]),s(ie,te)}),r(J),s(B,H)},$$slots:{default:!0}}),r(n),s(_,n)};E(z,_=>{e(oe).length===0?_(y):_(g,!1)},!0)}s(p,b)};E(m,p=>{e(we)?p(f):p($,!1)})}s(a,d)},$$slots:{footer:!0,default:!0}}),s(Q,Ae),Je()}export{ga as component};
