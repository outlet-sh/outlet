import"../chunks/DsnmJJEf.js";import{p as wt,s as p,a as $t,u as kt,b as a,i as e,f as D,d as Dt,j as S,m as St,h as i,g as Ct,c as s,r,t as G,n as g}from"../chunks/odI--4Kw.js";import{d as Ft,s as B}from"../chunks/BNMK9zrr.js";import{a as o,f as m,t as J,c as ge}from"../chunks/CCInJaqd.js";import{i as w}from"../chunks/COaB7F5h.js";import{e as Ye,i as It}from"../chunks/BohEjZuL.js";import{h as Nt}from"../chunks/hUjpWz_l.js";import{s as Pt,a as Tt}from"../chunks/DL1yFSKa.js";import{p as zt}from"../chunks/a5dDacmU.js";import{j as jt,S as Bt,T as Et,k as Vt,U as Rt,V as Mt}from"../chunks/ClaicyqD.js";import{g as At}from"../chunks/Bik22Hiu.js";import{g as Ut,A as Wt,C as Ie,I as Ne,h as Ge,B as Pe,f as Lt}from"../chunks/DYqP3J7w.js";import{L as Te}from"../chunks/D716f0vp.js";import{S as Kt}from"../chunks/CeRFu4qR.js";import{B as ze}from"../chunks/BD7k7D4N.js";import{M as qt}from"../chunks/n1YyAvGk.js";import{C as Je}from"../chunks/CMif_PaF.js";import{S as je}from"../chunks/INRhuqqX.js";import{R as Qe}from"../chunks/BOizboWA.js";import{T as Ht}from"../chunks/j_LCpJ0l.js";var Ot=m("<p> </p>"),Yt=m('<div class="flex items-center gap-2 text-green-600"><!> <span class="text-sm font-medium">Configured</span></div>'),Gt=m('<div class="flex items-center gap-2 text-text-muted"><!> <span class="text-sm">Using defaults</span></div>'),Jt=m(`<div class="card-header"><h2 class="card-title">Sender Identity</h2> <p class="card-subtitle">Configure how your emails appear to recipients</p></div> <div class="border border-border rounded-lg"><div class="p-4 flex items-center justify-between"><div class="flex items-center gap-4"><div class="w-12 h-12 bg-blue-100 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="card-section-title">Email Sender</h3> <p class="card-section-subtitle"><!></p></div></div> <div class="flex items-center gap-2"><!></div></div> <div class="border-t border-border p-4 bg-bg-secondary"><div class="space-y-4 max-w-lg"><div><label for="from-name" class="form-label">From Name</label> <!> <p class="mt-1 text-xs text-text-muted">The name shown in the recipient's inbox</p></div> <div><label for="from-email" class="form-label">From Email</label> <!> <p class="mt-1 text-xs text-text-muted">Must be a verified email address with your email provider</p></div> <div><label for="reply-to" class="form-label">Reply-To Email</label> <!> <p class="mt-1 text-xs text-text-muted">Where replies will be sent (optional, defaults to From Email)</p></div> <div class="flex justify-end gap-3 pt-2"><!></div></div></div></div>`,1),Qt=m("<!> <span>Setting up...</span>",1),Xt=m("<!> <span>Verify Domain</span>",1),Zt=m('<div class="border border-border rounded-lg p-6 text-center"><div class="w-12 h-12 mx-auto bg-base-200 rounded-lg flex items-center justify-center mb-4"><!></div> <h3 class="text-base font-medium mb-2">No domains configured</h3> <p class="text-sm text-base-content/60 mb-4"><!></p> <!></div>'),ea=m("<!> <span>Checking...</span>",1),ta=m("<!> <span>Refresh</span>",1),aa=m('<tr><td><!></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all"> </code></td><td><code class="text-xs bg-base-200 px-2 py-1 rounded break-all max-w-xs block overflow-hidden text-ellipsis"> </code></td><td><span class="text-xs text-base-content/60 capitalize"> </span></td><td><button class="btn btn-ghost btn-xs" title="Copy value"><!></button></td></tr>'),ra=m('<div class="p-4"><div class="flex items-center gap-2 mb-3"><!> <span class="text-sm font-medium">Add these DNS records to your domain</span></div> <div class="overflow-x-auto"><table class="table table-sm w-full"><thead><tr><th class="text-xs font-medium text-base-content/60 uppercase">Type</th><th class="text-xs font-medium text-base-content/60 uppercase">Name/Host</th><th class="text-xs font-medium text-base-content/60 uppercase">Value</th><th class="text-xs font-medium text-base-content/60 uppercase">Purpose</th><th class="w-10"></th></tr></thead><tbody></tbody></table></div> <div class="mt-4 p-3 bg-info/10 rounded-lg"><p class="text-xs text-info"><strong>Note:</strong> DNS changes can take up to 72 hours to propagate. Click "Refresh" to check verification status.</p></div></div>'),sa=m('<div class="border border-border rounded-lg overflow-hidden mb-4 last:mb-0"><div class="p-4 flex items-center justify-between bg-base-200/50"><div class="flex items-center gap-3"><div class="w-10 h-10 bg-primary/10 rounded-lg flex items-center justify-center"><!></div> <div><h3 class="font-medium"> </h3> <div class="flex items-center gap-2 mt-1"><span class="text-xs text-base-content/60">Verification:</span> <!> <span class="text-xs text-base-content/60 ml-2">DKIM:</span> <!></div></div></div> <div class="flex items-center gap-2"><!> <!></div></div> <!></div>'),ia=m('<div class="card-header"><h2 class="card-title">Domain Verification</h2> <p class="card-subtitle">Verify your domain to improve email deliverability and enable DKIM signing</p></div> <!>',1),oa=m(`<div class="flex items-start gap-4"><div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center flex-shrink-0"><svg class="h-5 w-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg></div> <div><h3 class="card-title">How it works</h3> <p class="card-subtitle">These settings are used as defaults for all emails sent from this brand, including campaigns, sequences, and transactional emails.
						You can override these settings on a per-campaign or per-sequence basis.</p></div></div>`),la=m('<div class="space-y-6"><!> <!> <!></div>'),na=m("<!> <!> <!>",1);function Na(Xe,Ze){wt(Ze,!0);const et=()=>Tt(zt,"$page",tt),[tt,at]=Pt();let Be=S(()=>et().params.brandSlug),me=p(!0),he=p(!1),ue=p(!1),l=p(null),h=p(""),b=p($t([])),ie=p(null),fe=p(!1),be=p(null),Q=p(null),pe=p(!1),E=p(null),oe=p(""),K=p(""),le=p(""),xe=null;kt(()=>(ye(),()=>{xe&&xe()}));function rt(t){const d=At();d.isConnected()||d.connect(),d.send("subscribe",{org_id:t});const V=d.on("domain_identity_update",x=>{console.log("[WebSocket] Domain identity update received:",x),a(b,e(b).map(T=>T.id===x.id?{...T,verification_status:x.verification_status,dkim_status:x.dkim_status,mail_from_status:x.mail_from_status,last_checked_at:x.last_checked_at}:T),!0)}),R=d.on("domain_identity_created",x=>{console.log("[WebSocket] Domain identity created:",x),ye()});xe=()=>{V(),R()}}async function ye(){a(me,!0),a(h,"");try{if(!e(Be)){a(h,"No brand selected"),a(me,!1);return}a(l,await jt({},e(Be)),!0),rt(e(l).id),a(oe,e(l).from_name||"",!0),a(K,e(l).from_email||"",!0),a(le,e(l).reply_to||"",!0);try{const t=await Bt({},e(l).id);a(b,t.identities||[],!0)}catch(t){console.error("Failed to load domain identities:",t),a(b,[],!0)}}catch(t){console.error("Failed to load data:",t),a(h,t.message||"Failed to load data",!0)}finally{a(me,!1)}}async function st(){if(e(l)){a(fe,!0),a(h,"");try{const t=await Mt({},{domain:""},e(l).id);a(b,[...e(b),t],!0)}catch(t){console.error("Failed to create domain identity:",t),a(h,t.message||"Failed to create domain identity",!0)}finally{a(fe,!1)}}}async function it(t){if(e(l)){a(ie,t,!0),a(h,"");try{const d=await Rt({},e(l).id,t);a(b,e(b).map(V=>V.id===t?d:V),!0)}catch(d){console.error("Failed to refresh domain identity:",d),a(h,d.message||"Failed to refresh domain identity",!0)}finally{a(ie,null)}}}function ot(t){a(E,t,!0),a(pe,!0)}async function lt(){if(!(!e(l)||!e(E))){a(Q,e(E).id,!0),a(h,"");try{await Et({},e(l).id,e(E).id),a(b,e(b).filter(t=>t.id!==e(E).id),!0),a(E,null),a(pe,!1)}catch(t){console.error("Failed to delete domain identity:",t),a(h,t.message||"Failed to delete domain identity",!0)}finally{a(Q,null)}}}function nt(t,d){navigator.clipboard.writeText(t),a(be,d,!0),setTimeout(()=>{a(be,null)},2e3)}function Ee(t){switch(t){case"Success":case"success":return{variant:"success",label:"Verified"};case"Pending":case"pending":return{variant:"warning",label:"Pending"};case"Failed":case"failed":case"temporary_failure":return{variant:"error",label:"Failed"};case"not_started":case"NotStarted":return{variant:"default",label:"Not Started"};default:return{variant:"default",label:t||"Unknown"}}}async function dt(){if(e(l)){a(he,!0),a(ue,!1),a(h,"");try{await Vt({},{from_name:e(oe)||void 0,from_email:e(K)||void 0,reply_to:e(le)||void 0},e(l).id),a(ue,!0),setTimeout(()=>{a(ue,!1)},2e3),await ye()}catch(t){console.error("Failed to save email settings:",t),a(h,t.message||"Failed to save email settings",!0)}finally{a(he,!1)}}}let ct=S(()=>e(l)&&(e(oe)!==(e(l).from_name||"")||e(K)!==(e(l).from_email||"")||e(le)!==(e(l).reply_to||""))),Ve=S(()=>e(l)?.from_name||e(l)?.from_email);var Re=na();Nt("1fr6do4",t=>{St(()=>{Ct.title=`Email Settings - ${(e(l)?.name||"Loading")??""}`})});var Me=D(Re);{var vt=t=>{Wt(t,{type:"error",title:"Error",children:(d,V)=>{var R=Ot(),x=s(R,!0);r(R),G(()=>B(x,e(h))),o(d,R)},$$slots:{default:!0}})};w(Me,t=>{e(h)&&t(vt)})}var Ae=i(Me,2);{var mt=t=>{Te(t,{size:"large"})},ut=t=>{var d=la(),V=s(d);Ie(V,{children:(T,Ue)=>{var q=Jt(),_e=i(D(q),2),ne=s(_e),de=s(ne),C=s(de),M=s(C);qt(M,{class:"h-6 w-6 text-blue-600"}),r(C);var A=i(C,2),U=i(s(A),2),c=s(U);{var X=n=>{var _=J();G(()=>B(_,`${(e(l)?.from_name||"No name")??""} <${(e(l)?.from_email||"No email")??""}>`)),o(n,_)},Z=n=>{var _=J("Not configured - using platform defaults");o(n,_)};w(c,n=>{e(Ve)?n(X):n(Z,!1)})}r(U),r(A),r(de);var W=i(de,2),H=s(W);{var O=n=>{var _=Yt(),u=s(_);Ge(u,{class:"h-5 w-5"}),g(2),r(_),o(n,_)},v=n=>{var _=Gt(),u=s(_);Je(u,{class:"h-5 w-5"}),g(2),r(_),o(n,_)};w(H,n=>{e(Ve)?n(O):n(v,!1)})}r(W),r(ne);var F=i(ne,2),ee=s(F),I=s(ee),ce=i(s(I),2);Ne(ce,{id:"from-name",type:"text",placeholder:"Acme Inc",get value(){return e(oe)},set value(n){a(oe,n,!0)}}),g(2),r(I);var L=i(I,2),te=i(s(L),2);Ne(te,{id:"from-email",type:"email",placeholder:"hello@yourdomain.com",get value(){return e(K)},set value(n){a(K,n,!0)}}),g(2),r(L);var y=i(L,2),N=i(s(y),2);Ne(N,{id:"reply-to",type:"email",placeholder:"support@yourdomain.com",get value(){return e(le)},set value(n){a(le,n,!0)}}),g(2),r(y);var z=i(y,2),we=s(z);{let n=S(()=>!e(ct));Kt(we,{label:"Save Settings",get saving(){return e(he)},get saved(){return e(ue)},onclick:dt,get disabled(){return e(n)}})}r(z),r(ee),r(F),r(_e),o(T,q)},$$slots:{default:!0}});var R=i(V,2);Ie(R,{children:(T,Ue)=>{var q=ia(),_e=i(D(q),2);{var ne=C=>{var M=Zt(),A=s(M),U=s(A);je(U,{class:"h-6 w-6 text-base-content/50"}),r(A);var c=i(A,4),X=s(c);{var Z=v=>{var F=J("Set your From Email above first, then verify your domain.");o(v,F)},W=v=>{var F=J("Verify your domain to authenticate emails and improve deliverability.");o(v,F)};w(X,v=>{e(K)?v(W,!1):v(Z)})}r(c);var H=i(c,2);{var O=v=>{Pe(v,{variant:"primary",onclick:st,get disabled(){return e(fe)},children:(F,ee)=>{var I=ge(),ce=D(I);{var L=y=>{var N=Qt(),z=D(N);Te(z,{size:"normal"}),g(2),o(y,N)},te=y=>{var N=Xt(),z=D(N);je(z,{class:"h-4 w-4"}),g(2),o(y,N)};w(ce,y=>{e(fe)?y(L):y(te,!1)})}o(F,I)},$$slots:{default:!0}})};w(H,v=>{e(K)&&v(O)})}r(M),o(C,M)},de=C=>{var M=ge(),A=D(M);Ye(A,17,()=>e(b),U=>U.id,(U,c)=>{const X=S(()=>Ee(e(c).verification_status)),Z=S(()=>Ee(e(c).dkim_status));var W=sa(),H=s(W),O=s(H),v=s(O),F=s(v);je(F,{class:"h-5 w-5 text-primary"}),r(v);var ee=i(v,2),I=s(ee),ce=s(I,!0);r(I);var L=i(I,2),te=i(s(L),2);ze(te,{get variant(){return e(X).variant},size:"sm",children:(u,j)=>{g();var $=J();G(()=>B($,e(X).label)),o(u,$)},$$slots:{default:!0}});var y=i(te,4);ze(y,{get variant(){return e(Z).variant},size:"sm",children:(u,j)=>{g();var $=J();G(()=>B($,e(Z).label)),o(u,$)},$$slots:{default:!0}}),r(L),r(ee),r(O);var N=i(O,2),z=s(N);{let u=S(()=>e(ie)!==null||e(Q)!==null);Pe(z,{variant:"ghost",size:"sm",onclick:()=>it(e(c).id),get disabled(){return e(u)},children:(j,$)=>{var Y=ge(),ae=D(Y);{var re=f=>{var k=ea(),ve=D(k);Qe(ve,{class:"h-4 w-4 animate-spin"}),g(2),o(f,k)},se=f=>{var k=ta(),ve=D(k);Qe(ve,{class:"h-4 w-4"}),g(2),o(f,k)};w(ae,f=>{e(ie)===e(c).id?f(re):f(se,!1)})}o(j,Y)},$$slots:{default:!0}})}var we=i(z,2);{let u=S(()=>e(ie)!==null||e(Q)!==null);Pe(we,{variant:"ghost",size:"sm",onclick:()=>ot(e(c)),get disabled(){return e(u)},children:(j,$)=>{var Y=ge(),ae=D(Y);{var re=f=>{Te(f,{size:"normal"})},se=f=>{Ht(f,{class:"h-4 w-4 text-error"})};w(ae,f=>{e(Q)===e(c).id?f(re):f(se,!1)})}o(j,Y)},$$slots:{default:!0}})}r(N),r(H);var n=i(H,2);{var _=u=>{var j=ra(),$=s(j),Y=s($);Je(Y,{class:"h-4 w-4 text-warning"}),g(2),r($);var ae=i($,2),re=s(ae),se=i(s(re));Ye(se,21,()=>e(c).dns_records,It,(f,k,ve)=>{const We=S(()=>`${e(c).id}-${ve}`);var $e=aa(),ke=s($e),pt=s(ke);ze(pt,{variant:"default",size:"sm",children:(P,da)=>{g();var Oe=J();G(()=>B(Oe,e(k).type)),o(P,Oe)},$$slots:{default:!0}}),r(ke);var De=i(ke),Le=s(De),_t=s(Le,!0);r(Le),r(De);var Se=i(De),Ke=s(Se),gt=s(Ke,!0);r(Ke),r(Se);var Ce=i(Se),qe=s(Ce),ht=s(qe,!0);r(qe),r(Ce);var He=i(Ce),Fe=s(He);Fe.__click=()=>nt(e(k).value,e(We));var bt=s(Fe);{var xt=P=>{Ge(P,{class:"h-3 w-3 text-success"})},yt=P=>{Lt(P,{class:"h-3 w-3"})};w(bt,P=>{e(be)===e(We)?P(xt):P(yt,!1)})}r(Fe),r(He),r($e),G(P=>{B(_t,e(k).name),B(gt,e(k).value),B(ht,P)},[()=>e(k).purpose.replace(/_/g," ")]),o(f,$e)}),r(se),r(re),r(ae),g(2),r(j),o(u,j)};w(n,u=>{e(c).dns_records&&e(c).dns_records.length>0&&u(_)})}r(W),G(()=>B(ce,e(c).domain)),o(U,W)}),o(C,M)};w(_e,C=>{e(b).length===0?C(ne):C(de,!1)})}o(T,q)},$$slots:{default:!0}});var x=i(R,2);Ie(x,{children:(T,Ue)=>{var q=oa();o(T,q)},$$slots:{default:!0}}),r(d),o(t,d)};w(Ae,t=>{e(me)?t(mt):t(ut,!1)})}var ft=i(Ae,2);{let t=S(()=>e(E)?.domain),d=S(()=>e(Q)!==null);Ut(ft,{get open(){return e(pe)},onclose:()=>{a(pe,!1),a(E,null)},title:"Delete Domain Identity",get description(){return`Are you sure you want to delete the domain identity for ${e(t)??""}? You will need to set up DNS records again if you want to verify this domain later.`},confirmLabel:"Delete",confirmVariant:"error",onconfirm:lt,get loading(){return e(d)}})}o(Xe,Re),Dt(),at()}Ft(["click"]);export{Na as component};
