import"../chunks/DsnmJJEf.js";import{p as Me,s as p,a as Ne,u as Be,b as r,f as D,d as Oe,i as e,h as o,c as s,n as b,t as B,j as x,r as a}from"../chunks/odI--4Kw.js";import{s as O}from"../chunks/BNMK9zrr.js";import{a as n,f as h,t as T,c as We}from"../chunks/CCInJaqd.js";import{i as W}from"../chunks/COaB7F5h.js";import{e as Ge,s as He,a as Je,i as Ke}from"../chunks/BohEjZuL.js";import{s as Qe,a as Re}from"../chunks/DL1yFSKa.js";import{p as Ue}from"../chunks/Wl_A6iPG.js";import{g as Ve}from"../chunks/J_BT3AZT.js";import{E as Xe,F as Ye,G as Ze,H as et}from"../chunks/CbJUEE85.js";import{B as G,M as tt,g as rt,I as ve,S as at,l as st,A as lt,D as ot}from"../chunks/CKHj2K0U.js";import{E as it}from"../chunks/CF2FnicU.js";import{L as nt}from"../chunks/D716f0vp.js";import{B as X}from"../chunks/BD7k7D4N.js";import{g as dt}from"../chunks/B5W8Y6hm.js";import{P as pe}from"../chunks/vPkRyia_.js";import{W as fe}from"../chunks/q43YW3x0.js";import{E as ut}from"../chunks/D9RG3a0A.js";import{S as ct}from"../chunks/CW92f3Ai.js";import{P as vt,a as pt}from"../chunks/KpCsfZLx.js";import{T as ft}from"../chunks/Cu0Q0NU6.js";var mt=h("<p> </p>"),gt=h("<!> New Autoresponder",1),_t=h('<div class="flex justify-center py-12"><!></div>'),ht=h("<!> Create Autoresponder",1),$t=h('<tr><td><a class="block group"><div class="flex items-center gap-3"><div><!></div> <div><span class="font-medium text-text group-hover:text-primary transition-colors"> </span></div></div></a></td><td><!></td><td class="text-center"><!></td><td class="text-right"><!></td></tr>'),bt=h('<div class="data-table"><table class="w-full"><thead><tr><th class="text-left">Autoresponder</th><th class="text-left">Trigger</th><th class="text-center">Status</th><th class="text-right w-10"></th></tr></thead><tbody></tbody></table></div>'),xt=h("<!> <!>",1),yt=h('<div class="space-y-4"><div><label for="seq-name" class="form-label">Name</label> <!></div> <div><label for="seq-slug" class="form-label">Slug</label> <!></div> <div><label for="seq-trigger" class="form-label">Trigger</label> <!></div> <div class="flex items-center gap-3"><!> <span class="text-sm text-text">Active</span></div></div>'),St=h('<!> <div class="flex justify-between items-center mb-4"><p class="text-sm text-text-muted">Automated email sequences triggered when subscribers join this list.</p> <!></div> <!> <!> <!>',1);function Jt(me,ge){Me(ge,!0);const Y=()=>Re(Ue,"$page",_e),[_e,he]=Qe();dt();let L=x(()=>Y().params.id),Z=x(()=>`/${Y().params.brandSlug}`),ee=p(Ne([])),H=p(!0),q=p(!1),C=p(!1),y=p(""),S=p(""),E=p("signup"),J=p(!0),P=p(""),te=x(()=>e(ee).filter(t=>t.list_id===e(L)));Be(()=>{F()});async function F(){r(H,!0);try{const t=await Xe();r(ee,t.sequences||[],!0)}catch(t){console.error("Failed to load sequences:",t)}finally{r(H,!1)}}function $e(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function be(){r(S,$e(e(y)),!0)}function re(){r(y,""),r(S,""),r(E,"signup"),r(J,!0),r(q,!0)}async function xe(){if(!(!e(y)||!e(S))){r(C,!0),r(P,"");try{await Ze({name:e(y),slug:e(S),list_id:e(L),trigger_event:e(E),sequence_type:"lifecycle"}),r(q,!1),await F()}catch(t){r(P,t.message||"Failed to create autoresponder",!0)}finally{r(C,!1)}}}let j=p(!1),z=p(null),K=p(!1);function ye(t){r(z,t,!0),r(j,!0)}async function Se(){if(e(z)){r(K,!0);try{await Ye({},e(z).id),await F()}catch(t){r(P,t.message||"Failed to delete autoresponder",!0)}finally{r(K,!1)}}}async function we(t){try{await et({},{is_active:!t.is_active},t.id),await F()}catch(l){r(P,l.message||"Failed to update autoresponder",!0)}}function qe(t){switch(t){case"signup":return"On signup";case"purchase":return"On purchase";case"tag_added":return"Tag added";case"manual":return"Manual";default:return t}}var ae=St(),se=D(ae);{var Pe=t=>{lt(t,{type:"error",title:"Error",class:"mb-4",children:(l,u)=>{var d=mt(),_=s(d,!0);a(d),B(()=>O(_,e(P))),n(l,d)},$$slots:{default:!0}})};W(se,t=>{e(P)&&t(Pe)})}var Q=o(se,2),Ae=o(s(Q),2);G(Ae,{type:"primary",onclick:re,get disabled(){return e(q)},children:(t,l)=>{var u=gt(),d=D(u);pe(d,{class:"mr-2 h-4 w-4"}),b(),n(t,u)},$$slots:{default:!0}}),a(Q);var le=o(Q,2);{var Ce=t=>{var l=_t(),u=s(l);nt(u,{}),a(l),n(t,l)},ke=t=>{var l=We(),u=D(l);{var d=c=>{it(c,{get icon(){return fe},title:"No autoresponders yet",description:"Create an autoresponder to automatically send emails when subscribers join this list.",children:(v,$)=>{G(v,{type:"primary",onclick:re,children:(f,I)=>{var i=ht(),w=D(i);pe(w,{class:"mr-2 h-4 w-4"}),b(),n(f,i)},$$slots:{default:!0}})},$$slots:{default:!0}})},_=c=>{var v=bt(),$=s(v),f=o(s($));Ge(f,21,()=>e(te),Ke,(I,i)=>{var w=$t(),m=s(w),R=s(m),ie=s(R),M=s(ie);let ne;var Te=s(M);fe(Te,{class:"h-4 w-4"}),a(M);var de=o(M,2),ue=s(de),Le=s(ue,!0);a(ue),a(de),a(ie),a(R),a(m);var U=o(m),Ee=s(U);X(Ee,{variant:"default",size:"sm",children:(g,A)=>{b();var N=T();B(k=>O(N,k),[()=>qe(e(i).trigger_event)]),n(g,N)},$$slots:{default:!0}}),a(U);var V=o(U),Fe=s(V);{var je=g=>{X(g,{variant:"success",size:"sm",children:(A,N)=>{b();var k=T("Active");n(A,k)},$$slots:{default:!0}})},ze=g=>{X(g,{variant:"default",size:"sm",children:(A,N)=>{b();var k=T("Paused");n(A,k)},$$slots:{default:!0}})};W(Fe,g=>{e(i).is_active?g(je):g(ze,!1)})}a(V);var ce=o(V),Ie=s(ce);{let g=x(()=>({icon:ut,class:"p-1.5 rounded-lg hover:bg-bg-secondary transition-colors text-text-muted hover:text-text"})),A=x(()=>[{label:"Edit",icon:ct,onclick:()=>Ve(`${e(Z)}/lists/${e(L)}/autoresponders/${e(i).id}`)},{label:e(i).is_active?"Pause":"Activate",icon:e(i).is_active?vt:pt,onclick:()=>we(e(i))},{divider:!0},{label:"Delete",icon:ft,variant:"danger",onclick:()=>ye(e(i))}]);ot(Ie,{get trigger(){return e(g)},get items(){return e(A)}})}a(ce),a(w),B(()=>{He(R,"href",`${e(Z)??""}/lists/${e(L)??""}/autoresponders/${e(i).id??""}`),ne=Je(M,1,"data-table-icon",null,ne,{active:e(i).is_active}),O(Le,e(i).name)}),n(I,w)}),a(f),a($),a(v),n(c,v)};W(u,c=>{e(te).length===0?c(d):c(_,!1)},!0)}n(t,l)};W(le,t=>{e(H)?t(Ce):t(ke,!1)})}var oe=o(le,2);tt(oe,{title:"Create Autoresponder",size:"md",get show(){return e(q)},set show(l){r(q,l,!0)},footer:l=>{var u=xt(),d=D(u);G(d,{type:"secondary",onclick:()=>r(q,!1),get disabled(){return e(C)},children:(c,v)=>{b();var $=T("Cancel");n(c,$)},$$slots:{default:!0}});var _=o(d,2);{let c=x(()=>!e(y)||!e(S)||e(C));G(_,{type:"primary",onclick:xe,get disabled(){return e(c)},children:(v,$)=>{b();var f=T();B(()=>O(f,e(C)?"Creating...":"Create")),n(v,f)},$$slots:{default:!0}})}n(l,u)},children:(l,u)=>{var d=yt(),_=s(d),c=o(s(_),2);ve(c,{id:"seq-name",type:"text",oninput:be,placeholder:"Welcome Series",get value(){return e(y)},set value(m){r(y,m,!0)}}),a(_);var v=o(_,2),$=o(s(v),2);ve($,{id:"seq-slug",type:"text",placeholder:"welcome-series",get value(){return e(S)},set value(m){r(S,m,!0)}}),a(v);var f=o(v,2),I=o(s(f),2);at(I,{id:"seq-trigger",options:[{value:"signup",label:"On signup"},{value:"manual",label:"Manual enrollment"}],get value(){return e(E)},set value(m){r(E,m,!0)}}),a(f);var i=o(f,2),w=s(i);st(w,{get checked(){return e(J)},set checked(m){r(J,m,!0)}}),b(2),a(i),a(d),n(l,d)},$$slots:{footer:!0,default:!0}});var De=o(oe,2);{let t=x(()=>`Delete "${e(z)?.name||""}"? This cannot be undone.`),l=x(()=>e(K)?"Deleting...":"Delete");rt(De,{title:"Delete Autoresponder",get description(){return e(t)},get actionLabel(){return e(l)},actionType:"danger",onAction:Se,onCancel:()=>r(j,!1),get open(){return e(j)},set open(u){r(j,u,!0)}})}n(me,ae),Oe(),he()}export{Jt as component};
