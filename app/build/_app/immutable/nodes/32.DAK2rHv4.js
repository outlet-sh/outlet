import"../chunks/DsnmJJEf.js";import{p as Me,s as p,a as Ne,u as Be,b as r,f as D,d as Oe,i as e,h as o,c as s,n as b,t as O,j as x,r as a}from"../chunks/odI--4Kw.js";import{s as W}from"../chunks/BNMK9zrr.js";import{a as n,f as h,t as T,c as We}from"../chunks/CCInJaqd.js";import{i as G}from"../chunks/COaB7F5h.js";import{e as Ge,s as He,a as Je,i as Ke}from"../chunks/BohEjZuL.js";import{s as Qe,a as Re}from"../chunks/DL1yFSKa.js";import{p as Ue}from"../chunks/CdFg3XMI.js";import{g as Ve}from"../chunks/BsbAhiR-.js";import{E as Xe,F as Ye,G as Ze,H as et}from"../chunks/CbJUEE85.js";import{B as H,M as tt,g as rt,I as ve,S as at,l as st,A as lt,D as ot}from"../chunks/DDAcQctE.js";import{E as it}from"../chunks/BtTFHV7Z.js";import{L as nt}from"../chunks/D716f0vp.js";import{B as X}from"../chunks/BD7k7D4N.js";import{g as dt}from"../chunks/B5W8Y6hm.js";import{P as pe}from"../chunks/iPsqwY4C.js";import{W as fe}from"../chunks/xFBtsWv8.js";import{E as ct}from"../chunks/BeVoPvU_.js";import{S as ut}from"../chunks/AEVXVjr0.js";import{P as vt,a as pt}from"../chunks/DPG57ny_.js";import{T as ft}from"../chunks/BzbtGsEE.js";var mt=h("<p> </p>"),gt=h("<!> New Autoresponder",1),_t=h('<div class="flex justify-center py-12"><!></div>'),ht=h("<!> Create Autoresponder",1),$t=h('<tr><td><a class="block group"><div class="flex items-center gap-3"><div><!></div> <div><span class="font-medium text-text group-hover:text-primary transition-colors"> </span></div></div></a></td><td><!></td><td class="text-center"><!></td><td class="text-right"><!></td></tr>'),bt=h('<div class="data-table"><table class="w-full"><thead><tr><th class="text-left">Autoresponder</th><th class="text-left">Trigger</th><th class="text-center">Status</th><th class="text-right w-10"></th></tr></thead><tbody></tbody></table></div>'),xt=h("<!> <!>",1),yt=h('<div class="space-y-4"><div><label for="seq-name" class="form-label">Name</label> <!></div> <div><label for="seq-slug" class="form-label">Slug</label> <!></div> <div><label for="seq-trigger" class="form-label">Trigger</label> <!></div> <div class="flex items-center gap-3"><!> <span class="text-sm text-text">Active</span></div></div>'),St=h('<!> <div class="flex justify-between items-center mb-4"><p class="text-sm text-text-muted">Automated email sequences triggered when subscribers join this list.</p> <!></div> <!> <!> <!>',1);function Jt(me,ge){Me(ge,!0);const Y=()=>Re(Ue,"$page",_e),[_e,he]=Qe();dt();let L=x(()=>Y().params.id),Z=x(()=>`/${Y().params.brandSlug}`),ee=p(Ne([])),J=p(!0),q=p(!1),C=p(!1),y=p(""),S=p(""),E=p("signup"),F=p(!0),P=p(""),te=x(()=>e(ee).filter(t=>t.list_id===e(L)));Be(()=>{j()});async function j(){r(J,!0);try{const t=await Xe();r(ee,t.sequences||[],!0)}catch(t){console.error("Failed to load sequences:",t)}finally{r(J,!1)}}function $e(t){return t.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-|-$/g,"")}function be(){r(S,$e(e(y)),!0)}function re(){r(y,""),r(S,""),r(E,"signup"),r(F,!0),r(q,!0)}async function xe(){if(!(!e(y)||!e(S))){r(C,!0),r(P,"");try{await Ze({name:e(y),slug:e(S),list_id:e(L),trigger_event:e(E),is_active:e(F),sequence_type:"lifecycle"}),r(q,!1),await j()}catch(t){r(P,t.message||"Failed to create autoresponder",!0)}finally{r(C,!1)}}}let z=p(!1),I=p(null),K=p(!1);function ye(t){r(I,t,!0),r(z,!0)}async function Se(){if(e(I)){r(K,!0);try{await Ye({},e(I).id),await j()}catch(t){r(P,t.message||"Failed to delete autoresponder",!0)}finally{r(K,!1)}}}async function we(t){try{await et({},{is_active:!t.is_active},t.id),await j()}catch(l){r(P,l.message||"Failed to update autoresponder",!0)}}function qe(t){switch(t){case"signup":return"On signup";case"purchase":return"On purchase";case"tag_added":return"Tag added";case"manual":return"Manual";default:return t}}var ae=St(),se=D(ae);{var Pe=t=>{lt(t,{type:"error",title:"Error",class:"mb-4",children:(l,c)=>{var d=mt(),_=s(d,!0);a(d),O(()=>W(_,e(P))),n(l,d)},$$slots:{default:!0}})};G(se,t=>{e(P)&&t(Pe)})}var Q=o(se,2),Ae=o(s(Q),2);H(Ae,{type:"primary",onclick:re,get disabled(){return e(q)},children:(t,l)=>{var c=gt(),d=D(c);pe(d,{class:"mr-2 h-4 w-4"}),b(),n(t,c)},$$slots:{default:!0}}),a(Q);var le=o(Q,2);{var Ce=t=>{var l=_t(),c=s(l);nt(c,{}),a(l),n(t,l)},ke=t=>{var l=We(),c=D(l);{var d=u=>{it(u,{get icon(){return fe},title:"No autoresponders yet",description:"Create an autoresponder to automatically send emails when subscribers join this list.",children:(v,$)=>{H(v,{type:"primary",onclick:re,children:(f,M)=>{var i=ht(),w=D(i);pe(w,{class:"mr-2 h-4 w-4"}),b(),n(f,i)},$$slots:{default:!0}})},$$slots:{default:!0}})},_=u=>{var v=bt(),$=s(v),f=o(s($));Ge(f,21,()=>e(te),Ke,(M,i)=>{var w=$t(),m=s(w),R=s(m),ie=s(R),N=s(ie);let ne;var Te=s(N);fe(Te,{class:"h-4 w-4"}),a(N);var de=o(N,2),ce=s(de),Le=s(ce,!0);a(ce),a(de),a(ie),a(R),a(m);var U=o(m),Ee=s(U);X(Ee,{variant:"default",size:"sm",children:(g,A)=>{b();var B=T();O(k=>W(B,k),[()=>qe(e(i).trigger_event)]),n(g,B)},$$slots:{default:!0}}),a(U);var V=o(U),Fe=s(V);{var je=g=>{X(g,{variant:"success",size:"sm",children:(A,B)=>{b();var k=T("Active");n(A,k)},$$slots:{default:!0}})},ze=g=>{X(g,{variant:"default",size:"sm",children:(A,B)=>{b();var k=T("Paused");n(A,k)},$$slots:{default:!0}})};G(Fe,g=>{e(i).is_active?g(je):g(ze,!1)})}a(V);var ue=o(V),Ie=s(ue);{let g=x(()=>({icon:ct,class:"p-1.5 rounded-lg hover:bg-bg-secondary transition-colors text-text-muted hover:text-text"})),A=x(()=>[{label:"Edit",icon:ut,onclick:()=>Ve(`${e(Z)}/lists/${e(L)}/autoresponders/${e(i).id}`)},{label:e(i).is_active?"Pause":"Activate",icon:e(i).is_active?vt:pt,onclick:()=>we(e(i))},{divider:!0},{label:"Delete",icon:ft,variant:"danger",onclick:()=>ye(e(i))}]);ot(Ie,{get trigger(){return e(g)},get items(){return e(A)}})}a(ue),a(w),O(()=>{He(R,"href",`${e(Z)??""}/lists/${e(L)??""}/autoresponders/${e(i).id??""}`),ne=Je(N,1,"data-table-icon",null,ne,{active:e(i).is_active}),W(Le,e(i).name)}),n(M,w)}),a(f),a($),a(v),n(u,v)};G(c,u=>{e(te).length===0?u(d):u(_,!1)},!0)}n(t,l)};G(le,t=>{e(J)?t(Ce):t(ke,!1)})}var oe=o(le,2);tt(oe,{title:"Create Autoresponder",size:"md",get show(){return e(q)},set show(l){r(q,l,!0)},footer:l=>{var c=xt(),d=D(c);H(d,{type:"secondary",onclick:()=>r(q,!1),get disabled(){return e(C)},children:(u,v)=>{b();var $=T("Cancel");n(u,$)},$$slots:{default:!0}});var _=o(d,2);{let u=x(()=>!e(y)||!e(S)||e(C));H(_,{type:"primary",onclick:xe,get disabled(){return e(u)},children:(v,$)=>{b();var f=T();O(()=>W(f,e(C)?"Creating...":"Create")),n(v,f)},$$slots:{default:!0}})}n(l,c)},children:(l,c)=>{var d=yt(),_=s(d),u=o(s(_),2);ve(u,{id:"seq-name",type:"text",oninput:be,placeholder:"Welcome Series",get value(){return e(y)},set value(m){r(y,m,!0)}}),a(_);var v=o(_,2),$=o(s(v),2);ve($,{id:"seq-slug",type:"text",placeholder:"welcome-series",get value(){return e(S)},set value(m){r(S,m,!0)}}),a(v);var f=o(v,2),M=o(s(f),2);at(M,{id:"seq-trigger",options:[{value:"signup",label:"On signup"},{value:"manual",label:"Manual enrollment"}],get value(){return e(E)},set value(m){r(E,m,!0)}}),a(f);var i=o(f,2),w=s(i);st(w,{get checked(){return e(F)},set checked(m){r(F,m,!0)}}),b(2),a(i),a(d),n(l,d)},$$slots:{footer:!0,default:!0}});var De=o(oe,2);{let t=x(()=>`Delete "${e(I)?.name||""}"? This cannot be undone.`),l=x(()=>e(K)?"Deleting...":"Delete");rt(De,{title:"Delete Autoresponder",get description(){return e(t)},get actionLabel(){return e(l)},actionType:"danger",onAction:Se,onCancel:()=>r(z,!1),get open(){return e(z)},set open(c){r(z,c,!0)}})}n(me,ae),Oe(),he()}export{Jt as component};
