import"../chunks/DsnmJJEf.js";import{a as Be}from"../chunks/Hdby3CWe.js";import{p as je,a as De,d as Fe,e as Le,c as r,f as $,h as o,b as i,g as Oe,n as c,r as s,i as n,s as A,t as X,j as qe}from"../chunks/odI--4Kw.js";import{s as Z,e as ze}from"../chunks/BNMK9zrr.js";import{i as P}from"../chunks/COaB7F5h.js";import{a as l,c as F,f,t as L}from"../chunks/CCInJaqd.js";import{h as Me}from"../chunks/hUjpWz_l.js";import{s as Ee,a as He}from"../chunks/DL1yFSKa.js";import{g as I}from"../chunks/DWh3c8Cl.js";import{p as Ye}from"../chunks/CfNhSnGx.js";import{v as Ge,r as Je}from"../chunks/CORuJdE6.js";import{a as Ke}from"../chunks/DRhpKEWD.js";import{C as Qe,A as ie,T as Ue,I as T,c as Ve,B as We}from"../chunks/BnWrML5A.js";import{S as Xe}from"../chunks/BYxulhzv.js";import{B as Ze}from"../chunks/BD7k7D4N.js";import{A as ea}from"../chunks/BCZXMA-Y.js";var aa=f('<div class="text-center py-8"><div class="mx-auto flex items-center justify-center h-12 w-12"><!></div> <p class="mt-4 text-sm text-text-muted">Loading invitation details...</p></div>'),ta=f("<p> </p>"),ra=f('<div class="text-center py-8 space-y-4"><!> <div class="pt-4"><a href="/auth/login" class="text-sm font-medium text-primary hover:underline">Return to login</a></div></div>'),sa=f("<p> </p>"),oa=f('<!> <div class="mt-6"></div>',1),ia=f(`<div><label class="form-label">Account Type</label> <div class="px-4 py-3 bg-bg-secondary border border-border rounded-xl"><div class="flex items-center gap-2"><!></div> <p class="text-xs text-text-muted mt-1">You've been invited to join Outlet</p></div></div>`),la=f('<!> <form class="space-y-5"><!> <div class="grid grid-cols-2 gap-4"><div><label for="first-name" class="form-label">First name</label> <!></div> <div><label for="last-name" class="form-label">Last name</label> <!></div></div> <div><label for="email" class="form-label">Email address</label> <!></div> <div><label for="phone" class="form-label">Phone number <span class="text-text-muted">(optional)</span></label> <!></div> <div><label for="password" class="form-label">Password</label> <!></div> <div><label for="confirm-password" class="form-label">Confirm password</label> <!></div> <div class="flex items-start gap-3"><!> <span class="text-sm text-text">I agree to the <a href="/terms" class="text-primary hover:underline">Terms of Service</a> and <a href="/privacy" class="text-primary hover:underline">Privacy Policy</a></span></div> <!></form>',1),na=f('<div class="space-y-8"><div><a href="/" class="inline-flex items-center text-sm text-text-muted hover:text-text"><!> Back to home</a></div> <div class="text-center"><h1 class="text-4xl font-bold text-text">Outlet</h1> <h2 class="mt-6 text-2xl font-semibold text-text">Complete your registration</h2></div> <!></div>');function Ta(le,ne){je(ne,!0);const ve=()=>He(Ye,"$page",de),[de,me]=Ee();let e=De({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",userType:"homeowner",agreeToTerms:!1}),k=A(!1),v=A(""),O=A(null),u=A(null),R=A(!1);Be(async()=>{const d=ve().url.searchParams.get("token");if(!d){i(v,"Registration requires an invitation. Please contact an administrator."),i(R,!1);return}i(O,d,!0),i(R,!0);try{const a=await Ge({token:d});a.valid?(e.email=a.email,e.firstName=a.first_name||"",e.lastName=a.last_name||"",e.phone=a.phone||"",a.role==="partner_manager"?(i(u,"partner"),e.userType="partner"):a.role==="sales_agent"?(i(u,"agent"),e.userType="agent"):a.role==="homeowner"&&(i(u,"homeowner"),e.userType="homeowner")):i(v,a.message||"Invalid invitation token",!0)}catch(a){console.error("Failed to validate invitation:",a),i(v,"Failed to validate invitation. Please try again or contact support.")}finally{i(R,!1)}});async function fe(d){if(d.preventDefault(),i(k,!0),i(v,""),e.password!==e.confirmPassword){i(v,"Passwords do not match"),i(k,!1);return}try{const a=await Je({email:e.email,password:e.password,first_name:e.firstName,last_name:e.lastName,phone:e.phone||void 0,token:n(O)||void 0});a.token&&a.user?(Ke.setSession(a.token,a.user),a.user.role==="sales_agent"?I("/agent"):a.user.role==="partner_manager"?I("/partner"):a.user.role==="homeowner"?I("/homeowner"):a.user.role==="admin"?I("/"):I("/")):i(v,"Invalid response from server")}catch(a){console.error("Registration error:",a),i(v,a.message||"Registration failed. Please try again.",!0)}finally{i(k,!1)}}var q=na();Me("clthg1",d=>{Le(()=>{Oe.title="Create Account - Outlet"})});var z=r(q),ee=r(z),pe=r(ee);ea(pe,{class:"w-4 h-4 mr-2"}),c(),s(ee),s(z);var ce=o(z,4);Qe(ce,{children:(d,a)=>{var ae=F(),ue=$(ae);{var _e=_=>{var g=aa(),S=r(g),M=r(S);Xe(M,{size:32,class:"text-primary"}),s(S),c(2),s(g),l(_,g)},ge=_=>{var g=F(),S=$(g);{var M=h=>{var x=ra(),B=r(x);ie(B,{type:"warning",title:"Invitation Required",get icon(){return Ue},children:(E,j)=>{var y=ta(),H=r(y,!0);s(y),X(()=>Z(H,n(v))),l(E,y)},$$slots:{default:!0}}),c(2),s(x),l(h,x)},he=h=>{var x=la(),B=$(x);{var E=t=>{var m=oa(),N=$(m);ie(N,{type:"error",title:"Registration failed",children:(p,re)=>{var C=sa(),se=r(C,!0);s(C),X(()=>Z(se,n(v))),l(p,C)},$$slots:{default:!0}}),c(2),l(t,m)};P(B,t=>{n(v)&&t(E)})}var j=o(B,2),y=r(j);{var H=t=>{var m=ia(),N=o(r(m),2),p=r(N),re=r(p);Ze(re,{variant:"info",children:(C,se)=>{var oe=F(),Ne=$(oe);{var Ce=b=>{var D=L("Partner Manager");l(b,D)},Ae=b=>{var D=F(),Ie=$(D);{var Re=w=>{var W=L("Sales Agent");l(w,W)},Se=w=>{var W=L("Homeowner");l(w,W)};P(Ie,w=>{n(u)==="agent"?w(Re):w(Se,!1)},!0)}l(b,D)};P(Ne,b=>{n(u)==="partner"?b(Ce):b(Ae,!1)})}l(C,oe)},$$slots:{default:!0}}),s(p),c(2),s(N),s(m),l(t,m)};P(y,t=>{n(u)&&t(H)})}var Y=o(y,2),G=r(Y),xe=o(r(G),2);T(xe,{id:"first-name",type:"text",get value(){return e.firstName},set value(t){e.firstName=t}}),s(G);var te=o(G,2),ye=o(r(te),2);T(ye,{id:"last-name",type:"text",get value(){return e.lastName},set value(t){e.lastName=t}}),s(te),s(Y);var J=o(Y,2),be=o(r(J),2);T(be,{id:"email",type:"email",get value(){return e.email},set value(t){e.email=t}}),s(J);var K=o(J,2),we=o(r(K),2);T(we,{id:"phone",type:"tel",get value(){return e.phone},set value(t){e.phone=t}}),s(K);var Q=o(K,2),$e=o(r(Q),2);T($e,{id:"password",type:"password",get value(){return e.password},set value(t){e.password=t}}),s(Q);var U=o(Q,2),Pe=o(r(U),2);T(Pe,{id:"confirm-password",type:"password",get value(){return e.confirmPassword},set value(t){e.confirmPassword=t}}),s(U);var V=o(U,2),Te=r(V);Ve(Te,{get checked(){return e.agreeToTerms},set checked(t){e.agreeToTerms=t}}),c(2),s(V);var ke=o(V,2);{let t=qe(()=>n(k)||!e.agreeToTerms);We(ke,{htmlType:"submit",type:"primary",size:"lg",get disabled(){return n(t)},class:"w-full justify-center",children:(m,N)=>{c();var p=L();X(()=>Z(p,n(k)?"Creating account...":"Create account")),l(m,p)},$$slots:{default:!0}})}s(j),ze("submit",j,fe),l(h,x)};P(S,h=>{n(v)&&!n(O)?h(M):h(he,!1)},!0)}l(_,g)};P(ue,_=>{n(R)?_(_e):_(ge,!1)})}l(d,ae)},$$slots:{default:!0}}),s(q),l(le,q),Fe(),me()}export{Ta as component};
