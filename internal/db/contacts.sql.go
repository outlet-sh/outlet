// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: contacts.sql

package db

import (
	"context"
	"database/sql"
)

const blockContact = `-- name: BlockContact :exec
UPDATE contacts
SET blocked_at = datetime('now'), updated_at = datetime('now')
WHERE id = ?1
`

func (q *Queries) BlockContact(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, blockContact, id)
	return err
}

const countContacts = `-- name: CountContacts :one
SELECT COUNT(*) as count FROM contacts
`

func (q *Queries) CountContacts(ctx context.Context) (int64, error) {
	row := q.db.QueryRowContext(ctx, countContacts)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countContactsByOrg = `-- name: CountContactsByOrg :one
SELECT COUNT(*) as count FROM contacts WHERE org_id = ?1
`

func (q *Queries) CountContactsByOrg(ctx context.Context, orgID sql.NullString) (int64, error) {
	row := q.db.QueryRowContext(ctx, countContactsByOrg, orgID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countContactsByStatus = `-- name: CountContactsByStatus :one
SELECT COUNT(*) as count FROM contacts WHERE status = ?1
`

func (q *Queries) CountContactsByStatus(ctx context.Context, status sql.NullString) (int64, error) {
	row := q.db.QueryRowContext(ctx, countContactsByStatus, status)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countInactiveContacts90Days = `-- name: CountInactiveContacts90Days :one
SELECT COUNT(*) as count FROM contacts c
WHERE c.org_id = ?1
AND c.email_verified = 1
AND c.unsubscribed_at IS NULL
AND NOT EXISTS (
    SELECT 1 FROM email_queue eq
    WHERE eq.contact_id = c.id
    AND eq.opened_at > datetime('now', '-90 days')
)
`

func (q *Queries) CountInactiveContacts90Days(ctx context.Context, orgID sql.NullString) (int64, error) {
	row := q.db.QueryRowContext(ctx, countInactiveContacts90Days, orgID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const countUnconfirmedContactsOlderThan = `-- name: CountUnconfirmedContactsOlderThan :one
SELECT COUNT(*) as count FROM contacts
WHERE org_id = ?1
AND email_verified = 0
AND datetime(created_at) < datetime('now', ?2)
`

type CountUnconfirmedContactsOlderThanParams struct {
	OrgID        sql.NullString `json:"org_id"`
	DaysModifier interface{}    `json:"days_modifier"`
}

func (q *Queries) CountUnconfirmedContactsOlderThan(ctx context.Context, arg CountUnconfirmedContactsOlderThanParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, countUnconfirmedContactsOlderThan, arg.OrgID, arg.DaysModifier)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const createContact = `-- name: CreateContact :one
INSERT INTO contacts (
    id, org_id, name, email, source, status, created_at, updated_at
) VALUES (
    ?1, ?2, ?3, ?4,
    ?5, COALESCE(?6, 'new'),
    datetime('now'), datetime('now')
) RETURNING id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at
`

type CreateContactParams struct {
	ID     string         `json:"id"`
	OrgID  sql.NullString `json:"org_id"`
	Name   string         `json:"name"`
	Email  string         `json:"email"`
	Source sql.NullString `json:"source"`
	Status interface{}    `json:"status"`
}

func (q *Queries) CreateContact(ctx context.Context, arg CreateContactParams) (Contact, error) {
	row := q.db.QueryRowContext(ctx, createContact,
		arg.ID,
		arg.OrgID,
		arg.Name,
		arg.Email,
		arg.Source,
		arg.Status,
	)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const deleteContact = `-- name: DeleteContact :exec
DELETE FROM contacts WHERE id = ?1
`

func (q *Queries) DeleteContact(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, deleteContact, id)
	return err
}

const deleteInactiveContacts90Days = `-- name: DeleteInactiveContacts90Days :execrows
DELETE FROM contacts
WHERE contacts.org_id = ?1
AND contacts.id IN (
    SELECT c.id FROM contacts c
    WHERE c.org_id = ?1
    AND c.email_verified = 1
    AND c.unsubscribed_at IS NULL
    AND NOT EXISTS (
        SELECT 1 FROM email_queue eq
        WHERE eq.contact_id = c.id
        AND eq.opened_at > datetime('now', '-90 days')
    )
)
`

func (q *Queries) DeleteInactiveContacts90Days(ctx context.Context, orgID sql.NullString) (int64, error) {
	result, err := q.db.ExecContext(ctx, deleteInactiveContacts90Days, orgID)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const deleteUnconfirmedContactsOlderThan = `-- name: DeleteUnconfirmedContactsOlderThan :execrows
DELETE FROM contacts
WHERE org_id = ?1
AND email_verified = 0
AND datetime(created_at) < datetime('now', ?2)
`

type DeleteUnconfirmedContactsOlderThanParams struct {
	OrgID        sql.NullString `json:"org_id"`
	DaysModifier interface{}    `json:"days_modifier"`
}

func (q *Queries) DeleteUnconfirmedContactsOlderThan(ctx context.Context, arg DeleteUnconfirmedContactsOlderThanParams) (int64, error) {
	result, err := q.db.ExecContext(ctx, deleteUnconfirmedContactsOlderThan, arg.OrgID, arg.DaysModifier)
	if err != nil {
		return 0, err
	}
	return result.RowsAffected()
}

const getAllOrgsContactStats = `-- name: GetAllOrgsContactStats :many
SELECT
    org_id,
    COUNT(*) as total_contacts
FROM contacts
GROUP BY org_id
`

type GetAllOrgsContactStatsRow struct {
	OrgID         sql.NullString `json:"org_id"`
	TotalContacts int64          `json:"total_contacts"`
}

func (q *Queries) GetAllOrgsContactStats(ctx context.Context) ([]GetAllOrgsContactStatsRow, error) {
	rows, err := q.db.QueryContext(ctx, getAllOrgsContactStats)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetAllOrgsContactStatsRow
	for rows.Next() {
		var i GetAllOrgsContactStatsRow
		if err := rows.Scan(&i.OrgID, &i.TotalContacts); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getContact = `-- name: GetContact :one
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts WHERE id = ?1
`

func (q *Queries) GetContact(ctx context.Context, id string) (Contact, error) {
	row := q.db.QueryRowContext(ctx, getContact, id)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const getContactByEmail = `-- name: GetContactByEmail :one
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts WHERE email = ?1 ORDER BY created_at DESC LIMIT 1
`

func (q *Queries) GetContactByEmail(ctx context.Context, email string) (Contact, error) {
	row := q.db.QueryRowContext(ctx, getContactByEmail, email)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const getContactByID = `-- name: GetContactByID :one
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts WHERE id = ?1
`

func (q *Queries) GetContactByID(ctx context.Context, id string) (Contact, error) {
	row := q.db.QueryRowContext(ctx, getContactByID, id)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const getContactByOrgAndEmail = `-- name: GetContactByOrgAndEmail :one
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts
WHERE org_id = ?1 AND email = ?2
ORDER BY created_at DESC LIMIT 1
`

type GetContactByOrgAndEmailParams struct {
	OrgID sql.NullString `json:"org_id"`
	Email string         `json:"email"`
}

func (q *Queries) GetContactByOrgAndEmail(ctx context.Context, arg GetContactByOrgAndEmailParams) (Contact, error) {
	row := q.db.QueryRowContext(ctx, getContactByOrgAndEmail, arg.OrgID, arg.Email)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const getContactByOrgID = `-- name: GetContactByOrgID :one
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts
WHERE id = ?1 AND org_id = ?2
`

type GetContactByOrgIDParams struct {
	ID    string         `json:"id"`
	OrgID sql.NullString `json:"org_id"`
}

func (q *Queries) GetContactByOrgID(ctx context.Context, arg GetContactByOrgIDParams) (Contact, error) {
	row := q.db.QueryRowContext(ctx, getContactByOrgID, arg.ID, arg.OrgID)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const getContactByVerificationToken = `-- name: GetContactByVerificationToken :one
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts WHERE verification_token = ?1
`

func (q *Queries) GetContactByVerificationToken(ctx context.Context, token sql.NullString) (Contact, error) {
	row := q.db.QueryRowContext(ctx, getContactByVerificationToken, token)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const getContactCampaignSends = `-- name: GetContactCampaignSends :many

SELECT
    cs.id,
    cs.campaign_id,
    ec.name as campaign_name,
    cs.sent_at,
    cs.opened_at,
    cs.clicked_at
FROM campaign_sends cs
LEFT JOIN email_campaigns ec ON ec.id = cs.campaign_id
WHERE cs.contact_id = ?1
ORDER BY cs.sent_at DESC
`

type GetContactCampaignSendsRow struct {
	ID           string         `json:"id"`
	CampaignID   string         `json:"campaign_id"`
	CampaignName sql.NullString `json:"campaign_name"`
	SentAt       sql.NullString `json:"sent_at"`
	OpenedAt     sql.NullString `json:"opened_at"`
	ClickedAt    sql.NullString `json:"clicked_at"`
}

// ============================================
// GDPR EXPORT QUERIES
// ============================================
func (q *Queries) GetContactCampaignSends(ctx context.Context, contactID string) ([]GetContactCampaignSendsRow, error) {
	rows, err := q.db.QueryContext(ctx, getContactCampaignSends, contactID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetContactCampaignSendsRow
	for rows.Next() {
		var i GetContactCampaignSendsRow
		if err := rows.Scan(
			&i.ID,
			&i.CampaignID,
			&i.CampaignName,
			&i.SentAt,
			&i.OpenedAt,
			&i.ClickedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getContactEmailClicks = `-- name: GetContactEmailClicks :many
SELECT
    ec.id,
    ec.link_url,
    ec.link_name,
    ec.clicked_at,
    ec.user_agent,
    ec.ip_address
FROM email_clicks ec
WHERE ec.contact_id = ?1
ORDER BY ec.clicked_at DESC
`

type GetContactEmailClicksRow struct {
	ID        string         `json:"id"`
	LinkUrl   string         `json:"link_url"`
	LinkName  sql.NullString `json:"link_name"`
	ClickedAt string         `json:"clicked_at"`
	UserAgent sql.NullString `json:"user_agent"`
	IpAddress sql.NullString `json:"ip_address"`
}

func (q *Queries) GetContactEmailClicks(ctx context.Context, contactID sql.NullString) ([]GetContactEmailClicksRow, error) {
	rows, err := q.db.QueryContext(ctx, getContactEmailClicks, contactID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetContactEmailClicksRow
	for rows.Next() {
		var i GetContactEmailClicksRow
		if err := rows.Scan(
			&i.ID,
			&i.LinkUrl,
			&i.LinkName,
			&i.ClickedAt,
			&i.UserAgent,
			&i.IpAddress,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getContactSequenceEmails = `-- name: GetContactSequenceEmails :many
SELECT
    eq.id,
    et.sequence_id,
    es.name as sequence_name,
    et.position as step_number,
    et.subject,
    eq.status,
    eq.sent_at,
    eq.opened_at,
    eq.clicked_at
FROM email_queue eq
LEFT JOIN email_templates et ON et.id = eq.template_id
LEFT JOIN email_sequences es ON es.id = et.sequence_id
WHERE eq.contact_id = ?1
ORDER BY eq.sent_at DESC
`

type GetContactSequenceEmailsRow struct {
	ID           string         `json:"id"`
	SequenceID   sql.NullString `json:"sequence_id"`
	SequenceName sql.NullString `json:"sequence_name"`
	StepNumber   sql.NullInt64  `json:"step_number"`
	Subject      sql.NullString `json:"subject"`
	Status       sql.NullString `json:"status"`
	SentAt       sql.NullString `json:"sent_at"`
	OpenedAt     sql.NullString `json:"opened_at"`
	ClickedAt    sql.NullString `json:"clicked_at"`
}

func (q *Queries) GetContactSequenceEmails(ctx context.Context, contactID sql.NullString) ([]GetContactSequenceEmailsRow, error) {
	rows, err := q.db.QueryContext(ctx, getContactSequenceEmails, contactID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetContactSequenceEmailsRow
	for rows.Next() {
		var i GetContactSequenceEmailsRow
		if err := rows.Scan(
			&i.ID,
			&i.SequenceID,
			&i.SequenceName,
			&i.StepNumber,
			&i.Subject,
			&i.Status,
			&i.SentAt,
			&i.OpenedAt,
			&i.ClickedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getContactTransactionalSends = `-- name: GetContactTransactionalSends :many
SELECT
    ts.id,
    ts.template_id,
    te.name as template_name,
    ts.to_email,
    ts.status,
    ts.opened_at,
    ts.clicked_at,
    ts.created_at
FROM transactional_sends ts
LEFT JOIN transactional_emails te ON te.id = ts.template_id
WHERE ts.contact_id = ?1
ORDER BY ts.created_at DESC
`

type GetContactTransactionalSendsRow struct {
	ID           string         `json:"id"`
	TemplateID   string         `json:"template_id"`
	TemplateName sql.NullString `json:"template_name"`
	ToEmail      string         `json:"to_email"`
	Status       sql.NullString `json:"status"`
	OpenedAt     sql.NullString `json:"opened_at"`
	ClickedAt    sql.NullString `json:"clicked_at"`
	CreatedAt    sql.NullString `json:"created_at"`
}

func (q *Queries) GetContactTransactionalSends(ctx context.Context, contactID sql.NullString) ([]GetContactTransactionalSendsRow, error) {
	rows, err := q.db.QueryContext(ctx, getContactTransactionalSends, contactID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetContactTransactionalSendsRow
	for rows.Next() {
		var i GetContactTransactionalSendsRow
		if err := rows.Scan(
			&i.ID,
			&i.TemplateID,
			&i.TemplateName,
			&i.ToEmail,
			&i.Status,
			&i.OpenedAt,
			&i.ClickedAt,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const getDashboardSubscriberGrowth = `-- name: GetDashboardSubscriberGrowth :one
SELECT
    COALESCE(
        (SELECT COUNT(*) FROM contacts c1 WHERE c1.org_id = ?1 AND datetime(c1.created_at) > datetime('now', '-30 days')),
        0
    ) as current_period,
    COALESCE(
        (SELECT COUNT(*) FROM contacts c2 WHERE c2.org_id = ?1 AND datetime(c2.created_at) BETWEEN datetime('now', '-60 days') AND datetime('now', '-30 days')),
        0
    ) as previous_period
`

type GetDashboardSubscriberGrowthRow struct {
	CurrentPeriod  interface{} `json:"current_period"`
	PreviousPeriod interface{} `json:"previous_period"`
}

func (q *Queries) GetDashboardSubscriberGrowth(ctx context.Context, orgID sql.NullString) (GetDashboardSubscriberGrowthRow, error) {
	row := q.db.QueryRowContext(ctx, getDashboardSubscriberGrowth, orgID)
	var i GetDashboardSubscriberGrowthRow
	err := row.Scan(&i.CurrentPeriod, &i.PreviousPeriod)
	return i, err
}

const getDashboardSubscriberStats = `-- name: GetDashboardSubscriberStats :one

SELECT
    COUNT(*) as total,
    SUM(CASE WHEN datetime(created_at) > datetime('now', '-30 days') THEN 1 ELSE 0 END) as new_30d,
    SUM(CASE WHEN datetime(created_at) > datetime('now', '-7 days') THEN 1 ELSE 0 END) as new_7d
FROM contacts WHERE org_id = ?1
`

type GetDashboardSubscriberStatsRow struct {
	Total  int64           `json:"total"`
	New30d sql.NullFloat64 `json:"new_30d"`
	New7d  sql.NullFloat64 `json:"new_7d"`
}

// ============================================
// DASHBOARD STATS QUERIES
// ============================================
func (q *Queries) GetDashboardSubscriberStats(ctx context.Context, orgID sql.NullString) (GetDashboardSubscriberStatsRow, error) {
	row := q.db.QueryRowContext(ctx, getDashboardSubscriberStats, orgID)
	var i GetDashboardSubscriberStatsRow
	err := row.Scan(&i.Total, &i.New30d, &i.New7d)
	return i, err
}

const globalUnsubscribeByOrgAndEmail = `-- name: GlobalUnsubscribeByOrgAndEmail :exec
UPDATE contacts
SET unsubscribed_at = datetime('now'), status = 'unsubscribed', updated_at = datetime('now')
WHERE org_id = ?1 AND email = ?2
`

type GlobalUnsubscribeByOrgAndEmailParams struct {
	OrgID sql.NullString `json:"org_id"`
	Email string         `json:"email"`
}

func (q *Queries) GlobalUnsubscribeByOrgAndEmail(ctx context.Context, arg GlobalUnsubscribeByOrgAndEmailParams) error {
	_, err := q.db.ExecContext(ctx, globalUnsubscribeByOrgAndEmail, arg.OrgID, arg.Email)
	return err
}

const listContacts = `-- name: ListContacts :many
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts
ORDER BY created_at DESC
LIMIT ?2 OFFSET ?1
`

type ListContactsParams struct {
	PageOffset int64 `json:"page_offset"`
	PageSize   int64 `json:"page_size"`
}

func (q *Queries) ListContacts(ctx context.Context, arg ListContactsParams) ([]Contact, error) {
	rows, err := q.db.QueryContext(ctx, listContacts, arg.PageOffset, arg.PageSize)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Contact
	for rows.Next() {
		var i Contact
		if err := rows.Scan(
			&i.ID,
			&i.OrgID,
			&i.Name,
			&i.Email,
			&i.Source,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.EmailVerified,
			&i.VerificationToken,
			&i.VerificationSentAt,
			&i.VerifiedAt,
			&i.UnsubscribedAt,
			&i.BlockedAt,
			&i.Status,
			&i.GdprConsent,
			&i.GdprConsentAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const listContactsByOrg = `-- name: ListContactsByOrg :many
SELECT id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at FROM contacts
WHERE org_id = ?1
ORDER BY created_at DESC
LIMIT ?3 OFFSET ?2
`

type ListContactsByOrgParams struct {
	OrgID      sql.NullString `json:"org_id"`
	PageOffset int64          `json:"page_offset"`
	PageSize   int64          `json:"page_size"`
}

func (q *Queries) ListContactsByOrg(ctx context.Context, arg ListContactsByOrgParams) ([]Contact, error) {
	rows, err := q.db.QueryContext(ctx, listContactsByOrg, arg.OrgID, arg.PageOffset, arg.PageSize)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []Contact
	for rows.Next() {
		var i Contact
		if err := rows.Scan(
			&i.ID,
			&i.OrgID,
			&i.Name,
			&i.Email,
			&i.Source,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.EmailVerified,
			&i.VerificationToken,
			&i.VerificationSentAt,
			&i.VerifiedAt,
			&i.UnsubscribedAt,
			&i.BlockedAt,
			&i.Status,
			&i.GdprConsent,
			&i.GdprConsentAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const manuallyVerifyContact = `-- name: ManuallyVerifyContact :exec
UPDATE contacts
SET email_verified = 1, verified_at = datetime('now'), verification_token = NULL
WHERE id = ?1
`

func (q *Queries) ManuallyVerifyContact(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, manuallyVerifyContact, id)
	return err
}

const resubscribeContact = `-- name: ResubscribeContact :exec
UPDATE contacts
SET unsubscribed_at = NULL, updated_at = datetime('now')
WHERE id = ?1
`

func (q *Queries) ResubscribeContact(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, resubscribeContact, id)
	return err
}

const setContactVerificationToken = `-- name: SetContactVerificationToken :exec
UPDATE contacts
SET verification_token = ?1, verification_sent_at = datetime('now')
WHERE id = ?2
`

type SetContactVerificationTokenParams struct {
	Token sql.NullString `json:"token"`
	ID    string         `json:"id"`
}

func (q *Queries) SetContactVerificationToken(ctx context.Context, arg SetContactVerificationTokenParams) error {
	_, err := q.db.ExecContext(ctx, setContactVerificationToken, arg.Token, arg.ID)
	return err
}

const unblockContact = `-- name: UnblockContact :exec
UPDATE contacts
SET blocked_at = NULL, updated_at = datetime('now')
WHERE id = ?1
`

func (q *Queries) UnblockContact(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, unblockContact, id)
	return err
}

const updateContactGDPR = `-- name: UpdateContactGDPR :exec
UPDATE contacts
SET gdpr_consent = ?1,
    gdpr_consent_at = CASE WHEN ?1 = 1 THEN datetime('now') ELSE NULL END,
    updated_at = datetime('now')
WHERE id = ?2
`

type UpdateContactGDPRParams struct {
	Consent sql.NullInt64 `json:"consent"`
	ID      string        `json:"id"`
}

func (q *Queries) UpdateContactGDPR(ctx context.Context, arg UpdateContactGDPRParams) error {
	_, err := q.db.ExecContext(ctx, updateContactGDPR, arg.Consent, arg.ID)
	return err
}

const updateContactName = `-- name: UpdateContactName :exec
UPDATE contacts
SET name = ?1, updated_at = datetime('now')
WHERE id = ?2
`

type UpdateContactNameParams struct {
	Name string `json:"name"`
	ID   string `json:"id"`
}

func (q *Queries) UpdateContactName(ctx context.Context, arg UpdateContactNameParams) error {
	_, err := q.db.ExecContext(ctx, updateContactName, arg.Name, arg.ID)
	return err
}

const updateContactStatus = `-- name: UpdateContactStatus :exec
UPDATE contacts
SET status = ?1, updated_at = datetime('now')
WHERE id = ?2
`

type UpdateContactStatusParams struct {
	Status sql.NullString `json:"status"`
	ID     string         `json:"id"`
}

func (q *Queries) UpdateContactStatus(ctx context.Context, arg UpdateContactStatusParams) error {
	_, err := q.db.ExecContext(ctx, updateContactStatus, arg.Status, arg.ID)
	return err
}

const updateSDKContact = `-- name: UpdateSDKContact :one
UPDATE contacts
SET name = COALESCE(NULLIF(?1, ''), name),
    updated_at = datetime('now')
WHERE id = ?2 AND org_id = ?3
RETURNING id, org_id, name, email, source, created_at, updated_at, email_verified, verification_token, verification_sent_at, verified_at, unsubscribed_at, blocked_at, status, gdpr_consent, gdpr_consent_at
`

type UpdateSDKContactParams struct {
	Name  interface{}    `json:"name"`
	ID    string         `json:"id"`
	OrgID sql.NullString `json:"org_id"`
}

func (q *Queries) UpdateSDKContact(ctx context.Context, arg UpdateSDKContactParams) (Contact, error) {
	row := q.db.QueryRowContext(ctx, updateSDKContact, arg.Name, arg.ID, arg.OrgID)
	var i Contact
	err := row.Scan(
		&i.ID,
		&i.OrgID,
		&i.Name,
		&i.Email,
		&i.Source,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.EmailVerified,
		&i.VerificationToken,
		&i.VerificationSentAt,
		&i.VerifiedAt,
		&i.UnsubscribedAt,
		&i.BlockedAt,
		&i.Status,
		&i.GdprConsent,
		&i.GdprConsentAt,
	)
	return i, err
}

const verifyContact = `-- name: VerifyContact :exec
UPDATE contacts
SET email_verified = 1, verified_at = datetime('now'), verification_token = NULL
WHERE id = ?1
`

func (q *Queries) VerifyContact(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, verifyContact, id)
	return err
}

const verifyContactEmail = `-- name: VerifyContactEmail :exec
UPDATE contacts
SET email_verified = 1, verified_at = datetime('now'), verification_token = NULL
WHERE id = ?1
`

func (q *Queries) VerifyContactEmail(ctx context.Context, id string) error {
	_, err := q.db.ExecContext(ctx, verifyContactEmail, id)
	return err
}
